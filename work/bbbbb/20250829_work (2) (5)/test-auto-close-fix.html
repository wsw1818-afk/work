<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í‹°ì»¤ ë©”ëª¨ ìë™ ë‹«í˜ ìˆ˜ì • í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .debug-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .calendar-fake {
            width: 100%;
            height: 200px;
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #6c757d;
            margin: 20px 0;
            position: relative;
            z-index: 1;
        }
        
        /* ìŠ¤í‹°ì»¤ ë©”ëª¨ ìŠ¤íƒ€ì¼ (ì›ë³¸ê³¼ ë™ì¼) */
        #stickyMemo {
            position: fixed !important;
            z-index: 2147483647 !important;
            display: none;
            visibility: visible !important;
            opacity: 1 !important;
            width: 350px;
            min-height: 400px;
            background: linear-gradient(135deg, rgba(255, 249, 196, 0.98) 0%, rgba(255, 245, 157, 0.98) 100%);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 120px rgba(255, 193, 7, 0.5);
            border: 1px solid rgba(255, 193, 7, 0.3);
            backdrop-filter: blur(20px) saturate(180%);
            pointer-events: auto;
            isolation: isolate;
            transform: translateZ(0);
            will-change: transform;
            contain: layout style paint;
        }
        
        .sticky-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px 10px;
            border-bottom: 1px solid rgba(255, 193, 7, 0.2);
        }
        
        .sticky-title {
            color: #b8860b;
            font-weight: bold;
            font-size: 18px;
        }
        
        .sticky-control-btn {
            background: none;
            border: none;
            color: #b8860b;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
        }
        
        .sticky-control-btn:hover {
            background: rgba(255, 193, 7, 0.2);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ›¡ï¸ ìŠ¤í‹°ì»¤ ë©”ëª¨ ìë™ ë‹«í˜ ìˆ˜ì • í…ŒìŠ¤íŠ¸</h1>
        
        <div class="calendar-fake" id="calendar">
            ê°€ì§œ ë‹¬ë ¥ (z-index: 1)
        </div>
        
        <div>
            <button class="test-button" onclick="testOpenStickyMemo()">ğŸ¯ ìŠ¤í‹°ì»¤ ë©”ëª¨ ì—´ê¸°</button>
            <button class="test-button" onclick="testForceClose()">ğŸ”´ ê°•ì œ ë‹«ê¸°</button>
            <button class="debug-button" onclick="debugAutoClose()">ğŸ”§ ë””ë²„ê·¸</button>
            <button class="debug-button" onclick="clearLog()">ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°</button>
        </div>
        
        <div>
            <h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</h3>
            <button class="debug-button" onclick="testScenario1()">ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ì—´ê¸°</button>
            <button class="debug-button" onclick="testScenario2()">ì‹œë‚˜ë¦¬ì˜¤ 2: ë¹ ë¥¸ ì¬ì—´ê¸°</button>
            <button class="debug-button" onclick="testScenario3()">ì‹œë‚˜ë¦¬ì˜¤ 3: ìë™ ë‹«í˜ í…ŒìŠ¤íŠ¸</button>
        </div>
        
        <div class="log" id="testLog"></div>
    </div>
    
    <!-- ìŠ¤í‹°ì»¤ ë©”ëª¨ HTML -->
    <div id="stickyMemo">
        <div class="sticky-header">
            <div class="sticky-title">ğŸ“ ìŠ¤í‹°ì»¤ ë©”ëª¨</div>
            <button class="sticky-control-btn sticky-close" id="stickyClose" title="ë‹«ê¸°">âœ•</button>
        </div>
        <div style="padding: 20px;">
            <textarea style="width: 100%; height: 300px; border: none; background: transparent; resize: none; outline: none; font-size: 14px;" 
                placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        </div>
    </div>
    
    <!-- í•„ìš”í•œ ìŠ¤í¬ë¦½íŠ¸ë“¤ ë¡œë“œ -->
    <script src="sticky-auto-close-fix.js"></script>
    
    <script>
        // ë¡œê·¸ í•¨ìˆ˜
        function log(message) {
            const logElement = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }
        
        // ê¸°ë³¸ ìŠ¤í‹°ì»¤ ë©”ëª¨ í•¨ìˆ˜ë“¤ êµ¬í˜„
        window.openStickyMemo = function() {
            log('ğŸ¯ openStickyMemo ì‹¤í–‰');
            const stickyMemo = document.getElementById('stickyMemo');
            
            if (!stickyMemo) {
                log('âŒ ìŠ¤í‹°ì»¤ ë©”ëª¨ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }
            
            // ìœ„ì¹˜ ì„¤ì • (í™”ë©´ ì¤‘ì•™)
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const left = Math.max(50, (windowWidth - 350) / 2);
            const top = Math.max(50, (windowHeight - 400) / 3);
            
            stickyMemo.style.left = left + 'px';
            stickyMemo.style.top = top + 'px';
            
            // í‘œì‹œ
            stickyMemo.style.display = 'flex';
            
            log('âœ… ìŠ¤í‹°ì»¤ ë©”ëª¨ ì—´ê¸° ì™„ë£Œ');
            
            // ìë™ ë‹«í˜ ì‹œë®¬ë ˆì´ì…˜ (ì›ë˜ ë¬¸ì œ ì¬í˜„ìš©)
            if (window.autoCloseSimulation) {
                setTimeout(() => {
                    log('âš ï¸ ìë™ ë‹«í˜ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰');
                    if (window.closeStickyMemo) {
                        window.closeStickyMemo();
                    }
                }, 1000);
            }
        };
        
        window.closeStickyMemo = function() {
            log('ğŸ”´ closeStickyMemo ì‹¤í–‰');
            const stickyMemo = document.getElementById('stickyMemo');
            
            if (stickyMemo) {
                stickyMemo.style.display = 'none';
                log('âŒ ìŠ¤í‹°ì»¤ ë©”ëª¨ ë‹«í˜');
            }
        };
        
        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function testOpenStickyMemo() {
            log('ğŸ“‹ í…ŒìŠ¤íŠ¸: ìŠ¤í‹°ì»¤ ë©”ëª¨ ì—´ê¸°');
            window.openStickyMemo();
        }
        
        function testForceClose() {
            log('ğŸ“‹ í…ŒìŠ¤íŠ¸: ê°•ì œ ë‹«ê¸°');
            if (window.forceCloseStickyMemo) {
                window.forceCloseStickyMemo();
            } else {
                window.closeStickyMemo();
            }
        }
        
        // í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ë“¤
        function testScenario1() {
            log('ğŸ¬ ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ì—´ê¸° í…ŒìŠ¤íŠ¸');
            window.autoCloseSimulation = false;
            
            setTimeout(() => {
                log('1. ìŠ¤í‹°ì»¤ ë©”ëª¨ ì—´ê¸°...');
                window.openStickyMemo();
            }, 100);
            
            setTimeout(() => {
                const stickyMemo = document.getElementById('stickyMemo');
                const isVisible = stickyMemo && stickyMemo.style.display !== 'none';
                log(`2. ê²°ê³¼ í™•ì¸: ${isVisible ? 'âœ… í‘œì‹œë¨' : 'âŒ ìˆ¨ê²¨ì§'}`);
            }, 2000);
        }
        
        function testScenario2() {
            log('ğŸ¬ ì‹œë‚˜ë¦¬ì˜¤ 2: ë¹ ë¥¸ ì¬ì—´ê¸° í…ŒìŠ¤íŠ¸');
            window.autoCloseSimulation = false;
            
            let step = 1;
            const interval = setInterval(() => {
                if (step <= 3) {
                    log(`${step}. ìŠ¤í‹°ì»¤ ë©”ëª¨ ì—´ê¸°...`);
                    window.openStickyMemo();
                    step++;
                } else {
                    clearInterval(interval);
                    
                    setTimeout(() => {
                        const stickyMemo = document.getElementById('stickyMemo');
                        const isVisible = stickyMemo && stickyMemo.style.display !== 'none';
                        log(`4. ìµœì¢… ê²°ê³¼: ${isVisible ? 'âœ… ì•ˆì •ì ìœ¼ë¡œ í‘œì‹œë¨' : 'âŒ ë¶ˆì•ˆì •í•¨'}`);
                    }, 1000);
                }
            }, 500);
        }
        
        function testScenario3() {
            log('ğŸ¬ ì‹œë‚˜ë¦¬ì˜¤ 3: ìë™ ë‹«í˜ ë°©ì§€ í…ŒìŠ¤íŠ¸');
            window.autoCloseSimulation = true;
            
            setTimeout(() => {
                log('1. ìë™ ë‹«í˜ ì‹œë®¬ë ˆì´ì…˜ê³¼ í•¨ê»˜ ìŠ¤í‹°ì»¤ ë©”ëª¨ ì—´ê¸°...');
                window.openStickyMemo();
            }, 100);
            
            setTimeout(() => {
                const stickyMemo = document.getElementById('stickyMemo');
                const isVisible = stickyMemo && stickyMemo.style.display !== 'none';
                log(`2. 1ì´ˆ í›„ ìƒíƒœ: ${isVisible ? 'âœ… ìë™ ë‹«í˜ ë°©ì§€ë¨' : 'âŒ ìë™ ë‹«í˜ ë°œìƒ'}`);
            }, 1500);
            
            setTimeout(() => {
                const stickyMemo = document.getElementById('stickyMemo');
                const isVisible = stickyMemo && stickyMemo.style.display !== 'none';
                log(`3. 3ì´ˆ í›„ ìµœì¢… ìƒíƒœ: ${isVisible ? 'âœ… ì§€ì†ì ìœ¼ë¡œ í‘œì‹œë¨' : 'âŒ ìµœì¢… ë‹«í˜'}`);
                window.autoCloseSimulation = false;
            }, 3500);
        }
        
        // ì´ˆê¸°í™” ë¡œê·¸
        log('ğŸ® ìŠ¤í‹°ì»¤ ë©”ëª¨ ìë™ ë‹«í˜ ìˆ˜ì • í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
        log('ğŸ›¡ï¸ ìë™ ë‹«í˜ ë°©ì§€ ì‹œìŠ¤í…œì´ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”');
        
        // ìŠ¤í‹°ì»¤ ë©”ëª¨ ê¸°ë³¸ ì´ë²¤íŠ¸ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            const closeBtn = document.getElementById('stickyClose');
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    log('ğŸ–±ï¸ ë‹«ê¸° ë²„íŠ¼ í´ë¦­ë¨');
                    if (window.forceCloseStickyMemo) {
                        window.forceCloseStickyMemo();
                    } else {
                        window.closeStickyMemo();
                    }
                });
            }
        });
    </script>
</body>
</html>