<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Cross-Origin Ï†ïÏ±Ö ÏÑ§Ï†ï Ï†úÍ±∞ - Google OAuth Ìò∏ÌôòÏÑ± Ìñ•ÏÉÅ -->
    <title>üìÖ ÌïúÍµ≠ Îã¨Î†•</title>
    <style>
        :root {
            --font-scale: 1.0;
            --width-scale: 1.0;
            --height-scale: 1.0;
            
            /* ÏÉàÎ°úÏö¥ ÏÉâÏÉÅ ÌåîÎ†àÌä∏ */
            --primary-color: rgba(99, 132, 183, 1);
            --primary-light: rgba(99, 132, 183, 0.1);
            --primary-medium: rgba(99, 132, 183, 0.2);
            --primary-border: rgba(99, 132, 183, 0.3);
            
            --surface-color: rgba(255, 255, 255, 0.95);
            --surface-hover: rgba(255, 255, 255, 0.8);
            --surface-border: rgba(99, 132, 183, 0.15);
            
            --text-primary: #3c4043;
            --text-secondary: #5f6368;
            --background-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            
            --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 2px 8px rgba(0, 0, 0, 0.06);
            --shadow-hover: 0 2px 6px rgba(0, 0, 0, 0.12);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Í≥†Ìï¥ÏÉÅÎèÑ ÎîîÏä§ÌîåÎ†àÏù¥ ÏµúÏ†ÅÌôî */
        html {
            /* ÌÖçÏä§Ìä∏ Î†åÎçîÎßÅ ÏµúÏ†ÅÌôî */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            
            /* Í≥†Ìï¥ÏÉÅÎèÑ ÎîîÏä§ÌîåÎ†àÏù¥ ÏßÄÏõê */
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            
            /* ÌïòÎìúÏõ®Ïñ¥ Í∞ÄÏÜç */
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            
            /* ÌîΩÏÖÄ Î†åÎçîÎßÅ ÏµúÏ†ÅÌôî */
            image-rendering: -webkit-optimize-contrast;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            font-size: calc(14px * var(--font-scale));
            color: #3c4043;
            line-height: 1.4;
            
            /* ÌÖçÏä§Ìä∏ ÏÑ†Î™ÖÎèÑ Ìñ•ÏÉÅ */
            font-feature-settings: "liga", "kern";
            font-variant-ligatures: common-ligatures;
            font-kerning: auto;
            
            /* Î∂ÄÎìúÎü¨Ïö¥ Ïä§ÌÅ¨Î°§ÎßÅ */
            scroll-behavior: smooth;
        }

        .calendar-container {
            max-width: calc(1200px * var(--width-scale));
            width: 100%;
            height: auto;
            margin: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.12);
            border: 1px solid rgba(99, 132, 183, 0.2);
            transform-origin: center top;
            position: relative;
            z-index: 1;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 16px 0;
            background: transparent;
            border-radius: 0;
            position: relative;
            border-bottom: 1px solid #dadce0;
        }

        .date-selector {
            display: flex;
            gap: 8px;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .year-select, .month-select {
            font-size: calc(18px * var(--font-scale));
            font-weight: 500;
            color: var(--text-primary);
            background: var(--surface-hover);
            border: 1px solid var(--primary-medium);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(4px);
            box-shadow: var(--shadow-light);
        }

        .year-select:hover, .month-select:hover {
            background: var(--primary-light);
            border-color: var(--primary-border);
            box-shadow: var(--shadow-hover);
        }

        .year-select:focus, .month-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(99, 132, 183, 0.2);
        }

        .nav-btn {
            width: 40px;
            height: 40px;
            border: 1px solid rgba(99, 132, 183, 0.2);
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            color: #5f6368;
            font-size: calc(16px * var(--font-scale));
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-btn:hover {
            background: rgba(99, 132, 183, 0.1);
            border-color: rgba(99, 132, 183, 0.3);
            color: #3c4043;
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
        }

        .action-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: flex-end;
            border: 1px solid rgba(99, 132, 183, 0.15);
            backdrop-filter: blur(8px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .action-btn {
            padding: 10px 18px;
            border: 1px solid rgba(99, 132, 183, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            color: #3c4043;
            font-size: calc(13px * var(--font-scale));
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(4px);
        }

        .action-btn:hover {
            background: rgba(99, 132, 183, 0.1);
            border-color: rgba(99, 132, 183, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
        }

        /* ÏÉÅÌÉú Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ Ïä§ÌÉÄÏùº */
        .status-indicators {
            display: flex;
            gap: 15px;
            margin-left: auto;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e2e8f0;
            font-size: calc(12px * var(--font-scale));
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            min-width: 120px;
        }

        .status-indicator:hover {
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .status-icon {
            font-size: calc(14px * var(--font-scale));
        }

        .status-text {
            color: #2d3748;
            font-weight: 500;
        }

        /* Ïó∞Í≤∞ ÏÉÅÌÉúÎ≥Ñ ÏÉâÏÉÅ */
        .status-indicator.connected {
            background: rgba(72, 187, 120, 0.1);
            border-color: #48bb78;
            color: #2f855a;
        }

        .status-indicator.syncing {
            background: rgba(66, 153, 225, 0.1);
            border-color: #4299e1;
            color: #2b6cb0;
            animation: pulse 2s infinite;
        }

        .status-indicator.error {
            background: rgba(245, 101, 101, 0.1);
            border-color: #f56565;
            color: #c53030;
        }

        .status-indicator.warning {
            background: rgba(237, 137, 54, 0.1);
            border-color: #ed8936;
            color: #c05621;
        }

        /* Îã§ÌÅ¨ ÌÖåÎßà ÏßÄÏõê */
        [data-theme="dark"] .status-indicator {
            background: rgba(45, 55, 72, 0.9);
            border-color: #4a5568;
            color: #e2e8f0;
        }

        [data-theme="dark"] .status-text {
            color: #e2e8f0;
        }

        [data-theme="dark"] .status-indicator.connected {
            background: rgba(72, 187, 120, 0.2);
            border-color: #68d391;
            color: #68d391;
        }

        [data-theme="dark"] .status-indicator.syncing {
            background: rgba(66, 153, 225, 0.2);
            border-color: #63b3ed;
            color: #63b3ed;
        }

        [data-theme="dark"] .status-indicator.error {
            background: rgba(245, 101, 101, 0.2);
            border-color: #fc8181;
            color: #fc8181;
        }

        /* ÌéÑÏä§ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0;
            margin-bottom: 0;
            border-bottom: 1px solid #dadce0;
        }

        .weekday {
            text-align: center;
            padding: 12px 8px;
            font-size: calc(11px * var(--font-scale));
            font-weight: 500;
            background: transparent;
            color: #70757a;
            border-radius: 0;
            letter-spacing: 0;
            border: none;
            text-transform: uppercase;
        }

        .weekday.sunday {
            background: transparent;
            color: #70757a;
        }

        .weekday.saturday {
            background: transparent;
            color: #70757a;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0;
            border: 1px solid #dadce0;
            border-top: none;
        }

        .day {
            min-height: calc(120px * var(--height-scale));
            width: auto;
            padding: 8px;
            background: #ffffff;
            border-radius: 0;
            cursor: pointer;
            transition: background-color 0.1s ease;
            position: relative;
            box-sizing: border-box;
            border-right: 1px solid #dadce0;
            border-bottom: 1px solid #dadce0;
            box-shadow: none;
        }

        .day:nth-child(7n) {
            border-right: none;
        }

        .day:hover {
            background: #f1f3f4;
        }

        .day.other-month {
            opacity: 1;
            background: #ffffff;
            color: #9aa0a6;
        }

        .day.today {
            background: #ffffff;
            color: inherit;
            box-shadow: none;
            border-right: 1px solid #dadce0;
            border-bottom: 1px solid #dadce0;
        }

        .day.today .day-number {
            background: #1a73e8;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 400;
        }

        .day.holiday {
            background: #ffffff;
        }

        .day.sunday .day-number {
            color: #d93025;
            font-weight: 400;
        }

        .day.saturday .day-number {
            color: #3c4043;
            font-weight: 400;
        }

        .day-number {
            font-size: calc(13px * var(--font-scale));
            font-weight: 400;
            color: #3c4043;
            margin-bottom: 4px;
            line-height: 1;
            display: inline-block;
        }

        .holiday-label {
            font-size: calc(12px * var(--font-scale));
            color: #e53e3e;
            font-weight: 600;
            background: rgba(229, 62, 62, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 5px;
            text-align: center;
        }

        .memo-indicator {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, var(--primary-color) 0%, rgba(99, 132, 183, 0.8) 100%);
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(99, 132, 183, 0.4), 0 0 0 2px rgba(255, 255, 255, 0.8);
            animation: memoIndicatorPulse 2s infinite ease-in-out;
        }
        
        @keyframes memoIndicatorPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.3);
                opacity: 0.8;
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .memo-count {
            position: absolute;
            bottom: 6px;
            left: 6px;
            background: linear-gradient(135deg, var(--primary-color) 0%, rgba(99, 132, 183, 0.9) 100%);
            color: white;
            font-size: calc(10px * var(--font-scale));
            padding: 3px 6px;
            border-radius: 12px;
            font-weight: 600;
            min-width: 18px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(99, 132, 183, 0.3), 0 0 0 2px rgba(255, 255, 255, 0.8);
            line-height: 1.2;
            animation: memoCountBounce 0.3s ease-out;
        }
        
        @keyframes memoCountBounce {
            0% {
                transform: scale(0.8);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        [data-theme="dark"] .memo-count {
            background: rgba(144, 205, 244, 0.8);
            color: #1a202c;
        }

        .theme-toggle {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 40px;
            height: 40px;
            border: 1px solid #dadce0;
            border-radius: 50%;
            background: #ffffff;
            color: #5f6368;
            box-shadow: 0 1px 2px rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: calc(16px * var(--font-scale));
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            background: #f8f9fa;
            border-color: #dadce0;
        }

        /* Îã§ÌÅ¨ Î™®Îìú */
        [data-theme="dark"] body {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
        }

        [data-theme="dark"] .calendar-container {
            background: rgba(45, 55, 72, 0.95);
            color: white;
        }

        [data-theme="dark"] .day {
            background: #4a5568;
            color: white;
        }

        [data-theme="dark"] .day:hover {
            background: rgba(102, 126, 234, 0.3);
        }

        [data-theme="dark"] .day-number {
            color: white;
        }

        [data-theme="dark"] .month-year {
            color: #90cdf4;
        }

        /* Ïä§Ìã∞Ïª§ Î©îÎ™®Ïû• - Ï¥àÍ∏∞ÏóêÎäî Ïà®ÍπÄ */
        /* #stickyMemoÎäî JavaScriptÏóêÏÑú ÏßÅÏ†ë Ï†úÏñ¥ÌïòÎØÄÎ°ú Í∏∞Î≥∏ Ïä§ÌÉÄÏùº Ï†úÍ±∞ */
        
        .sticky-memo {
            position: fixed;
            z-index: 2000;
            width: 350px;
            height: 400px;
            min-width: 300px;
            min-height: 350px;
            max-width: 500px;
            max-height: 600px;
            
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            border-radius: 12px;
            border: 2px solid rgba(255, 193, 7, 0.4);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            
            /* ÌÅ¨Í∏∞ Ï°∞Ï†à */
            resize: both;
            overflow: hidden;
            
            /* Î†àÏù¥ÏïÑÏõÉ */
            display: flex;
            flex-direction: column;
            
            /* Í∞ÑÎã®Ìïú ÏµúÏ†ÅÌôîÎßå */
            transform: translateZ(0);
            will-change: auto;
        }

        .sticky-memo:hover {
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .sticky-memo.active {
            display: flex;
            z-index: 2001;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
            /* ÏúàÎèÑÏö∞ Ï∞ΩÏ≤òÎüº Î™®Îì† Ìä∏ÎûúÏßÄÏÖò Ï†úÍ±∞ */
        }


        .sticky-memo-header {
            background: rgba(255, 193, 7, 0.2);
            padding: 12px 15px;
            border-radius: 15px 15px 0 0;
            cursor: move;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 193, 7, 0.3);
        }

        .sticky-memo-title {
            font-size: calc(16px * var(--font-scale));
            font-weight: 700;
            color: #8b5a00;
            display: flex;
            align-items: center;
            gap: 8px;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        .sticky-memo-controls {
            display: flex;
            gap: 5px;
        }

        .sticky-control-btn {
            width: 24px !important;
            height: 24px !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 50% !important;
            cursor: pointer !important;
            font-size: 12px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
            backdrop-filter: blur(10px) !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
        }

        .sticky-minimize {
            background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%) !important;
            color: #8b5a00 !important;
        }

        .sticky-maximize {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important;
            color: white !important;
        }

        .sticky-close {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%) !important;
            color: white !important;
        }

        .sticky-control-btn:hover {
            transform: scale(1.15) translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
        }

        .sticky-memo-content {
            padding: 12px;
            height: calc(100% - 70px);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        /* ÏõπÌÇ∑ Î∏åÎùºÏö∞Ï†ÄÏö© Ïä§ÌÅ¨Î°§Î∞î Ïª§Ïä§ÌÑ∞ÎßàÏù¥Ïßï */
        .sticky-memo-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .sticky-memo-content::-webkit-scrollbar-track {
            background: rgba(255, 193, 7, 0.1);
            border-radius: 4px;
        }
        
        .sticky-memo-content::-webkit-scrollbar-thumb {
            background: rgba(255, 193, 7, 0.5);
            border-radius: 4px;
        }
        
        .sticky-memo-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 193, 7, 0.7);
        }
        
        /* Í∞ÑÎã®Ìïú resize Ìï∏Îì§ */
        .sticky-memo::-webkit-resizer {
            background: rgba(255, 193, 7, 0.3);
            border-radius: 0 0 12px 0;
        }
        

        .sticky-memo-form {
            margin-bottom: 8px;
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0; /* flex ÏïÑÏù¥ÌÖúÏù¥ Ï∂ïÏÜåÎê† Ïàò ÏûàÎèÑÎ°ù */
        }

        .sticky-memo-input {
            width: 100%;
            padding: 12px;
            border: none;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            font-size: calc(14px * var(--font-scale));
            font-family: 'Malgun Gothic', sans-serif;
            margin-bottom: 4px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .sticky-memo-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.5);
        }

        .sticky-memo-textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            border: none;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            font-size: calc(14px * var(--font-scale));
            font-family: 'Malgun Gothic', sans-serif;
            resize: vertical;
            margin-bottom: 4px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .sticky-memo-textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.5);
        }

        .sticky-memo-unified-textarea {
            width: 100%;
            flex: 1;
            min-height: 120px;
            padding: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 6px;
            font-size: calc(14px * var(--font-scale));
            font-family: 'Malgun Gothic', sans-serif;
            resize: none; /* Í∞úÎ≥Ñ resize ÎπÑÌôúÏÑ±Ìôî, Ï†ÑÏ≤¥ Ï∞Ω resizeÎßå ÏÇ¨Ïö© */
            margin-bottom: 4px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            line-height: 1.5;
        }

        .sticky-memo-unified-textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.5);
        }

        .sticky-memo-save-btn {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%) !important;
            color: #8b5a00 !important;
            border: none !important;
            padding: 12px 24px !important;
            border-radius: 20px !important;
            cursor: pointer !important;
            font-size: calc(14px * var(--font-scale)) !important;
            font-weight: 600 !important;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.6) !important;
            flex-shrink: 0 !important;
            align-self: center !important;
            position: relative !important;
            overflow: hidden !important;
        }

        .sticky-memo-save-btn:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.8) !important;
        }

        .sticky-memo-save-btn:active {
            transform: translateY(-1px) !important;
            box-shadow: 0 2px 10px rgba(255, 193, 7, 0.4) !important;
        }

        .sticky-memo-list {
            flex: 1;
            overflow-y: auto;
            margin-top: 10px;
        }

        .sticky-memo.minimized {
            min-height: 60px;
            height: 60px;
            width: 200px;
            overflow: hidden;
        }

        .sticky-memo.minimized .sticky-memo-content {
            display: none;
        }

        .sticky-memo.maximized {
            width: 90vw !important;
            height: 90vh !important;
            top: 5vh !important;
            left: 5vw !important;
        }

        /* Îã§ÌÅ¨ Î™®Îìú Ïä§Ìã∞Ïª§ Î©îÎ™® */
        [data-theme="dark"] .sticky-memo {
            background: linear-gradient(135deg, rgba(74, 85, 104, 0.95) 0%, rgba(45, 55, 72, 0.95) 100%) !important;
            backdrop-filter: blur(20px) saturate(180%) !important;
            border-color: rgba(144, 205, 244, 0.3) !important;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 8px 20px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
        }

        [data-theme="dark"] .sticky-memo-header {
            background: linear-gradient(135deg, rgba(144, 205, 244, 0.3) 0%, rgba(66, 153, 225, 0.2) 100%) !important;
            border-bottom-color: rgba(144, 205, 244, 0.2) !important;
            backdrop-filter: blur(10px) !important;
        }

        [data-theme="dark"] .sticky-memo-title {
            color: #90cdf4;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
        }

        [data-theme="dark"] .sticky-memo-input,
        [data-theme="dark"] .sticky-memo-textarea {
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border-color: rgba(144, 205, 244, 0.3);
        }

        [data-theme="dark"] .sticky-memo-input:focus,
        [data-theme="dark"] .sticky-memo-textarea:focus {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 2px rgba(144, 205, 244, 0.5);
        }

        [data-theme="dark"] .sticky-memo-unified-textarea {
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border-color: rgba(144, 205, 244, 0.3);
        }

        [data-theme="dark"] .sticky-memo-unified-textarea:focus {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 2px rgba(144, 205, 244, 0.5);
        }

        /* ÌÖçÏä§Ìä∏ Ìé∏ÏßëÍ∏∞ ÎèÑÍµ¨Î™®Ïùå */
        .text-editor-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            margin-bottom: 6px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            flex-shrink: 0; /* ÌÅ¨Í∏∞Í∞Ä Ï∂ïÏÜåÎêòÏßÄ ÏïäÎèÑÎ°ù */
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .toolbar-btn {
            padding: 6px 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .toolbar-btn:hover {
            background: #f5f5f5;
            border-color: #999;
        }

        .toolbar-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .color-picker {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .reset-color-btn {
            background: linear-gradient(135deg, #ff6b6b, #feca57) !important;
            color: white !important;
            font-weight: bold;
        }

        .reset-color-btn:hover {
            background: linear-gradient(135deg, #ff5252, #ff9f43) !important;
            transform: scale(1.05);
        }

        #fontFamilySelect, #fontSizeSelect {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 14px;
        }

        .sticky-memo-editor-container {
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .sticky-memo-rich-editor {
            width: 100%;
            flex: 1;
            min-height: 120px;
            padding: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 6px;
            font-size: calc(14px * var(--font-scale));
            font-family: 'Malgun Gothic', sans-serif;
            margin-bottom: 4px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            line-height: 1.5;
            overflow-y: auto;
            resize: none; /* Í∞úÎ≥Ñ resize ÎπÑÌôúÏÑ±Ìôî, Ï†ÑÏ≤¥ Ï∞Ω resizeÎßå ÏÇ¨Ïö© */
        }

        .sticky-memo-rich-editor:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.5);
        }

        .sticky-memo-rich-editor:empty:before {
            content: attr(data-placeholder);
            color: #999;
            white-space: pre-line;
        }

        .editor-toggle {
            text-align: center;
            margin-bottom: 4px;
            flex-shrink: 0; /* ÌÅ¨Í∏∞Í∞Ä Ï∂ïÏÜåÎêòÏßÄ ÏïäÎèÑÎ°ù */
        }

        .toggle-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #666;
        }

        .toggle-btn:hover {
            background: #e9ecef;
        }

        /* Îã§ÌÅ¨ ÌÖåÎßà ÏßÄÏõê */
        [data-theme="dark"] .text-editor-toolbar {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(144, 205, 244, 0.3);
        }

        [data-theme="dark"] .toolbar-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border-color: rgba(144, 205, 244, 0.3);
        }

        [data-theme="dark"] .toolbar-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        [data-theme="dark"] .toolbar-btn.active {
            background: #4299e1;
            border-color: #4299e1;
        }

        [data-theme="dark"] .color-picker {
            border-color: rgba(144, 205, 244, 0.3);
        }

        [data-theme="dark"] #fontFamilySelect, 
        [data-theme="dark"] #fontSizeSelect {
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border-color: rgba(144, 205, 244, 0.3);
        }

        [data-theme="dark"] .sticky-memo-rich-editor {
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border-color: rgba(144, 205, 244, 0.3);
        }

        [data-theme="dark"] .sticky-memo-rich-editor:focus {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 2px rgba(144, 205, 244, 0.5);
        }

        [data-theme="dark"] .toggle-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border-color: rgba(144, 205, 244, 0.3);
        }

        [data-theme="dark"] .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Ï≤®Î∂ÄÌååÏùº Í¥ÄÎ†® Ïä§ÌÉÄÏùº */
        .attachment-section {
            margin-top: 8px;
        }

        .file-input {
            display: none;
        }

        .btn-attachment {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-attachment:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-1px);
        }

        .attachment-list {
            margin-top: 8px;
            max-height: 120px;
            overflow-y: auto;
        }

        .attachment-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-bottom: 4px;
            font-size: 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .attachment-info {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            min-width: 0;
        }

        .attachment-name {
            color: #333;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
            flex: 1;
        }

        .attachment-size {
            color: #666;
            font-size: 10px;
            flex-shrink: 0;
        }

        .attachment-remove {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 2px 6px;
            font-size: 10px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .attachment-remove:hover {
            background: #ff3838;
        }

        .memo-attachment-section {
            margin: 8px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .memo-attachment-section .form-label {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 4px;
            display: block;
            color: #555;
        }

        /* Îã§ÌÅ¨ ÌÖåÎßà ÏßÄÏõê */
        [data-theme="dark"] .btn-attachment {
            background: linear-gradient(135deg, #52c41a, #389e0d);
        }

        [data-theme="dark"] .btn-attachment:hover {
            background: linear-gradient(135deg, #389e0d, #237804);
        }

        [data-theme="dark"] .attachment-item {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(144, 205, 244, 0.3);
        }

        [data-theme="dark"] .attachment-name {
            color: #e2e8f0;
        }

        [data-theme="dark"] .attachment-size {
            color: #a0aec0;
        }

        [data-theme="dark"] .memo-attachment-section {
            background: rgba(255, 255, 255, 0.02);
            border-color: rgba(144, 205, 244, 0.3);
        }

        [data-theme="dark"] .memo-attachment-section .form-label {
            color: #e2e8f0;
        }

        /* Î©îÎ™® ÏïÑÏù¥ÌÖúÏùò Ï≤®Î∂ÄÌååÏùº ÌëúÏãú */
        .memo-attachment-indicator {
            font-size: 10px;
            color: #4CAF50;
            font-weight: 600;
            margin-top: 2px;
            display: inline-flex;
            align-items: center;
            gap: 2px;
        }

        [data-theme="dark"] .memo-attachment-indicator {
            color: #52c41a;
        }

        [data-theme="dark"] .sticky-memo-save-btn {
            background: linear-gradient(135deg, #90cdf4 0%, #4299e1 100%) !important;
            color: #1a202c !important;
            box-shadow: 0 4px 15px rgba(144, 205, 244, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.6) !important;
        }

        [data-theme="dark"] .sticky-memo-save-btn:hover {
            box-shadow: 0 8px 25px rgba(144, 205, 244, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.8) !important;
        }

        [data-theme="dark"] .sticky-control-btn {
            border-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        [data-theme="dark"] .sticky-minimize {
            background: linear-gradient(135deg, #90cdf4 0%, #4299e1 100%) !important;
            color: #1a202c !important;
        }

        [data-theme="dark"] .sticky-maximize {
            background: linear-gradient(135deg, #68d391 0%, #38a169 100%) !important;
            color: white !important;
        }

        [data-theme="dark"] .sticky-close {
            background: linear-gradient(135deg, #fc8181 0%, #e53e3e 100%) !important;
            color: white !important;
        }

        .memo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 0 16px 0;
            margin: 0 0 20px 0;
            border-bottom: 1px solid #e8eaed;
            cursor: move;
            user-select: none;
            background: transparent;
            border-radius: 0;
        }
        
        .memo-header:hover {
            background: #f8f9fa;
        }
        
        .memo-modal-content.dragging {
            transform: translateZ(0);
            user-select: none;
        }
        
        .memo-header.dragging {
            cursor: grabbing !important;
            background: rgba(102, 126, 234, 0.2);
        }

        .memo-title {
            font-size: calc(18px * var(--font-scale));
            font-weight: 500;
            color: #3c4043;
            margin: 0;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-secondary);
            border: 1px solid var(--primary-medium);
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: calc(16px * var(--font-scale));
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
            box-shadow: var(--shadow-light);
        }

        .close-btn:hover {
            background: var(--primary-light);
            border-color: var(--primary-border);
            color: var(--text-primary);
            transform: scale(1.1) rotate(90deg);
            box-shadow: var(--shadow-hover);
        }

        .memo-form {
            margin-bottom: 20px;
        }

        .memo-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: calc(14px * var(--font-scale));
            margin-bottom: 12px;
            background: #ffffff;
            color: #3c4043;
            box-sizing: border-box;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .memo-input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 1px #1a73e8;
        }

        .memo-textarea {
            width: 100%;
            height: 150px;
            padding: 12px 16px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: calc(14px * var(--font-scale));
            resize: vertical;
            background: #ffffff;
            color: #3c4043;
            box-sizing: border-box;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .memo-textarea:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 1px #1a73e8;
        }

        .memo-save-btn {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 8px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: calc(14px * var(--font-scale));
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        .memo-save-btn:hover {
            background: #1557b0;
        }

        .memo-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .memo-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .memo-list-title {
            font-weight: 600;
            color: #667eea;
            font-size: 16px;
        }

        .memo-lock-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .memo-lock-toggle:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .memo-lock-toggle.unlocked {
            background: #e53e3e;
        }

        .memo-lock-toggle.unlocked:hover {
            background: #c53030;
        }

        .memo-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border-left: 4px solid #667eea;
        }

        .memo-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            border-left-color: #5a67d8;
        }

        .memo-item-title {
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
            font-size: calc(16px * var(--font-scale));
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .memo-item-title::before {
            content: "üìù";
            font-size: 14px;
        }

        .memo-item-content {
            color: #4a5568;
            font-size: calc(14px * var(--font-scale));
            line-height: 1.5;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .memo-item-date {
            font-size: calc(12px * var(--font-scale));
            color: #718096;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .memo-item-date::before {
            content: "üìÖ";
            font-size: 10px;
        }

        .memo-item-preview {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #667eea;
            font-size: 12px;
            background: rgba(102, 126, 234, 0.1);
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
        }

        .memo-item-delete {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #e53e3e;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .memo-item-delete:hover {
            background: #c53030;
            transform: scale(1.1);
        }

        .memo-item-delete.visible {
            display: flex;
        }

        .memo-item.unlocked .memo-item-preview {
            display: none;
        }

        .memo-item.unlocked {
            padding-right: 45px;
        }

        /* Î©îÎ™® Î™®Îã¨ Í∏∞Î≥∏ Ïä§ÌÉÄÏùº */
        .memo-modal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: radial-gradient(ellipse at center, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.3) 100%) !important;
            backdrop-filter: blur(8px);
            display: flex !important;
            justify-content: center;
            align-items: center;
            z-index: 99999 !important;
            padding: 24px;
            box-sizing: border-box;
            /* Î∂ÄÎìúÎü¨Ïö¥ Ïï†ÎãàÎ©îÏù¥ÏÖò */
            opacity: 1;
            visibility: visible;
            transition: all 0.4s ease;
        }

        /* Î©îÎ™® Î™®Îã¨ Îã´Í∏∞ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .memo-modal.closing {
            opacity: 0;
            visibility: hidden;
        }

        /* Î©îÎ™® Î™®Îã¨ Ïó¥Í∏∞ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .memo-modal.opening {
            opacity: 0;
            visibility: visible;
            animation: fadeIn 0.3s ease forwards;
            /* Ïï†ÎãàÎ©îÏù¥ÏÖò Ï§ëÏóêÎèÑ ÌÅ¥Î¶≠ Í∞ÄÎä•ÌïòÍ≤å */
            pointer-events: auto;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Ïï†ÎãàÎ©îÏù¥ÏÖò Ï§ëÏóêÎèÑ Îã´Í∏∞ Î≤ÑÌäºÏùÄ Ìï≠ÏÉÅ ÌÅ¥Î¶≠ Í∞ÄÎä• */
        .memo-modal .close-btn {
            pointer-events: auto !important;
            position: relative;
            z-index: 1000000 !important;
            cursor: pointer !important;
            user-select: none !important;
        }
        
        /* ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ X Î≤ÑÌäº ÌäπÎ≥Ñ Ï≤òÎ¶¨ */
        #closeDateMemo {
            pointer-events: auto !important;
            z-index: 1000001 !important;
            cursor: pointer !important;
            user-select: none !important;
        }
        
        /* Î©îÎ™® ÏÉÅÏÑ∏ Î™®Îã¨ X Î≤ÑÌäº ÌäπÎ≥Ñ Ï≤òÎ¶¨ */
        #closeMemoDetail {
            pointer-events: auto !important;
            z-index: 1000001 !important;
            cursor: pointer !important;
            user-select: none !important;
        }
        
        /* Î©îÎ™® ÏÉÅÏÑ∏ Î™®Îã¨ÏùÄ Îçî ÎÜíÏùÄ z-index */
        #memoDetailModal {
            z-index: 999999 !important;
        }

        .memo-modal-content {
            background: var(--surface-color);
            border-radius: 20px;
            padding: 32px;
            width: 100%;
            max-width: 600px;
            max-height: calc(100vh - 48px);
            overflow-y: auto;
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.2), 0 8px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--primary-medium);
            position: relative;
            margin: auto;
            transform: translateZ(0);
            backdrop-filter: blur(16px);
            animation: memoModalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes memoModalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.85) translateY(-40px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        /* ÎìúÎûòÍ∑∏ Ï§ëÏùº ÎïåÎäî absolute positioning ÏÇ¨Ïö© */
        .memo-modal-content.dragging {
            position: absolute !important;
            margin: 0 !important;
        }
        
        /* Î™®Îã¨Ïù¥ ÎìúÎûòÍ∑∏ÎêòÏñ¥ absolute positioningÎêú ÏÉÅÌÉú */
        .memo-modal.has-positioned-content {
            justify-content: flex-start;
            align-items: flex-start;
        }

        /* Îã§ÌÅ¨ Î™®Îìú Î©îÎ™® */
        [data-theme="dark"] .memo-modal-content {
            background: #2d3748;
            color: white;
        }

        [data-theme="dark"] .memo-input,
        [data-theme="dark"] .memo-textarea {
            background: #4a5568;
            border-color: #667eea;
            color: white;
        }

        [data-theme="dark"] .memo-item {
            background: #4a5568;
            border-color: #667eea;
            color: white;
            border-left-color: #90cdf4;
        }

        [data-theme="dark"] .memo-item:hover {
            background: #5a67d8;
            border-left-color: #bde7ff;
        }

        [data-theme="dark"] .memo-item-title {
            color: #e2e8f0;
        }

        [data-theme="dark"] .memo-item-content {
            color: #cbd5e0;
        }

        [data-theme="dark"] .memo-item-date {
            color: #a0aec0;
        }

        [data-theme="dark"] .memo-item-preview {
            background: rgba(144, 205, 244, 0.2);
            color: #90cdf4;
        }

        /* Îã§ÌÅ¨ Î™®Îìú Ïû†Í∏à/Ìï¥Ï†ú UI */
        [data-theme="dark"] .memo-list-header {
            background: rgba(144, 205, 244, 0.1);
        }

        [data-theme="dark"] .memo-list-title {
            color: #90cdf4;
        }

        [data-theme="dark"] .memo-lock-toggle {
            background: #90cdf4;
            color: #1a202c;
        }

        [data-theme="dark"] .memo-lock-toggle:hover {
            background: #bde7ff;
        }

        [data-theme="dark"] .memo-lock-toggle.unlocked {
            background: #fc8181;
            color: #1a202c;
        }

        [data-theme="dark"] .memo-lock-toggle.unlocked:hover {
            background: #feb2b2;
        }

        /* Î©îÎ™® ÏÉÅÏÑ∏Î≥¥Í∏∞ Ïä§ÌÉÄÏùº */
        .memo-detail-content {
            padding: 20px 0;
        }

        .memo-detail-date {
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 15px;
            padding: 8px 12px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 6px;
            display: inline-block;
        }

        .memo-detail-body {
            font-size: 16px;
            line-height: 1.6;
            color: #2d3748;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .memo-detail-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }

        /* Îã§ÌÅ¨ Î™®Îìú Î©îÎ™® ÏÉÅÏÑ∏Î≥¥Í∏∞ */
        [data-theme="dark"] .memo-detail-date {
            color: #90cdf4;
            background: rgba(144, 205, 244, 0.1);
        }

        [data-theme="dark"] .memo-detail-body {
            background: #4a5568;
            color: #e2e8f0;
            border-left-color: #90cdf4;
        }

        [data-theme="dark"] .memo-detail-actions {
            border-top-color: #4a5568;
        }

        /* ÏïåÎûå ÌåùÏóÖ Ïä§ÌÉÄÏùº - Î™®ÎçòÌïòÍ≥† ÍπîÎÅîÌïú ÎîîÏûêÏù∏ */
        .alarm-popup {
            position: fixed !important;
            top: 30px !important;
            right: 30px !important;
            background: rgba(255, 255, 255, 0.98) !important;
            backdrop-filter: blur(20px) !important;
            color: #2d3748 !important;
            padding: 0 !important;
            border-radius: 16px !important;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.6) !important;
            z-index: 9999 !important;
            min-width: 320px !important;
            max-width: 380px !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            animation: slideInScale 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
            border: 1px solid rgba(0, 0, 0, 0.08) !important;
            overflow: hidden !important;
        }

        .alarm-popup-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px 24px 16px 24px;
            margin: 0;
            border-radius: 16px 16px 0 0;
        }

        .alarm-popup-title {
            font-size: 16px;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
            letter-spacing: -0.025em;
        }

        .alarm-popup-title span:first-child {
            font-size: 20px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .alarm-popup-content {
            padding: 24px;
            background: white;
        }

        .alarm-popup-event-title {
            font-size: 18px;
            font-weight: 700;
            color: #1a202c;
            margin: 0 0 8px 0;
            line-height: 1.3;
            word-break: keep-all;
        }

        .alarm-popup-description {
            font-size: 14px;
            color: #4a5568;
            line-height: 1.5;
            margin: 0 0 16px 0;
            background: #f7fafc;
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .alarm-popup-time {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #718096;
            margin: 0 0 24px 0;
            font-weight: 500;
        }

        .alarm-popup-time::before {
            content: 'üïê';
            font-size: 16px;
        }

        .alarm-popup-actions {
            display: flex;
            gap: 12px;
            margin-top: auto;
        }

        .alarm-popup-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: -0.025em;
            position: relative;
            overflow: hidden;
        }

        .alarm-popup-btn:active {
            transform: scale(0.98);
        }

        .alarm-popup-btn.primary {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .alarm-popup-btn.primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .alarm-popup-btn.secondary {
            background: #edf2f7;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }

        .alarm-popup-btn.secondary:hover {
            background: #e2e8f0;
            color: #2d3748;
            border-color: #cbd5e0;
        }

        .alarm-popup-btn.danger {
            background: #fed7d7;
            color: #c53030;
            border: 1px solid #feb2b2;
            font-size: 13px;
            flex: 0.8;
        }

        .alarm-popup-btn.danger:hover {
            background: #feb2b2;
            color: #9b2c2c;
        }

        @keyframes slideInScale {
            0% {
                transform: translateX(100%) scale(0.8);
                opacity: 0;
            }
            60% {
                transform: translateX(-5%) scale(1.02);
                opacity: 0.9;
            }
            100% {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOutScale {
            0% {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateX(100%) scale(0.9);
                opacity: 0;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        .alarm-popup.fade-out {
            animation: fadeOutScale 0.3s cubic-bezier(0.4, 0, 1, 1) forwards !important;
        }

        /* ÌÅ¨Í∏∞ Ï°∞Ï†à Ïª®Ìä∏Î°§ Ïä§ÌÉÄÏùº */
        .size-control-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 60px;
        }

        .size-control-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .size-slider {
            flex: 1;
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .size-slider::-webkit-slider-thumb:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }

        .size-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .size-display {
            font-weight: 600;
            color: #667eea;
            min-width: 50px;
            text-align: center;
            font-size: 16px;
        }

        /* Îã§ÌÅ¨ Î™®Îìú ÌÅ¨Í∏∞ Ï°∞Ï†à */
        [data-theme="dark"] .size-control-btn {
            background: #90cdf4;
            color: #1a202c;
        }

        [data-theme="dark"] .size-control-btn:hover {
            background: #bde7ff;
        }

        [data-theme="dark"] .size-slider {
            background: #4a5568;
        }

        [data-theme="dark"] .size-slider::-webkit-slider-thumb {
            background: #90cdf4;
        }

        [data-theme="dark"] .size-slider::-webkit-slider-thumb:hover {
            background: #bde7ff;
        }

        [data-theme="dark"] .size-slider::-moz-range-thumb {
            background: #90cdf4;
        }

        [data-theme="dark"] .size-display {
            color: #90cdf4;
        }

        /* Í≥µÌÜµ Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .modal {
            display: none;
            position: fixed !important;
            z-index: 50000 !important;
            left: 0 !important;
            top: 0 !important;
            width: 100% !important;
            height: 100% !important;
            background: rgba(0, 0, 0, 0.4) !important;
        }

        .modal-content {
            background: var(--surface-color);
            margin: 8% auto;
            padding: 28px;
            border-radius: 16px;
            width: 90%;
            max-width: 560px;
            max-height: 85%;
            overflow-y: auto;
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15), 0 4px 16px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--primary-medium);
            backdrop-filter: blur(12px);
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--surface-border);
            background: linear-gradient(135deg, var(--primary-light) 0%, rgba(255, 255, 255, 0.3) 100%);
            margin: -28px -28px 24px -28px;
            padding: 20px 28px;
            border-radius: 16px 16px 0 0;
        }

        .modal-title {
            font-size: calc(20px * var(--font-scale));
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .modal-title::before {
            content: 'üìù';
            font-size: calc(22px * var(--font-scale));
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-secondary);
            border: 1px solid var(--primary-medium);
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: calc(16px * var(--font-scale));
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
            box-shadow: var(--shadow-light);
        }

        .modal-close:hover {
            background: var(--primary-light);
            border-color: var(--primary-border);
            color: var(--text-primary);
            transform: scale(1.1);
            box-shadow: var(--shadow-hover);
        }

        .form-group {
            margin-bottom: 24px;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 12px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: calc(14px * var(--font-scale));
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-label::before {
            content: attr(data-icon);
            font-size: calc(16px * var(--font-scale));
            opacity: 0.7;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 16px 20px;
            border: 1px solid var(--primary-medium);
            border-radius: 12px;
            font-size: calc(14px * var(--font-scale));
            background: var(--surface-hover);
            color: var(--text-primary);
            box-sizing: border-box;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
            box-shadow: var(--shadow-light);
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 132, 183, 0.2);
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-1px);
        }

        .form-input:hover, .form-textarea:hover, .form-select:hover {
            border-color: var(--primary-border);
            box-shadow: var(--shadow-medium);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
            line-height: 1.5;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, rgba(99, 132, 183, 0.9) 100%);
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 12px;
            cursor: pointer;
            font-size: calc(14px * var(--font-scale));
            font-weight: 600;
            margin-right: 16px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-medium);
            backdrop-filter: blur(4px);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, rgba(99, 132, 183, 0.9) 0%, var(--primary-color) 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(99, 132, 183, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(0);
            box-shadow: var(--shadow-light);
        }

        .btn-secondary {
            background: var(--surface-hover);
            color: var(--primary-color);
            border: 1px solid var(--primary-medium);
            padding: 12px 32px;
            border-radius: 12px;
            cursor: pointer;
            font-size: calc(14px * var(--font-scale));
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
            box-shadow: var(--shadow-light);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background: var(--primary-light);
            border-color: var(--primary-border);
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
            color: var(--text-primary);
        }
        
        .btn-secondary:active {
            transform: translateY(0);
            box-shadow: var(--shadow-light);
        }

        /* Ï§ëÎ≥µÎêú .btn-secondary Ï†ïÏùò Ï†úÍ±∞ */

        /* Îã§ÌÅ¨ Î™®Îìú Î™®Îã¨ */
        [data-theme="dark"] .modal-content {
            background: #2d3748;
            color: white;
        }

        [data-theme="dark"] .form-input,
        [data-theme="dark"] .form-textarea,
        [data-theme="dark"] .form-select {
            background: #4a5568;
            border-color: #667eea;
            color: white;
        }

        [data-theme="dark"] .form-label {
            color: #e2e8f0;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .calendar-container {
                margin: 10px;
                padding: 20px;
                max-width: calc(95vw * var(--width-scale));
                /* Îã¨Î†• Ïª®ÌÖåÏù¥ÎÑà ÌÅ¨Í∏∞Îäî Í∏ÄÏûêÌÅ¨Í∏∞ÏôÄ ÎèÖÎ¶ΩÏ†ÅÏúºÎ°ú Ïú†ÏßÄ */
            }
            
            .day {
                min-height: calc(80px * var(--height-scale));
                padding: 10px;
                /* ÎÇ†Ïßú ÏÖÄ ÎÜíÏù¥Îäî Í∏ÄÏûêÌÅ¨Í∏∞ÏôÄ ÎèÖÎ¶ΩÏ†ÅÏúºÎ°ú Ïú†ÏßÄ */
            }
            
            .day-number {
                font-size: calc(20px * var(--font-scale));
            }
            
            .month-year {
                font-size: calc(28px * var(--font-scale));
            }

            .memo-modal {
                padding: 10px;
            }
            
            .memo-modal-content {
                width: 95%;
                max-width: none;
                padding: 15px;
                max-height: calc(100vh - 20px);
            }
        }

        /* Í≥†Ìï¥ÏÉÅÎèÑ ÎîîÏä§ÌîåÎ†àÏù¥ ÏµúÏ†ÅÌôî (Retina, 4K, etc.) */
        @media only screen and (-webkit-min-device-pixel-ratio: 2),
               only screen and (min--moz-device-pixel-ratio: 2),
               only screen and (-o-min-device-pixel-ratio: 2/1),
               only screen and (min-device-pixel-ratio: 2),
               only screen and (min-resolution: 192dpi),
               only screen and (min-resolution: 2dppx) {
            
            /* ÌÖçÏä§Ìä∏ Î†åÎçîÎßÅ Í∞ïÌôî */
            body {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                text-rendering: optimizeLegibility;
                font-variant-ligatures: common-ligatures;
                font-feature-settings: "liga", "kern", "clig", "calt";
            }
            
            /* Í≥†Ìï¥ÏÉÅÎèÑÏóêÏÑú Îçî ÏÑ†Î™ÖÌïú Î≥¥Îçî */
            .day, .memo-item, .sticky-memo, .memo-modal-content {
                border-width: 0.5px;
            }
            
            /* ÏïÑÏù¥ÏΩòÍ≥º Ïù¥Î™®ÏßÄ ÏÑ†Î™ÖÎèÑ Ìñ•ÏÉÅ */
            .memo-item-title::before,
            .memo-item-date::before,
            .theme-toggle,
            .nav-btn,
            .action-btn {
                text-shadow: 0 0 1px rgba(0,0,0,0.1);
                -webkit-font-smoothing: antialiased;
            }
            
            /* Í∑∏Î¶ºÏûê Ìö®Í≥º ÏÑ∏Î∞ÄÌôî */
            .calendar-container {
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08),
                           0 20px 40px rgba(0, 0, 0, 0.06);
            }
            
            .day:hover {
                box-shadow: 0 2.5px 7.5px rgba(0, 0, 0, 0.08);
            }
            
            /* Î≤ÑÌäº Ìò∏Î≤Ñ Ìö®Í≥º ÏÑ∏Î∞ÄÌôî */
            .action-btn:hover, .nav-btn:hover {
                transform: translateY(-1px);
                box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
            }
        }

        /* Ï¥àÍ≥†Ìï¥ÏÉÅÎèÑ ÎîîÏä§ÌîåÎ†àÏù¥ (4K+) */
        @media only screen and (min-resolution: 300dpi),
               only screen and (min-resolution: 3dppx) {
            
            /* Ìè∞Ìä∏ ÌÅ¨Í∏∞ ÎØ∏ÏÑ∏ Ï°∞Ï†ï */
            body {
                font-size: calc(16px * var(--font-scale) * 0.98);
            }
            
            /* ÎçîÏö± ÏÑ∏Î∞ÄÌïú Í∞ÑÍ≤© Ï°∞Ï†ï */
            .day {
                padding: 12px;
            }
            
            .memo-item {
                padding: 12px;
                margin-bottom: 8px;
            }
            
            /* Ï¥àÎØ∏ÏÑ∏ Í∑∏Î¶ºÏûê */
            .calendar-container {
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.04),
                           0 10px 20px rgba(0, 0, 0, 0.03),
                           0 20px 40px rgba(0, 0, 0, 0.02);
            }
        }
    </style>
    <!-- Google API Scripts -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
</head>
<body>
    <div class="calendar-container">
        <div class="calendar-header">
            <button class="nav-btn" onclick="changeMonth(-1)">‚Äπ</button>
            <div class="date-selector">
                <select id="yearSelect" class="year-select" onchange="changeDate()"></select>
                <select id="monthSelect" class="month-select" onchange="changeDate()"></select>
            </div>
            <button class="nav-btn" onclick="changeMonth(1)">‚Ä∫</button>
        </div>

        <div class="action-bar">
            <button class="action-btn" id="createBtn">‚ûï ÏùºÏ†ï Ï∂îÍ∞Ä</button>
            <button class="action-btn" id="memoBtn">üìù Ïä§Ìã∞Ïª§</button>
            <button class="action-btn" id="excelBtn">üìä ÏóëÏÖÄ</button>
            <button class="action-btn" id="unifiedCloudBtn">‚òÅÔ∏è ÌÅ¥ÎùºÏö∞Îìú ÏÑ§Ï†ï</button>
            <button class="action-btn" id="syncStatusBtn">üîç ÎèôÍ∏∞Ìôî ÏÉÅÌÉú</button>
            <button class="action-btn" id="settingsBtn">‚öôÔ∏è ÏÑ§Ï†ï</button>
            <button class="action-btn" id="storageBtn">üóÑÔ∏è Ï†ÄÏû•ÏÜå</button>
            
            <!-- ÏÉÅÌÉú Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ -->
            <div class="status-indicators">
                <div class="status-indicator" id="driveStatus" title="Íµ¨Í∏Ä ÎìúÎùºÏù¥Î∏å Ïó∞Í≤∞ ÏÉÅÌÉú">
                    <span class="status-icon">‚ùå</span>
                    <span class="status-text">Ïó∞Í≤∞ ÏïàÎê®</span>
                </div>
                <div class="status-indicator" id="syncStatus" title="ÎèôÍ∏∞Ìôî ÏÉÅÌÉú">
                    <span class="status-icon">‚è∏Ô∏è</span>
                    <span class="status-text">ÎåÄÍ∏∞Ï§ë</span>
                </div>
            </div>
        </div>

        <div class="weekdays">
            <div class="weekday sunday">Ïùº</div>
            <div class="weekday">Ïõî</div>
            <div class="weekday">Ìôî</div>
            <div class="weekday">Ïàò</div>
            <div class="weekday">Î™©</div>
            <div class="weekday">Í∏à</div>
            <div class="weekday saturday">ÌÜ†</div>
        </div>

        <div class="days-grid" id="daysGrid"></div>
    </div>

    <button class="theme-toggle" id="themeToggle">üåô</button>


    <!-- ÏÉùÏÑ± Î™®Îìú Î™®Îã¨ -->
    <div class="modal" id="createModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚ûï ÏÉà ÏùºÏ†ï ÏÉùÏÑ±</h2>
                <button class="modal-close" onclick="closeModal('createModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ÏùºÏ†ï Ï†úÎ™©</label>
                    <input type="text" class="form-input" id="scheduleTitle" placeholder="ÏùºÏ†ï Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                <div class="form-group">
                    <label class="form-label">ÎÇ†Ïßú</label>
                    <input type="date" class="form-input" id="scheduleDate">
                </div>
                <div class="form-group">
                    <label class="form-label">ÏãúÍ∞Ñ</label>
                    <input type="time" class="form-input" id="scheduleTime">
                </div>
                <div class="form-group">
                    <label class="form-label">ÏÑ§Î™Ö</label>
                    <textarea class="form-textarea" id="scheduleDescription" placeholder="ÏùºÏ†ï ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">‚è∞ ÏïåÎûå ÏÑ§Ï†ï</label>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <input type="checkbox" id="enableAlarm" style="margin: 0;">
                        <label for="enableAlarm" style="margin: 0; font-weight: normal;">ÏïåÎûå ÌôúÏÑ±Ìôî</label>
                    </div>
                    <div id="alarmSettings" style="display: none; margin-left: 20px;">
                        <div style="margin-bottom: 10px;">
                            <label class="form-label" style="margin-bottom: 5px;">ÏïåÎûå ÏãúÍ∞Ñ</label>
                            <select class="form-select" id="alarmMinutes" style="width: 200px;">
                                <option value="0">‚ö° Î∞îÎ°ú ÌôúÏÑ±Ìôî (ÏßÄÏ†ï ÏãúÍ∞ÑÏóê)</option>
                                <option value="5">5Î∂Ñ Ï†Ñ</option>
                                <option value="10">10Î∂Ñ Ï†Ñ</option>
                                <option value="15" selected>15Î∂Ñ Ï†Ñ</option>
                                <option value="30">30Î∂Ñ Ï†Ñ</option>
                                <option value="60">1ÏãúÍ∞Ñ Ï†Ñ</option>
                                <option value="120">2ÏãúÍ∞Ñ Ï†Ñ</option>
                                <option value="1440">1Ïùº Ï†Ñ</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label class="form-label" style="margin-bottom: 5px;">ÏïåÎûå Î©îÏãúÏßÄ</label>
                            <input type="text" class="form-input" id="alarmMessage" placeholder="ÏïåÎûå Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏÑ†ÌÉùÏÇ¨Ìï≠)" style="font-size: 14px;">
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label class="form-label" style="margin-bottom: 5px;">‚è∞ Î∞òÎ≥µ ÏïåÎûå ÏÑ§Ï†ï</label>
                            <select class="form-select" id="alarmRepeat" style="width: 200px;">
                                <option value="none">Ìïú Î≤àÎßå</option>
                                <option value="1">1Î∂ÑÎßàÎã§ Î∞òÎ≥µ</option>
                                <option value="5">5Î∂ÑÎßàÎã§ Î∞òÎ≥µ</option>
                                <option value="10">10Î∂ÑÎßàÎã§ Î∞òÎ≥µ</option>
                                <option value="15">15Î∂ÑÎßàÎã§ Î∞òÎ≥µ</option>
                                <option value="30">30Î∂ÑÎßàÎã§ Î∞òÎ≥µ</option>
                                <option value="60">1ÏãúÍ∞ÑÎßàÎã§ Î∞òÎ≥µ</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">üìé Ï≤®Î∂ÄÌååÏùº</label>
                    <div class="attachment-section">
                        <input type="file" id="scheduleAttachment" multiple accept="*/*" class="file-input">
                        <button type="button" class="btn-attachment" onclick="document.getElementById('scheduleAttachment').click()">
                            üìé ÌååÏùº ÏÑ†ÌÉù
                        </button>
                        <div id="scheduleAttachmentList" class="attachment-list"></div>
                    </div>
                </div>
                <button class="btn-primary" onclick="saveSchedule()">ÏùºÏ†ï Ï∂îÍ∞Ä</button>
                <button class="btn-secondary" onclick="closeModal('createModal')">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>

    <!-- ÏóëÏÖÄ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Î™®Îã¨ -->
    <div class="modal" id="excelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìä ÏóëÏÖÄ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</h2>
                <button class="modal-close" onclick="closeModal('excelModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">üìÖ ÎÇ¥Î≥¥ÎÇº Í∏∞Í∞Ñ</label>
                    <select class="form-select" id="exportPeriod">
                        <option value="current">ÌòÑÏû¨ Ïõî (2025ÎÖÑ 8Ïõî)</option>
                        <option value="quarter">ÌòÑÏû¨ Î∂ÑÍ∏∞ (2025ÎÖÑ 3Î∂ÑÍ∏∞)</option>
                        <option value="half">ÌòÑÏû¨ Î∞òÍ∏∞ (2025ÎÖÑ ÌïòÎ∞òÍ∏∞)</option>
                        <option value="year">ÌòÑÏû¨ ÎÖÑÎèÑ (2025ÎÖÑ Ï†ÑÏ≤¥)</option>
                        <option value="custom">ÏÇ¨Ïö©Ïûê ÏßÄÏ†ï Í∏∞Í∞Ñ</option>
                    </select>
                </div>

                <div id="customPeriod" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">ÏãúÏûë ÎÇ†Ïßú</label>
                        <input type="date" class="form-input" id="startDate" value="2025-08-01">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ï¢ÖÎ£å ÎÇ†Ïßú</label>
                        <input type="date" class="form-input" id="endDate" value="2025-08-31">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üìã Ìè¨Ìï®Ìï† Ìï≠Î™©</label>
                    <div style="margin-left: 20px;">
                        <label><input type="checkbox" id="includeHolidays" checked> Í≥µÌú¥Ïùº</label><br>
                        <label><input type="checkbox" id="includeWeekends" checked> Ï£ºÎßê ÌëúÏãú</label><br>
                        <label><input type="checkbox" id="includeMemos" checked> Î©îÎ™®</label><br>
                        <label><input type="checkbox" id="includeSchedules"> ÏùºÏ†ï</label><br>
                        <label><input type="checkbox" id="includeWeekNumber"> Ï£ºÏ∞® Î≤àÌò∏</label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üìÑ ÌååÏùº ÌòïÏãù</label>
                    <select class="form-select" id="fileFormat">
                        <option value="csv">CSV (ÏóëÏÖÄ Ìò∏Ìôò)</option>
                        <option value="xlsx">XLSX (ÏóëÏÖÄ 2007+)</option>
                        <option value="json">JSON (Îç∞Ïù¥ÌÑ∞ ÌòïÏãù)</option>
                        <option value="ics">ICS (Ï∫òÎ¶∞Îçî ÌòïÏãù)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">üåê Ïñ∏Ïñ¥</label>
                    <select class="form-select" id="exportLanguage">
                        <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                        <option value="en">English</option>
                        <option value="ko-en">ÌïúÍµ≠Ïñ¥ + English</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">üé® Ïä§ÌÉÄÏùº ÏòµÏÖò</label>
                    <div style="margin-left: 20px;">
                        <label><input type="checkbox" id="colorCoding" checked> ÏÉâÏÉÅ ÏΩîÎî© (Ï£ºÎßê/Í≥µÌú¥Ïùº)</label><br>
                        <label><input type="checkbox" id="includeSummary" checked> ÏõîÎ≥Ñ ÏöîÏïΩ Ìè¨Ìï®</label><br>
                        <label><input type="checkbox" id="includeHeader" checked> Ìó§Îçî Ìè¨Ìï®</label>
                    </div>
                </div>

                <button class="btn-primary" onclick="processExcelExport()">üì• ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                <button class="btn-secondary" onclick="previewExcelData()">üëÅÔ∏è ÎØ∏Î¶¨Î≥¥Í∏∞</button>
                <button class="btn-secondary" onclick="closeModal('excelModal')">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>

    <!-- ÏÑ§Ï†ï Î™®Îã¨ -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚öôÔ∏è ÏÑ§Ï†ï</h2>
                <button class="modal-close" onclick="cancelSettings()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ÌÖåÎßà</label>
                    <select class="form-select" id="themeSelect">
                        <option value="light">ÎùºÏù¥Ìä∏ Î™®Îìú</option>
                        <option value="dark">Îã§ÌÅ¨ Î™®Îìú</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ï†ÑÏ≤¥ Í∏ÄÏûê ÌÅ¨Í∏∞</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button type="button" class="size-control-btn" onclick="adjustFontSize(-0.1)">Ï∂ïÏÜå</button>
                        <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                            <input type="range" class="size-slider" id="fontSizeSlider" min="0.7" max="1.5" step="0.1" value="1.0">
                            <span class="size-display" id="fontSizeDisplay">100%</span>
                        </div>
                        <button type="button" class="size-control-btn" onclick="adjustFontSize(0.1)">ÌôïÎåÄ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ÏùºÏûê Ïà´Ïûê ÌÅ¨Í∏∞</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button type="button" class="size-control-btn" onclick="adjustDateSize(-0.1)">Ï∂ïÏÜå</button>
                        <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                            <input type="range" class="size-slider" id="dateSizeSlider" min="0.7" max="1.8" step="0.1" value="1.0">
                            <span class="size-display" id="dateSizeDisplay">100%</span>
                        </div>
                        <button type="button" class="size-control-btn" onclick="adjustDateSize(0.1)">ÌôïÎåÄ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Îã¨Î†• Í∞ÄÎ°ú ÌÅ¨Í∏∞</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button type="button" class="size-control-btn" onclick="adjustCalendarSize('width', -0.1)">Ï∂ïÏÜå</button>
                        <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                            <input type="range" class="size-slider" id="widthSlider" min="0.5" max="2.0" step="0.1" value="1.0">
                            <span class="size-display" id="widthDisplay">100%</span>
                        </div>
                        <button type="button" class="size-control-btn" onclick="adjustCalendarSize('width', 0.1)">ÌôïÎåÄ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Îã¨Î†• ÏÑ∏Î°ú ÌÅ¨Í∏∞</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button type="button" class="size-control-btn" onclick="adjustCalendarSize('height', -0.1)">Ï∂ïÏÜå</button>
                        <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                            <input type="range" class="size-slider" id="heightSlider" min="0.5" max="2.0" step="0.1" value="1.0">
                            <span class="size-display" id="heightDisplay">100%</span>
                        </div>
                        <button type="button" class="size-control-btn" onclick="adjustCalendarSize('height', 0.1)">ÌôïÎåÄ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Ï£º ÏãúÏûëÏùº</label>
                    <select class="form-select">
                        <option selected>ÏùºÏöîÏùº</option>
                        <option>ÏõîÏöîÏùº</option>
                    </select>
                </div>
                <button class="btn-primary" onclick="saveSettings()">ÏÑ§Ï†ï Ï†ÄÏû•</button>
                <button class="btn-secondary" onclick="cancelSettings()">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>

    <!-- Ïä§Ìã∞Ïª§ Î©îÎ™®Ïû•ÏùÄ JavaScriptÏóêÏÑú ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê® -->

    <!-- Î©îÎ™® ÏÉÅÏÑ∏Î≥¥Í∏∞ Î™®Îã¨ -->
    <div class="memo-modal" id="memoDetailModal" style="display: none;">
        <div class="memo-modal-content">
            <div class="memo-header">
                <h2 class="memo-title" id="memoDetailTitle">üìã Î©îÎ™® ÏÉÅÏÑ∏</h2>
                <button class="close-btn" id="closeMemoDetail">‚úï</button>
            </div>

            <div class="memo-detail-content">
                <div class="memo-detail-date" id="memoDetailDate"></div>
                <div class="memo-detail-body" id="memoDetailBody"></div>
                <div class="memo-detail-attachments" id="memoDetailAttachments" style="display: none;">
                    <h4>üìé Ï≤®Î∂ÄÌååÏùº</h4>
                    <div class="attachment-list"></div>
                </div>
                <div class="memo-detail-actions">
                    <button class="btn-primary" id="editMemoBtn">‚úèÔ∏è Ìé∏Ïßë</button>
                    <button class="btn-secondary" id="deleteMemoBtn">üóëÔ∏è ÏÇ≠Ï†ú</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® Î™®Îã¨ -->
    <div class="memo-modal" id="dateMemoModal" style="display: none;">
        <div class="memo-modal-content">
            <div class="memo-header">
                <h2 class="memo-title" id="dateMemoTitle">üìÖ ÎÇ†Ïßú Î©îÎ™®</h2>
                <button class="close-btn" id="closeDateMemo">‚úï</button>
            </div>

            <div class="memo-form">
                <input type="text" class="memo-input" id="dateMemoTitleInput" placeholder="Î©îÎ™® Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">
                <textarea class="memo-textarea" id="dateMemoContentInput" placeholder="Î©îÎ™® ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
                <div class="memo-attachment-section">
                    <label class="form-label">üìé Ï≤®Î∂ÄÌååÏùº</label>
                    <div class="attachment-section">
                        <input type="file" id="dateMemoAttachment" multiple accept="*/*" class="file-input">
                        <button type="button" class="btn-attachment" onclick="document.getElementById('dateMemoAttachment').click()">
                            üìé ÌååÏùº ÏÑ†ÌÉù
                        </button>
                        <div id="dateMemoAttachmentList" class="attachment-list"></div>
                    </div>
                </div>
                <button class="memo-save-btn" id="saveDateMemo">üíæ Ï†ÄÏû•</button>
            </div>

            <div class="memo-list-header">
                <div class="memo-list-title">üìÖ Ïù¥ ÎÇ†ÏßúÏùò Î©îÎ™®</div>
                <button class="memo-lock-toggle" id="dateMemoLockToggle">
                    <span class="lock-icon">üîí</span>
                    <span class="lock-text">Ïû†Í∏à</span>
                </button>
            </div>

            <div class="memo-list" id="dateMemoList">
                <!-- Ìï¥Îãπ ÎÇ†ÏßúÏùò Î©îÎ™®Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
            </div>
        </div>
    </div>

    <script>
        // ÌïúÍµ≠ Í≥µÌú¥Ïùº Îç∞Ïù¥ÌÑ∞ (2020-2030)
        const koreanHolidays = {
            2020: {
                '1-1': 'Ïã†Ï†ï', '1-24': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '1-25': 'ÏÑ§ÎÇ†', '1-26': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '1-27': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
                '3-1': 'ÏÇºÏùºÏ†à', '4-15': 'Íµ≠ÌöåÏùòÏõêÏÑ†Í±∞', '4-30': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†', '5-5': 'Ïñ¥Î¶∞Ïù¥ÎÇ†',
                '6-6': 'ÌòÑÏ∂©Ïùº', '8-15': 'Í¥ëÎ≥µÏ†à', '9-30': 'Ï∂îÏÑùÏó∞Ìú¥', '10-1': 'Ï∂îÏÑù', '10-2': 'Ï∂îÏÑùÏó∞Ìú¥',
                '10-3': 'Í∞úÏ≤úÏ†à', '10-9': 'ÌïúÍ∏ÄÎÇ†', '12-25': 'ÏÑ±ÌÉÑÏ†à'
            },
            2021: {
                '1-1': 'Ïã†Ï†ï', '2-11': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '2-12': 'ÏÑ§ÎÇ†', '2-13': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
                '3-1': 'ÏÇºÏùºÏ†à', '5-5': 'Ïñ¥Î¶∞Ïù¥ÎÇ†', '5-19': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†', '6-6': 'ÌòÑÏ∂©Ïùº',
                '8-15': 'Í¥ëÎ≥µÏ†à', '9-20': 'Ï∂îÏÑùÏó∞Ìú¥', '9-21': 'Ï∂îÏÑù', '9-22': 'Ï∂îÏÑùÏó∞Ìú¥',
                '10-3': 'Í∞úÏ≤úÏ†à', '10-4': 'Í∞úÏ≤úÏ†à ÎåÄÏ≤¥Ìú¥Ïùº', '10-9': 'ÌïúÍ∏ÄÎÇ†', '10-11': 'ÌïúÍ∏ÄÎÇ† ÎåÄÏ≤¥Ìú¥Ïùº', '12-25': 'ÏÑ±ÌÉÑÏ†à'
            },
            2022: {
                '1-1': 'Ïã†Ï†ï', '1-31': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '2-1': 'ÏÑ§ÎÇ†', '2-2': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
                '3-1': 'ÏÇºÏùºÏ†à', '5-5': 'Ïñ¥Î¶∞Ïù¥ÎÇ†', '5-8': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†', '6-6': 'ÌòÑÏ∂©Ïùº',
                '8-15': 'Í¥ëÎ≥µÏ†à', '9-9': 'Ï∂îÏÑùÏó∞Ìú¥', '9-10': 'Ï∂îÏÑù', '9-11': 'Ï∂îÏÑùÏó∞Ìú¥', '9-12': 'Ï∂îÏÑùÏó∞Ìú¥',
                '10-3': 'Í∞úÏ≤úÏ†à', '10-9': 'ÌïúÍ∏ÄÎÇ†', '10-10': 'ÌïúÍ∏ÄÎÇ† ÎåÄÏ≤¥Ìú¥Ïùº', '12-25': 'ÏÑ±ÌÉÑÏ†à'
            },
            2023: {
                '1-1': 'Ïã†Ï†ï', '1-21': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '1-22': 'ÏÑ§ÎÇ†', '1-23': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '1-24': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
                '3-1': 'ÏÇºÏùºÏ†à', '5-5': 'Ïñ¥Î¶∞Ïù¥ÎÇ†', '5-27': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†', '6-6': 'ÌòÑÏ∂©Ïùº',
                '8-15': 'Í¥ëÎ≥µÏ†à', '9-28': 'Ï∂îÏÑùÏó∞Ìú¥', '9-29': 'Ï∂îÏÑù', '9-30': 'Ï∂îÏÑùÏó∞Ìú¥',
                '10-3': 'Í∞úÏ≤úÏ†à', '10-9': 'ÌïúÍ∏ÄÎÇ†', '12-25': 'ÏÑ±ÌÉÑÏ†à'
            },
            2024: {
                '1-1': 'Ïã†Ï†ï', '2-9': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '2-10': 'ÏÑ§ÎÇ†', '2-11': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '2-12': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
                '3-1': 'ÏÇºÏùºÏ†à', '4-10': 'Íµ≠ÌöåÏùòÏõêÏÑ†Í±∞', '5-5': 'Ïñ¥Î¶∞Ïù¥ÎÇ†', '5-6': 'Ïñ¥Î¶∞Ïù¥ÎÇ† ÎåÄÏ≤¥Ìú¥Ïùº', '5-15': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†',
                '6-6': 'ÌòÑÏ∂©Ïùº', '8-15': 'Í¥ëÎ≥µÏ†à', '9-16': 'Ï∂îÏÑùÏó∞Ìú¥', '9-17': 'Ï∂îÏÑù', '9-18': 'Ï∂îÏÑùÏó∞Ìú¥',
                '10-3': 'Í∞úÏ≤úÏ†à', '10-9': 'ÌïúÍ∏ÄÎÇ†', '12-25': 'ÏÑ±ÌÉÑÏ†à'
            },
            2025: {
                '1-1': 'Ïã†Ï†ï', '1-28': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '1-29': 'ÏÑ§ÎÇ†', '1-30': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
                '3-1': 'ÏÇºÏùºÏ†à', '5-5': 'Ïñ¥Î¶∞Ïù¥ÎÇ†', '5-6': 'Ïñ¥Î¶∞Ïù¥ÎÇ† ÎåÄÏ≤¥Ìú¥Ïùº', '6-6': 'ÌòÑÏ∂©Ïùº',
                '8-15': 'Í¥ëÎ≥µÏ†à', '9-6': 'Ï∂îÏÑùÏó∞Ìú¥', '9-7': 'Ï∂îÏÑùÏó∞Ìú¥', '9-8': 'Ï∂îÏÑù', '9-9': 'Ï∂îÏÑùÏó∞Ìú¥',
                '10-3': 'Í∞úÏ≤úÏ†à', '10-6': 'Í∞úÏ≤úÏ†à ÎåÄÏ≤¥Ìú¥Ïùº', '10-9': 'ÌïúÍ∏ÄÎÇ†', '12-25': 'ÏÑ±ÌÉÑÏ†à'
            },
            2026: {
                '1-1': 'Ïã†Ï†ï', '2-16': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '2-17': 'ÏÑ§ÎÇ†', '2-18': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
                '3-1': 'ÏÇºÏùºÏ†à', '5-5': 'Ïñ¥Î¶∞Ïù¥ÎÇ†', '5-24': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†', '6-6': 'ÌòÑÏ∂©Ïùº',
                '8-15': 'Í¥ëÎ≥µÏ†à', '9-24': 'Ï∂îÏÑùÏó∞Ìú¥', '9-25': 'Ï∂îÏÑù', '9-26': 'Ï∂îÏÑùÏó∞Ìú¥',
                '10-3': 'Í∞úÏ≤úÏ†à', '10-5': 'Í∞úÏ≤úÏ†à ÎåÄÏ≤¥Ìú¥Ïùº', '10-9': 'ÌïúÍ∏ÄÎÇ†', '12-25': 'ÏÑ±ÌÉÑÏ†à'
            },
            2027: {
                '1-1': 'Ïã†Ï†ï', '2-6': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '2-7': 'ÏÑ§ÎÇ†', '2-8': 'ÏÑ§ÎÇ†', '2-9': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
                '3-1': 'ÏÇºÏùºÏ†à', '5-5': 'Ïñ¥Î¶∞Ïù¥ÎÇ†', '5-13': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†', '6-6': 'ÌòÑÏ∂©Ïùº',
                '8-15': 'Í¥ëÎ≥µÏ†à', '9-14': 'Ï∂îÏÑùÏó∞Ìú¥', '9-15': 'Ï∂îÏÑù', '9-16': 'Ï∂îÏÑùÏó∞Ìú¥',
                '10-3': 'Í∞úÏ≤úÏ†à', '10-4': 'Í∞úÏ≤úÏ†à ÎåÄÏ≤¥Ìú¥Ïùº', '10-9': 'ÌïúÍ∏ÄÎÇ†', '10-11': 'ÌïúÍ∏ÄÎÇ† ÎåÄÏ≤¥Ìú¥Ïùº', '12-25': 'ÏÑ±ÌÉÑÏ†à'
            },
            2028: {
                '1-1': 'Ïã†Ï†ï', '1-26': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '1-27': 'ÏÑ§ÎÇ†', '1-28': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
                '3-1': 'ÏÇºÏùºÏ†à', '5-2': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†', '5-5': 'Ïñ¥Î¶∞Ïù¥ÎÇ†', '6-6': 'ÌòÑÏ∂©Ïùº',
                '8-15': 'Í¥ëÎ≥µÏ†à', '10-2': 'Ï∂îÏÑùÏó∞Ìú¥', '10-3': 'Ï∂îÏÑù', '10-4': 'Ï∂îÏÑùÏó∞Ìú¥',
                '10-5': 'Í∞úÏ≤úÏ†à ÎåÄÏ≤¥Ìú¥Ïùº', '10-9': 'ÌïúÍ∏ÄÎÇ†', '12-25': 'ÏÑ±ÌÉÑÏ†à'
            },
            2029: {
                '1-1': 'Ïã†Ï†ï', '2-12': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '2-13': 'ÏÑ§ÎÇ†', '2-14': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
                '3-1': 'ÏÇºÏùºÏ†à', '5-5': 'Ïñ¥Î¶∞Ïù¥ÎÇ†', '5-20': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†', '6-6': 'ÌòÑÏ∂©Ïùº',
                '8-15': 'Í¥ëÎ≥µÏ†à', '9-21': 'Ï∂îÏÑùÏó∞Ìú¥', '9-22': 'Ï∂îÏÑù', '9-23': 'Ï∂îÏÑùÏó∞Ìú¥', '9-24': 'Ï∂îÏÑùÏó∞Ìú¥',
                '10-3': 'Í∞úÏ≤úÏ†à', '10-9': 'ÌïúÍ∏ÄÎÇ†', '12-25': 'ÏÑ±ÌÉÑÏ†à'
            },
            2030: {
                '1-1': 'Ïã†Ï†ï', '2-2': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '2-3': 'ÏÑ§ÎÇ†', '2-4': 'ÏÑ§ÎÇ†Ïó∞Ìú¥', '2-5': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
                '3-1': 'ÏÇºÏùºÏ†à', '5-5': 'Ïñ¥Î¶∞Ïù¥ÎÇ†', '5-6': 'Ïñ¥Î¶∞Ïù¥ÎÇ† ÎåÄÏ≤¥Ìú¥Ïùº', '5-9': 'Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†',
                '6-6': 'ÌòÑÏ∂©Ïùº', '8-15': 'Í¥ëÎ≥µÏ†à', '9-11': 'Ï∂îÏÑùÏó∞Ìú¥', '9-12': 'Ï∂îÏÑù', '9-13': 'Ï∂îÏÑùÏó∞Ìú¥',
                '10-3': 'Í∞úÏ≤úÏ†à', '10-9': 'ÌïúÍ∏ÄÎÇ†', '12-25': 'ÏÑ±ÌÉÑÏ†à'
            }
        };
        
        // Í≥µÌú¥Ïùº ÌôïÏù∏ Ìï®Ïàò
        function getKoreanHoliday(year, month, day) {
            const yearHolidays = koreanHolidays[year];
            if (!yearHolidays) return null;
            
            const key = `${month}-${day}`;
            return yearHolidays[key] || null;
        }
        
        // Ï†ÑÏó≠ Îã¨Î†• ÏÉÅÌÉú Î≥ÄÏàò
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth() + 1;
        
        // ÎÇ†Ïßú ÏÑ†ÌÉùÍ∏∞ Ï¥àÍ∏∞Ìôî
        function initDateSelector() {
            const yearSelect = document.getElementById('yearSelect');
            const monthSelect = document.getElementById('monthSelect');
            
            // ÎÖÑÎèÑ ÏòµÏÖò ÏÉùÏÑ± (ÌòÑÏû¨ ÎÖÑÎèÑ Í∏∞Ï§Ä -10ÎÖÑ ~ +5ÎÖÑ)
            const currentYearBase = new Date().getFullYear();
            yearSelect.innerHTML = '';
            for (let year = currentYearBase - 10; year <= currentYearBase + 5; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = `${year}ÎÖÑ`;
                if (year === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }
            
            // Ïõî ÏòµÏÖò ÏÉùÏÑ±
            const months = ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', 
                          '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'];
            monthSelect.innerHTML = '';
            months.forEach((monthName, index) => {
                const option = document.createElement('option');
                option.value = index + 1;
                option.textContent = monthName;
                if (index + 1 === currentMonth) option.selected = true;
                monthSelect.appendChild(option);
            });
        }

        // ÎÇ†Ïßú Î≥ÄÍ≤Ω Ìï®Ïàò (ÎìúÎ°≠Îã§Ïö¥ÏóêÏÑú Ìò∏Ï∂ú)
        function changeDate() {
            const yearSelect = document.getElementById('yearSelect');
            const monthSelect = document.getElementById('monthSelect');
            
            currentYear = parseInt(yearSelect.value);
            currentMonth = parseInt(monthSelect.value);
            
            // Îã¨Î†• Ïû¨ÏÉùÏÑ±
            createCalendar();
        }

        // Ïõî Î≥ÄÍ≤Ω Ìï®Ïàò (Ïù¥Ï†Ñ/Îã§Ïùå Î≤ÑÌäºÏóêÏÑú Ìò∏Ï∂ú)
        function changeMonth(direction) {
            currentMonth += direction;
            
            if (currentMonth > 12) {
                currentMonth = 1;
                currentYear++;
            } else if (currentMonth < 1) {
                currentMonth = 12;
                currentYear--;
            }
            
            // ÎìúÎ°≠Îã§Ïö¥ ÏóÖÎç∞Ïù¥Ìä∏
            updateDateSelector();
            
            // Îã¨Î†• Ïû¨ÏÉùÏÑ±
            createCalendar();
        }

        // ÎìúÎ°≠Îã§Ïö¥ ÏÑ†ÌÉùÍ∞í ÏóÖÎç∞Ïù¥Ìä∏
        function updateDateSelector() {
            const yearSelect = document.getElementById('yearSelect');
            const monthSelect = document.getElementById('monthSelect');
            
            if (yearSelect && monthSelect) {
                yearSelect.value = currentYear;
                monthSelect.value = currentMonth;
            }
        }

        // Îã¨Î†• ÏÉùÏÑ±
        function createCalendar() {
            console.log('üóìÔ∏è createCalendar Ìò∏Ï∂úÎê® - ÏôÑÏ†Ñ ÏÉàÎ°ú ÏÉùÏÑ±');
            const grid = document.getElementById('daysGrid');
            
            // Í∏∞Ï°¥ ÎÇ¥Ïö© ÏôÑÏ†Ñ Ï†úÍ±∞ ÌôïÏù∏ (Îçî Í∞ïÎ†•Ìïú Ï†ïÎ¶¨)
            let currentGrid = grid;
            if (currentGrid) {
                // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏôÑÏ†Ñ Ï†úÍ±∞
                currentGrid.replaceWith(currentGrid.cloneNode(false));
                currentGrid = document.getElementById('daysGrid');
                currentGrid.innerHTML = '';
                console.log('üßπ Îã¨Î†• Í∑∏Î¶¨Îìú ÏôÑÏ†Ñ Ï¥àÍ∏∞Ìôî (Ïù¥Î≤§Ìä∏ Ìè¨Ìï®)');
            }
            // Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú Îã¨Î†• ÌëúÏãú
            const today = new Date();
            const year = currentYear;
            const month = currentMonth;
            
            // Îã¨Î†• Ìó§Îçî ÏóÖÎç∞Ïù¥Ìä∏
            const monthYearElement = document.querySelector('.month-year');
            if (monthYearElement) {
                monthYearElement.textContent = `${year}ÎÖÑ ${month}Ïõî`;
                console.log(`üìÖ Îã¨Î†• Ìó§Îçî ÏóÖÎç∞Ïù¥Ìä∏: ${year}ÎÖÑ ${month}Ïõî`);
            }
            
            // ÎÇ¥Î≥¥ÎÇ¥Í∏∞ ÏòµÏÖò ÏóÖÎç∞Ïù¥Ìä∏
            const exportCurrentOption = document.querySelector('#exportPeriod option[value="current"]');
            if (exportCurrentOption) {
                exportCurrentOption.textContent = `ÌòÑÏû¨ Ïõî (${year}ÎÖÑ ${month}Ïõî)`;
            }
            
            const firstDay = new Date(year, month - 1, 1).getDay();
            const daysInMonth = new Date(year, month, 0).getDate();
            const prevMonthDays = new Date(year, month - 1, 0).getDate();
            
            // Ïù¥Ï†Ñ Îã¨ ÎÇ†Ïßú
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'day other-month';
                const prevDate = prevMonthDays - i;
                day.innerHTML = `<div class="day-number">${prevDate}</div>`;
                
                // Ïù¥Ï†Ñ Îã¨ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
                day.addEventListener('click', function(e) {
                    e.stopPropagation();
                    changeMonth(-1);
                    // Ïû†Ïãú ÌõÑ Ìï¥Îãπ ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ Ïó¥Í∏∞
                    setTimeout(() => {
                        openDateMemoModal(currentYear, currentMonth, prevDate);
                    }, 100);
                });
                
                currentGrid.appendChild(day);
            }
            
            // ÌòÑÏû¨ Îã¨ ÎÇ†Ïßú
            for (let date = 1; date <= daysInMonth; date++) {
                const day = document.createElement('div');
                day.className = 'day';
                
                // Ïò§Îäò ÎÇ†Ïßú Ï≤¥ÌÅ¨
                if (date === today.getDate() && month === today.getMonth() + 1 && year === today.getFullYear()) {
                    day.classList.add('today');
                }
                
                // Ï£ºÎßê Ï≤¥ÌÅ¨
                const dayOfWeek = (firstDay + date - 1) % 7;
                if (dayOfWeek === 0) day.classList.add('sunday');
                if (dayOfWeek === 6) day.classList.add('saturday');
                
                // Î©îÎ™® ÌôïÏù∏ (ÏµúÏã† Îç∞Ïù¥ÌÑ∞ Í∞ïÏ†ú Î°úÎìú + ÏóÑÍ≤©Ìïú ÌïÑÌÑ∞ÎßÅ)
                const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const memosRaw = localStorage.getItem('calendarMemos');
                const memos = memosRaw ? JSON.parse(memosRaw) : [];
                
                // Ïú†Ìö®Ìïú Î©îÎ™®Îßå ÌïÑÌÑ∞ÎßÅ (ÏÇ≠Ï†úÎêòÏßÄ ÏïäÏùÄ Î©îÎ™®)
                const dateMemos = memos.filter(memo => 
                    memo && memo.date === dateStr && memo.id && memo.title
                );
                
                // ÎîîÎ≤ÑÍπÖ: Î©îÎ™® Í∞úÏàò Î°úÍ∑∏ (ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Ìè¨Ìï®)
                if (dateMemos.length > 0) {
                    console.log(`üìÖ ${dateStr}: ${dateMemos.length}Í∞ú Î©îÎ™® Î∞úÍ≤¨`);
                    dateMemos.forEach(memo => {
                        console.log(`  - ID: ${memo.id}, Ï†úÎ™©: ${memo.title}`);
                    });
                } else {
                    console.log(`üìÖ ${dateStr}: Î©îÎ™® ÏóÜÏùå`);
                }
                
                // ÌïúÍµ≠ Í≥µÌú¥Ïùº ÌôïÏù∏
                const holiday = getKoreanHoliday(year, month, date);
                if (holiday) {
                    day.classList.add('holiday');
                    day.style.cssText += `
                        background: linear-gradient(135deg, #ffebee, #ffcdd2);
                        border: 2px solid #f44336;
                        position: relative;
                    `;
                    day.innerHTML = `
                        <div class="day-number" style="font-weight: bold; color: #d32f2f;">${date}</div>
                        <div class="holiday-label" style="
                            font-size: 9px;
                            color: #d32f2f;
                            font-weight: bold;
                            margin-top: 2px;
                            line-height: 1.2;
                            text-align: center;
                        ">${holiday}</div>
                        ${dateMemos.length > 0 ? `
                            <div class="memo-indicator"></div>
                            <div class="memo-count">${dateMemos.length}</div>
                        ` : ''}
                    `;
                } else {
                    // ÏùºÏöîÏùº/ÌÜ†ÏöîÏùº ÏÉâÏÉÅ Ï†ÅÏö©
                    const dayOfWeekColor = dayOfWeek === 0 ? '#f44336' : (dayOfWeek === 6 ? '#2196f3' : '');
                    day.innerHTML = `
                        <div class="day-number" style="color: ${dayOfWeekColor};">${date}</div>
                        ${dateMemos.length > 0 ? `
                            <div class="memo-indicator"></div>
                            <div class="memo-count">${dateMemos.length}</div>
                        ` : ''}
                    `;
                }
                
                // ÎÇ†Ïßú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
                day.addEventListener('click', function(e) {
                    console.log('üìÖ ÎÇ†Ïßú ÌÅ¥Î¶≠Îê®:', date, 'isTrusted:', e.isTrusted);
                    
                    // ÏûêÎèô ÌÅ¥Î¶≠ Î∞©ÏßÄ
                    if (e.isTrusted === false) {
                        console.log('üö´ ÏûêÎèô ÌÅ¥Î¶≠ Ï∞®Îã®');
                        return;
                    }
                    
                    // Î©îÎ™®Ï∞ΩÏù¥ Ïù¥ÎØ∏ Ïó¥Î†§ÏûàÏúºÎ©¥ ÌÅ¥Î¶≠ Ï∞®Îã®
                    const dateMemoModal = document.getElementById('dateMemoModal');
                    if (dateMemoModal && dateMemoModal.style.display === 'block') {
                        console.log('üö´ Î©îÎ™®Ï∞ΩÏù¥ Ïó¥Î†§ÏûàÏñ¥ ÎÇ†Ïßú ÌÅ¥Î¶≠ Ï∞®Îã®');
                        e.stopPropagation();
                        e.preventDefault();
                        return;
                    }
                    
                    if (!day.classList.contains('other-month')) {
                        console.log('üìÖ openDateMemoModal Ìò∏Ï∂ú:', year, month, date);
                        
                        // Ïù¥Î≤§Ìä∏ ÏôÑÏ†Ñ Ï∞®Îã® (Î™®Îì† Ï†ÑÌåå Î∞è Í∏∞Î≥∏ ÎèôÏûë Î∞©ÏßÄ)
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        e.preventDefault();
                        
                        // ÏÇ¨Ïö©Ïûê ÌÅ¥Î¶≠ ÌîåÎûòÍ∑∏ ÏÑ§Ï†ï (Ï∞®Îã® Î°úÏßÅ Ïö∞Ìöå)
                        window._userClickOverride = true;
                        
                        // ÏßÄÏó∞ ÏóÜÏù¥ Ï¶âÏãú Î™®Îã¨ Ïó¥Í∏∞ (ÏßÄÏó∞ÏúºÎ°ú Ïù∏Ìïú Ïù¥Î≤§Ìä∏ ÎàÑÏ†Å Î∞©ÏßÄ)
                        openDateMemoModal(year, month, date);
                        
                        // ÌîåÎûòÍ∑∏ Ï¶âÏãú Ìï¥Ï†ú
                        setTimeout(() => {
                            window._userClickOverride = false;
                        }, 100);
                    }
                });
                
                currentGrid.appendChild(day);
            }
            
            // Îã§Ïùå Îã¨ ÎÇ†Ïßú
            const totalCells = 42;
            const currentCells = firstDay + daysInMonth;
            for (let date = 1; date <= totalCells - currentCells; date++) {
                const day = document.createElement('div');
                day.className = 'day other-month';
                day.innerHTML = `<div class="day-number">${date}</div>`;
                
                // Îã§Ïùå Îã¨ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
                day.addEventListener('click', function(e) {
                    e.stopPropagation();
                    changeMonth(1);
                    // Ïû†Ïãú ÌõÑ Ìï¥Îãπ ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ Ïó¥Í∏∞
                    setTimeout(() => {
                        openDateMemoModal(currentYear, currentMonth, date);
                    }, 100);
                });
                
                currentGrid.appendChild(day);
            }
        }

        // ÌÖåÎßà ÌÜ†Í∏Ä
        function initTheme() {
            const themeBtn = document.getElementById('themeToggle');
            themeBtn.addEventListener('click', function() {
                const current = document.documentElement.getAttribute('data-theme') || 'light';
                const newTheme = current === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', newTheme);
                this.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                localStorage.setItem('theme', newTheme);
            });
            
            const saved = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', saved);
            themeBtn.textContent = saved === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        // Î™®Îã¨ Í≥µÌÜµ Ìï®Ïàò
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
            } else {
                console.warn('Î™®Îã¨ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:', modalId);
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            } else {
                console.warn('Îã´ÏùÑ Î™®Îã¨ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:', modalId);
            }
        }


        // ÏùºÏ†ï Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•ÏÜå
        let schedules = JSON.parse(localStorage.getItem('calendarSchedules') || '[]');

        // ÏùºÏ†ï Ï†ÄÏû•
        async function saveSchedule() {
            const title = document.getElementById('scheduleTitle').value.trim();
            const date = document.getElementById('scheduleDate').value;
            const time = document.getElementById('scheduleTime').value;
            const description = document.getElementById('scheduleDescription').value.trim();
            const enableAlarm = document.getElementById('enableAlarm').checked;
            
            if (!title) {
                alert('ÏùºÏ†ï Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            if (!date) {
                alert('ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            if (!time) {
                alert('ÏãúÍ∞ÑÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            const scheduleId = Date.now();
            const now = new Date();
            const schedule = {
                id: scheduleId,
                title: title,
                date: date,
                time: time,
                description: description,
                alarm: enableAlarm ? {
                    enabled: true,
                    minutesBefore: parseInt(document.getElementById('alarmMinutes').value),
                    message: document.getElementById('alarmMessage').value.trim() || title,
                    repeat: document.getElementById('alarmRepeat').value,
                    repeatInterval: document.getElementById('alarmRepeat').value !== 'none' 
                        ? parseInt(document.getElementById('alarmRepeat').value) : 0
                } : { enabled: false },
                attachments: [...scheduleAttachments], // Ï≤®Î∂ÄÌååÏùº Ï∂îÍ∞Ä
                timestamp: now.toISOString(),
                // ÏÉÅÏÑ∏ ÏãúÍ∞Ñ Ï†ïÎ≥¥ Ï∂îÍ∞Ä
                createdAt: {
                    year: now.getFullYear(),
                    month: now.getMonth() + 1,
                    date: now.getDate(),
                    hour: now.getHours(),
                    minute: now.getMinutes(),
                    second: now.getSeconds(),
                    displayTime: now.toLocaleString('ko-KR', {
                        year: 'numeric',
                        month: '2-digit', 
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false
                    }),
                    shortTime: now.toLocaleString('ko-KR', {
                        month: '2-digit',
                        day: '2-digit', 
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: false
                    })
                }
            };
            
            // IndexedDBÏóê Ï†ÄÏû•Îêú ÌååÏùºÎì§Ïùò scheduleId ÏóÖÎç∞Ïù¥Ìä∏
            if (scheduleAttachments.length > 0) {
                for (const attachment of scheduleAttachments) {
                    if (attachment.useIndexedDB && attachment.indexedDbId) {
                        try {
                            // IndexedDBÏóêÏÑú ÌååÏùº Í∞ÄÏ†∏Ïò§Í∏∞
                            const dbAttachment = await getAttachmentFromDB(attachment.indexedDbId);
                            if (dbAttachment) {
                                // Í∏∞Ï°¥ ÏûÑÏãú IDÎ•º ÏÇ≠Ï†úÌïòÍ≥†
                                await deleteAttachmentFromDB(attachment.indexedDbId);
                                // Ïã§Ï†ú ÏùºÏ†ï IDÎ°ú Îã§Ïãú Ï†ÄÏû•
                                const updatedAttachment = await saveAttachmentToDB({
                                    name: dbAttachment.fileName,
                                    size: dbAttachment.fileSize,
                                    type: dbAttachment.fileType,
                                    data: dbAttachment.data
                                }, `schedule_${scheduleId}`);
                                // ÏùºÏ†ïÏùò Ï≤®Î∂ÄÌååÏùº Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                                attachment.indexedDbId = updatedAttachment.id;
                            }
                        } catch (error) {
                            console.error('Ï≤®Î∂ÄÌååÏùº ID ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:', error);
                        }
                    }
                }
            }
            
            schedules.unshift(schedule);
            localStorage.setItem('calendarSchedules', JSON.stringify(schedules));
            
            // ÏùºÏ†ïÏùÑ Î©îÎ™®Î°úÎèÑ Ï†ÄÏû• (ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® Î¶¨Ïä§Ìä∏Ïóê ÌëúÏãúÎêòÎèÑÎ°ù)
            const memo = {
                id: schedule.id,
                title: `üìÖ ${schedule.title}`,
                content: `‚è∞ ${schedule.time}${schedule.alarm?.enabled ? ' üîî' : ''} | ${schedule.description || 'ÏùºÏ†ï'}`,
                date: schedule.date,
                time: schedule.time, // ÏãúÍ∞Ñ Ï†ïÎ≥¥ Ï∂îÍ∞Ä
                attachments: schedule.attachments || [],
                isSchedule: true, // ÏùºÏ†ïÏûÑÏùÑ ÌëúÏãú
                scheduleData: schedule, // ÏõêÎ≥∏ ÏùºÏ†ï Îç∞Ïù¥ÌÑ∞ Î≥¥Í¥Ä
                alarmEnabled: schedule.alarm?.enabled || false, // ÏïåÎûå ÌôúÏÑ±Ìôî Ïó¨Î∂Ä
                alarmTime: schedule.alarm?.minutesBefore ? `${schedule.alarm.minutesBefore}Î∂Ñ Ï†Ñ` : 'Î∞îÎ°ú ÏïåÎ¶º',
                timestamp: schedule.timestamp
            };
            
            // localStorageÏóêÏÑú ÏµúÏã† Î©îÎ™® Î™©Î°ùÏùÑ Í∞ÄÏ†∏ÏôÄÏÑú ÏÉà ÏùºÏ†ï Ï∂îÍ∞Ä
            let currentMemos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
            currentMemos.unshift(memo);
            
            const saveResult = safelyStoreData('calendarMemos', currentMemos);
            if (!saveResult.success) {
                alert('ÏùºÏ†ï Ï†ÄÏû• Ïã§Ìå®: ' + saveResult.message);
                return;
            }
            
            // ÏïåÎûåÏù¥ ÏÑ§Ï†ïÎêú Í≤ΩÏö∞ Ïä§ÏºÄÏ§ÑÎßÅ
            if (enableAlarm) {
                scheduleAlarm(schedule);
            }
            
            clearScheduleForm();
            closeModal('createModal');
            
            // Îã¨Î†•Í≥º Î©îÎ™® ÏãúÏä§ÌÖú ÏóÖÎç∞Ïù¥Ìä∏
            updateCalendarDisplay();
            if (window.memoSystemRefresh) {
                window.memoSystemRefresh();
            }
            
            console.log('‚úÖ ÏùºÏ†ïÏù¥ Î©îÎ™®Î°úÎèÑ Ï†ÄÏû•Îê®:', memo);
            // alert('ÏùºÏ†ïÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§! ‚ûï'); // Î©îÏãúÏßÄ Ï†úÍ±∞
        }
        
        function clearScheduleForm() {
            document.getElementById('scheduleTitle').value = '';
            document.getElementById('scheduleDate').value = '';
            document.getElementById('scheduleTime').value = '';
            document.getElementById('scheduleDescription').value = '';
            document.getElementById('enableAlarm').checked = false;
            document.getElementById('alarmSettings').style.display = 'none';
            document.getElementById('alarmMessage').value = '';
            document.getElementById('alarmRepeat').value = 'none';
            
            // Ï≤®Î∂ÄÌååÏùº Ï¥àÍ∏∞Ìôî
            clearAttachments('scheduleAttachmentList', scheduleAttachments);
        }

        // ÏïåÎûå Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú
        let activeAlarms = new Map(); // ÌôúÏÑ± ÏïåÎûå Ï†ÄÏû•
        let repeatingAlarms = new Map(); // Î∞òÎ≥µ ÏïåÎûå Ï†ÄÏû•
        let acknowledgedAlarms = new Set(JSON.parse(localStorage.getItem('acknowledgedAlarms') || '[]')); // ÌôïÏù∏Îêú ÏïåÎûå Ï†ÄÏû• (ÏßÄÏÜçÏÑ±)

        function scheduleAlarm(schedule) {
            const scheduleDateTime = new Date(schedule.date + 'T' + schedule.time);
            const alarmTime = new Date(scheduleDateTime.getTime() - (schedule.alarm.minutesBefore * 60 * 1000));
            const now = new Date();
            
            if (alarmTime > now) {
                const timeoutId = setTimeout(() => {
                    // Î∞îÎ°ú ÌôúÏÑ±Ìôî ÏòµÏÖòÏù∏ Í≤ΩÏö∞ ÌäπÎ≥ÑÌïú Î©îÏãúÏßÄÏôÄ Ìï®Íªò ÌëúÏãú
                    if (schedule.alarm.minutesBefore === 0) {
                        showAlarmPopup(schedule, false, true); // ÏÑ∏ Î≤àÏß∏ Ïù∏ÏûêÎäî isImmediate
                    } else {
                        showAlarmPopup(schedule);
                    }
                    
                    activeAlarms.delete(schedule.id);
                    
                    // Î∞òÎ≥µ ÏïåÎûå ÏãúÏûë
                    if (schedule.alarm.repeatInterval > 0) {
                        startRepeatingAlarm(schedule);
                    }
                }, alarmTime.getTime() - now.getTime());
                
                activeAlarms.set(schedule.id, timeoutId);
                
                const alarmTypeMsg = schedule.alarm.minutesBefore === 0 
                    ? `Î∞îÎ°ú ÌôúÏÑ±Ìôî - ${scheduleDateTime.toLocaleString()}`
                    : `${schedule.alarm.minutesBefore}Î∂Ñ Ï†Ñ - ${alarmTime.toLocaleString()}`;
                    
                console.log(`ÏïåÎûåÏù¥ ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§: ${schedule.title} - ${alarmTypeMsg}`);
            } else if (schedule.alarm.minutesBefore === 0 && scheduleDateTime > now) {
                // Î∞îÎ°ú ÌôúÏÑ±ÌôîÏù¥ÏßÄÎßå ÏùºÏ†ï ÏãúÍ∞ÑÏù¥ ÏïÑÏßÅ ÎØ∏ÎûòÏù∏ Í≤ΩÏö∞
                const timeoutId = setTimeout(() => {
                    showAlarmPopup(schedule, false, true);
                    activeAlarms.delete(schedule.id);
                    
                    if (schedule.alarm.repeatInterval > 0) {
                        startRepeatingAlarm(schedule);
                    }
                }, scheduleDateTime.getTime() - now.getTime());
                
                activeAlarms.set(schedule.id, timeoutId);
                console.log(`Î∞îÎ°ú ÌôúÏÑ±Ìôî ÏïåÎûåÏù¥ ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§: ${schedule.title} - ${scheduleDateTime.toLocaleString()}`);
            } else if (schedule.alarm.minutesBefore === 0 && scheduleDateTime <= now) {
                // Î∞îÎ°ú ÌôúÏÑ±ÌôîÏù¥Î©∞ ÏùºÏ†ï ÏãúÍ∞ÑÏù¥ Ïù¥ÎØ∏ ÏßÄÎÇú Í≤ΩÏö∞ Ï¶âÏãú Ïã§Ìñâ
                console.log(`‚ö†Ô∏è Í≥ºÍ±∞ ÏãúÍ∞Ñ ÏïåÎûå Ï¶âÏãú Ïã§Ìñâ: ${schedule.title} - ${scheduleDateTime.toLocaleString()}`);
                showAlarmPopup(schedule, false, true);
                if (schedule.alarm.repeatInterval > 0) {
                    startRepeatingAlarm(schedule);
                }
            } else {
                // ÏïåÎûå ÏãúÍ∞ÑÏù¥ Í≥ºÍ±∞Ïù∏ Í≤ΩÏö∞
                console.log(`‚ùå ÏòàÏïΩÎêú ÏïåÎûå ÏãúÍ∞ÑÏù¥ Ïù¥ÎØ∏ ÏßÄÎÇ¨ÏäµÎãàÎã§: ${schedule.title} - ÏïåÎûåÏãúÍ∞Ñ: ${alarmTime.toLocaleString()}, ÌòÑÏû¨ÏãúÍ∞Ñ: ${now.toLocaleString()}`);
                alert(`ÏïåÎûå ÏãúÍ∞ÑÏù¥ Ïù¥ÎØ∏ ÏßÄÎÇ¨ÏäµÎãàÎã§.\nÏùºÏ†ï: ${schedule.title}\nÏïåÎûå ÏãúÍ∞Ñ: ${alarmTime.toLocaleString()}\nÌòÑÏû¨ ÏãúÍ∞Ñ: ${now.toLocaleString()}\n\nÎØ∏Îûò ÏãúÍ∞ÑÏúºÎ°ú Îã§Ïãú ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.`);
            }
        }

        function startRepeatingAlarm(schedule) {
            if (schedule.alarm.repeatInterval > 0) {
                const intervalId = setInterval(() => {
                    if (!acknowledgedAlarms.has(schedule.id)) {
                        showAlarmPopup(schedule, true); // Î∞òÎ≥µ ÏïåÎûåÏûÑÏùÑ ÌëúÏãú
                    }
                }, schedule.alarm.repeatInterval * 60 * 1000); // Î∂Ñ Îã®ÏúÑÎ•º Î∞ÄÎ¶¨Ï¥àÎ°ú Î≥ÄÌôò
                
                repeatingAlarms.set(schedule.id, intervalId);
                console.log(`Î∞òÎ≥µ ÏïåÎûåÏù¥ ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§: ${schedule.title} - ${schedule.alarm.repeatInterval}Î∂ÑÎßàÎã§`);
            }
        }

        function showAlarmPopup(schedule, isRepeating = false, isImmediate = false) {
            console.log('üîî showAlarmPopup Ìò∏Ï∂úÎê®:', schedule.title, {isRepeating, isImmediate});
            
            // Ïù¥ÎØ∏ ÌôïÏù∏Îêú ÏïåÎûåÏù∏ÏßÄ Ï≤¥ÌÅ¨
            const alarmKey = `${schedule.id}-${schedule.date}-${schedule.time}`;
            if (acknowledgedAlarms.has(alarmKey)) {
                console.log('‚úÖ Ïù¥ÎØ∏ ÌôïÏù∏Îêú ÏïåÎûåÏûÖÎãàÎã§. ÌëúÏãúÌïòÏßÄ ÏïäÏùå:', alarmKey);
                return;
            }
            
            // Í∏∞Ï°¥ ÏïåÎûå ÌåùÏóÖÏù¥ ÏûàÎã§Î©¥ Ï†úÍ±∞
            const existingPopup = document.querySelector('.alarm-popup');
            if (existingPopup) {
                console.log('üóëÔ∏è Í∏∞Ï°¥ ÌåùÏóÖ Ï†úÍ±∞');
                existingPopup.remove();
            }

            const popup = document.createElement('div');
            popup.className = 'alarm-popup';
            popup.dataset.scheduleId = schedule.id;
            
            const scheduleDateTime = new Date(schedule.date + 'T' + schedule.time);
            const formatTime = scheduleDateTime.toLocaleString('ko-KR', {
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            const repeatInfo = isRepeating && schedule.alarm.repeatInterval > 0 
                ? `<div style="display: inline-flex; align-items: center; gap: 6px; font-size: 12px; color: #e53e3e; background: #fed7d7; padding: 4px 8px; border-radius: 6px; margin-bottom: 16px;">
                    <span>üîÑ</span>
                    <span>${schedule.alarm.repeatInterval}Î∂ÑÎßàÎã§ Î∞òÎ≥µ</span>
                </div>` 
                : '';

            popup.innerHTML = `
                <div class="alarm-popup-header">
                    <div class="alarm-popup-title">
                        <span>${isImmediate ? '‚ö°' : 'üîî'}</span>
                        <span>${isRepeating ? 'Î∞òÎ≥µ ÏïåÎ¶º' : isImmediate ? 'Î∞îÎ°ú ÏïåÎ¶º' : 'ÏùºÏ†ï ÏïåÎ¶º'}</span>
                    </div>
                </div>
                <div class="alarm-popup-content">
                    <div class="alarm-popup-event-title">${schedule.title}</div>
                    ${schedule.description && schedule.description.trim() ? `<div class="alarm-popup-description">${schedule.description}</div>` : ''}
                    <div class="alarm-popup-time">${formatTime}</div>
                    ${repeatInfo}
                    <div class="alarm-popup-actions">
                        <button class="alarm-popup-btn primary" onclick="acknowledgeAlarm('${schedule.id}', this.parentElement.parentElement.parentElement)">
                            ÌôïÏù∏
                        </button>
                        <button class="alarm-popup-btn secondary" onclick="snoozeAlarm('${schedule.id}', this.parentElement.parentElement.parentElement)">
                            5Î∂Ñ ÌõÑ
                        </button>
                        ${isRepeating ? `<button class="alarm-popup-btn danger" onclick="stopRepeatingAlarm('${schedule.id}', this.parentElement.parentElement.parentElement)">Ï§ëÎã®</button>` : ''}
                    </div>
                </div>
            `;

            document.body.appendChild(popup);
            console.log('‚úÖ ÏïåÎûå ÌåùÏóÖÏù¥ DOMÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§:', popup);
            
            // ÌåùÏóÖÏù¥ Ïã§Ï†úÎ°ú ÌôîÎ©¥Ïóê ÌëúÏãúÎêòÎäîÏßÄ ÌôïÏù∏ (Ïï†ÎãàÎ©îÏù¥ÏÖò ÏôÑÎ£å ÌõÑ)
            setTimeout(() => {
                const addedPopup = document.querySelector('.alarm-popup');
                if (addedPopup) {
                    console.log('‚úÖ ÌåùÏóÖÏù¥ DOMÏóê Ï°¥Ïû¨Ìï®:', addedPopup.style.cssText);
                    const rect = addedPopup.getBoundingClientRect();
                    console.log('‚úÖ ÌåùÏóÖ ÏúÑÏπò (Ïï†ÎãàÎ©îÏù¥ÏÖò ÌõÑ):', rect);
                    console.log('‚úÖ ÌåùÏóÖ ÌôîÎ©¥Ïóê Î≥¥ÏûÑ:', rect.width > 0 && rect.height > 0 && rect.right > 0 && rect.bottom > 0);
                    console.log('‚úÖ ÌåùÏóÖ ÌÅ¥ÎûòÏä§:', addedPopup.className);
                    console.log('‚úÖ ÌåùÏóÖ z-index:', window.getComputedStyle(addedPopup).zIndex);
                    console.log('‚úÖ ÌåùÏóÖ display:', window.getComputedStyle(addedPopup).display);
                    console.log('‚úÖ ÌåùÏóÖ visibility:', window.getComputedStyle(addedPopup).visibility);
                } else {
                    console.error('‚ùå ÌåùÏóÖÏù¥ DOMÏóêÏÑú ÏÇ¨ÎùºÏßê');
                }
            }, 600); // Ïï†ÎãàÎ©îÏù¥ÏÖò 0.5Ï¥à ÏôÑÎ£å ÌõÑ 0.1Ï¥à Ïó¨Ïú†

            // ÏïåÎûåÏ∞ΩÏùÄ ÏÇ¨Ïö©ÏûêÍ∞Ä Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï¥ÏïºÎßå Îã´ÌûàÎèÑÎ°ù Î≥ÄÍ≤Ω (ÏûêÎèô Îã´Í∏∞ Ï†úÍ±∞)

            // Î∏åÎùºÏö∞Ï†Ä ÏïåÎ¶ºÎèÑ ÌëúÏãú (Í∂åÌïúÏù¥ ÏûàÎäî Í≤ΩÏö∞)
            if (Notification.permission === 'granted') {
                const scheduleDateTime = new Date(schedule.date + 'T' + schedule.time);
                const timeStr = scheduleDateTime.toLocaleTimeString('ko-KR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                let notificationBody = '';
                
                // ÏãúÍ∞Ñ Ï†ïÎ≥¥ Ï∂îÍ∞Ä
                notificationBody += `‚è∞ ${timeStr}`;
                
                // ÏÑ§Î™Ö ÎÇ¥Ïö© Ï∂îÍ∞Ä
                if (schedule.description && schedule.description.trim()) {
                    notificationBody += `\nüìù ${schedule.description}`;
                }
                
                // ÏïåÎûå ÌÉÄÏûÖÎ≥Ñ Ï∂îÍ∞Ä Ï†ïÎ≥¥
                if (isImmediate) {
                    notificationBody += '\nüîî ÏùºÏ†ï ÏãúÍ∞ÑÏûÖÎãàÎã§!';
                } else if (isRepeating) {
                    notificationBody += `\nüîÑ ${schedule.alarm.repeatInterval}Î∂ÑÎßàÎã§ Î∞òÎ≥µ ÏïåÎ¶º`;
                } else if (schedule.alarm.minutesBefore > 0) {
                    notificationBody += `\n‚ö†Ô∏è ${schedule.alarm.minutesBefore}Î∂Ñ ÌõÑ ÏùºÏ†ïÏù¥ ÏûàÏäµÎãàÎã§`;
                }
                
                const notification = new Notification('üìÖ ' + schedule.title, {
                    body: notificationBody,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="80" font-size="80">üìÖ</text></svg>',
                    tag: schedule.id,
                    requireInteraction: true
                });
                
                notification.onclick = function() {
                    window.focus();
                    this.close();
                };
                
                console.log('‚úÖ Î∏åÎùºÏö∞Ï†Ä ÏïåÎ¶º ÌëúÏãúÎê®:', schedule.title, 'ÎÇ¥Ïö©:', notificationBody);
            } else {
                console.log('‚ùå Î∏åÎùºÏö∞Ï†Ä ÏïåÎ¶º Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§. ÌòÑÏû¨ Í∂åÌïú:', Notification.permission);
            }
        }

        // ÏùºÎ∞òÏ†ÅÏù∏ ÌåùÏóÖ Îã´Í∏∞ (Î∞òÎ≥µ ÏïåÎûåÏùÄ Í≥ÑÏÜçÎê®)
        function dismissAlarmPopup(popup) {
            popup.classList.add('fade-out');
            setTimeout(() => {
                if (popup.parentElement) {
                    popup.remove();
                }
            }, 300);
        }

        // ÏïåÎûå ÌôïÏù∏ (Î∞òÎ≥µ ÏïåÎûå Ï§ëÎã®)
        function acknowledgeAlarm(scheduleId, popup) {
            // ÏùºÏ†ï Ï†ïÎ≥¥ Ï∞æÍ∏∞
            const schedule = schedules.find(s => s.id == scheduleId);
            if (schedule) {
                const alarmKey = `${schedule.id}-${schedule.date}-${schedule.time}`;
                acknowledgedAlarms.add(alarmKey);
                console.log('‚úÖ ÏïåÎûå ÌôïÏù∏Îê®:', alarmKey);
                
                // localStorageÏóê Ï†ÄÏû•ÌïòÏó¨ ÏßÄÏÜçÏÑ± Î≥¥Ïû•
                localStorage.setItem('acknowledgedAlarms', JSON.stringify([...acknowledgedAlarms]));
            }
            
            // Î∞òÎ≥µ ÏïåÎûåÏù¥ ÏûàÎã§Î©¥ Ï§ëÎã®
            if (repeatingAlarms.has(scheduleId)) {
                clearInterval(repeatingAlarms.get(scheduleId));
                repeatingAlarms.delete(scheduleId);
                console.log(`Î∞òÎ≥µ ÏïåÎûåÏù¥ Ï§ëÎã®ÎêòÏóàÏäµÎãàÎã§: ${scheduleId}`);
            }
            
            dismissAlarmPopup(popup);
        }

        // Î∞òÎ≥µ ÏïåÎûå Ï§ëÎã®
        function stopRepeatingAlarm(scheduleId, popup) {
            if (repeatingAlarms.has(scheduleId)) {
                clearInterval(repeatingAlarms.get(scheduleId));
                repeatingAlarms.delete(scheduleId);
                acknowledgedAlarms.add(scheduleId);
                console.log(`Î∞òÎ≥µ ÏïåÎûåÏù¥ ÏàòÎèôÏúºÎ°ú Ï§ëÎã®ÎêòÏóàÏäµÎãàÎã§: ${scheduleId}`);
            }
            
            dismissAlarmPopup(popup);
        }

        function snoozeAlarm(scheduleId, popup) {
            // 5Î∂Ñ ÌõÑ Îã§Ïãú ÏïåÎ¶º
            setTimeout(() => {
                const schedule = schedules.find(s => s.id == scheduleId);
                if (schedule) {
                    showAlarmPopup(schedule);
                }
            }, 5 * 60 * 1000); // 5Î∂Ñ

            dismissAlarmPopup(popup);
        }

        // Î∏åÎùºÏö∞Ï†Ä ÏïåÎ¶º Í∂åÌïú ÏöîÏ≤≠
        function requestNotificationPermission() {
            if ('Notification' in window) {
                // Í∂åÌïúÏù¥ ÌóàÏö©ÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ÏóêÎßå ÏöîÏ≤≠
                if (Notification.permission === 'default' || Notification.permission === 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            console.log('ÏïåÎ¶º Í∂åÌïúÏù¥ ÌóàÏö©ÎêòÏóàÏäµÎãàÎã§.');
                            // ÌÖåÏä§Ìä∏ ÏïåÎ¶º ÌëúÏãú (ÏÑ†ÌÉùÏÇ¨Ìï≠)
                            // new Notification('ÏïåÎ¶ºÏù¥ ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§!', {
                            //     body: 'Ïù¥Ï†ú ÏùºÏ†ï ÏïåÎ¶ºÏùÑ Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§.',
                            //     icon: '/favicon.ico'
                            // });
                        } else {
                            console.log('ÏïåÎ¶º Í∂åÌïúÏù¥ Í±∞Î∂ÄÎêòÏóàÏäµÎãàÎã§.');
                        }
                    });
                } else if (Notification.permission === 'granted') {
                    console.log('ÏïåÎ¶º Í∂åÌïúÏù¥ Ïù¥ÎØ∏ ÌóàÏö©ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.');
                }
            } else {
                console.log('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî ÏïåÎ¶ºÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Í∏∞Ï°¥ ÏùºÏ†ïÏùò ÏïåÎûå Îã§Ïãú ÏÑ§Ï†ï
        function restoreAlarms() {
            schedules.forEach(schedule => {
                if (schedule.alarm && schedule.alarm.enabled) {
                    scheduleAlarm(schedule);
                }
            });
        }

        // ÏÑ§Ï†ï Ï†ÄÏû•
        function saveSettings() {
            try {
                // ÌÖåÎßà ÏÑ§Ï†ï Ï†ÄÏû•
                const themeSelect = document.getElementById('themeSelect').value;
                document.documentElement.setAttribute('data-theme', themeSelect);
                localStorage.setItem('theme', themeSelect);
                
                // ÌÖåÎßà Î≤ÑÌäº ÏïÑÏù¥ÏΩò ÏóÖÎç∞Ïù¥Ìä∏
                const themeToggle = document.getElementById('themeToggle');
                themeToggle.textContent = themeSelect === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                
                // Í∏ÄÍº¥ ÌÅ¨Í∏∞ ÏÑ§Ï†ï Ï†ÄÏû•
                const fontSizeSlider = document.getElementById('fontSizeSlider');
                if (fontSizeSlider) {
                    const fontSize = fontSizeSlider.value;
                    localStorage.setItem('fontSize', fontSize);
                    applyFontSize(parseFloat(fontSize));
                    console.log('Í∏ÄÍº¥ ÌÅ¨Í∏∞ Ï†ÄÏû•:', fontSize);
                }
                
                // Îã¨Î†• ÌÅ¨Í∏∞ ÏÑ§Ï†ï Ï†ÄÏû• (Ïä¨ÎùºÏù¥Îçî Í∞í ÏÇ¨Ïö©)
                const widthScale = document.getElementById('widthSlider').value;
                const heightScale = document.getElementById('heightSlider').value;
                localStorage.setItem('widthScale', widthScale);
                localStorage.setItem('heightScale', heightScale);
                applyCalendarSize(widthScale, heightScale);
                
                // ÏùºÏûê ÌÅ¨Í∏∞ ÏÑ§Ï†ï Ï†ÄÏû•
                const dateSizeSlider = document.getElementById('dateSizeSlider');
                if (dateSizeSlider) {
                    const dateSize = dateSizeSlider.value;
                    localStorage.setItem('dateSize', dateSize);
                    applyDateSize(parseFloat(dateSize));
                    console.log('ÏùºÏûê ÌÅ¨Í∏∞ Ï†ÄÏû•:', dateSize);
                }
                
                // Ï£º ÏãúÏûëÏùº ÏÑ§Ï†ï Ï†ÄÏû•
                const weekStartSelect = document.querySelector('#settingsModal select.form-select');
                if (weekStartSelect) {
                    const weekStart = weekStartSelect.value;
                    localStorage.setItem('weekStart', weekStart);
                    console.log('Ï£º ÏãúÏûëÏùº Ï†ÄÏû•:', weekStart);
                }
                
                // alert('ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§! ‚öôÔ∏è'); // Î©îÏãúÏßÄ Ï†úÍ±∞
                closeModal('settingsModal');
                
                // Îã¨Î†• ÏÉàÎ°úÍ≥†Ïπ® (Ï£º ÏãúÏûëÏùºÏù¥ Î≥ÄÍ≤ΩÎêú Í≤ΩÏö∞Î•º ÏúÑÌï¥)
                createCalendar();
                
            } catch (error) {
                console.error('ÏÑ§Ï†ï Ï†ÄÏû• Ï§ë Ïò§Î•ò:', error);
                alert('ÏÑ§Ï†ï Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // Í∏ÄÍº¥ ÌÅ¨Í∏∞ Ï†ÅÏö© Ìï®Ïàò (ÏàòÏπò Í∏∞Î∞ò)
        function applyFontSize(scale) {
            const root = document.documentElement;
            // Ïà´ÏûêÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞ (Í∏∞Ï°¥ Ìò∏ÌôòÏÑ±)
            if (typeof scale === 'string') {
                switch(scale) {
                    case 'ÏûëÍ≤å':
                        scale = 0.9;
                        break;
                    case 'ÌÅ¨Í≤å':
                        scale = 1.1;
                        break;
                    default: // Î≥¥ÌÜµ
                        scale = 1.0;
                }
            }
            
            root.style.setProperty('--font-scale', scale.toString());
            
            // Ï†ÅÏö©Îêú Í∞í ÌôïÏù∏
            const appliedScale = getComputedStyle(root).getPropertyValue('--font-scale').trim();
            console.log(`Í∏ÄÍº¥ ÌÅ¨Í∏∞ Ï†ÅÏö©: ${scale} (Ïã§Ï†ú Ï†ÅÏö©: ${appliedScale})`);
            
            // body ÏöîÏÜåÏùò Ïã§Ï†ú font-size ÌôïÏù∏
            const bodyStyle = getComputedStyle(document.body);
            console.log('Body font-size:', bodyStyle.fontSize);
        }

        // Í∏ÄÍº¥ ÌÅ¨Í∏∞ Ï°∞Ï†à Ìï®Ïàò
        function adjustFontSize(delta) {
            const slider = document.getElementById('fontSizeSlider');
            const currentValue = parseFloat(slider.value);
            const newValue = Math.max(0.7, Math.min(1.5, currentValue + delta));
            
            console.log(`Í∏ÄÍº¥ ÌÅ¨Í∏∞ Ï°∞Ï†à: ${currentValue} ‚Üí ${newValue}`);
            
            slider.value = newValue;
            updateFontSizeDisplay(newValue);
            applyFontSize(newValue);
        }

        function updateFontSizeDisplay(value) {
            const display = document.getElementById('fontSizeDisplay');
            display.textContent = Math.round(value * 100) + '%';
        }

        function initializeFontSizeControls() {
            const fontSizeSlider = document.getElementById('fontSizeSlider');
            
            if (fontSizeSlider) {
                fontSizeSlider.addEventListener('input', function() {
                    updateFontSizeDisplay(this.value);
                    applyFontSize(parseFloat(this.value));
                    console.log('Font size slider changed:', this.value);
                });
            }
        }

        // Îã¨Î†• ÌÅ¨Í∏∞ Ï†ÅÏö© Ìï®Ïàò
        function applyCalendarSize(widthScale, heightScale) {
            const root = document.documentElement;
            root.style.setProperty('--width-scale', widthScale);
            root.style.setProperty('--height-scale', heightScale);
            
            // Ï†ÅÏö©Îêú Í∞í ÌôïÏù∏
            const appliedWidth = getComputedStyle(root).getPropertyValue('--width-scale').trim();
            const appliedHeight = getComputedStyle(root).getPropertyValue('--height-scale').trim();
            
            console.log(`Îã¨Î†• ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω: Í∞ÄÎ°ú ${widthScale} (Ï†ÅÏö©Îê®: ${appliedWidth}), ÏÑ∏Î°ú ${heightScale} (Ï†ÅÏö©Îê®: ${appliedHeight})`);
            
            // Îã¨Î†• Ïª®ÌÖåÏù¥ÎÑàÏóê ÏßÅÏ†ë Ï†ÅÏö© ÌôïÏù∏
            const container = document.querySelector('.calendar-container');
            if (container) {
                const containerStyle = getComputedStyle(container);
                console.log('Width ÏÜçÏÑ±:', containerStyle.width);
                console.log('Max-width ÏÜçÏÑ±:', containerStyle.maxWidth);
                console.log('Í∏ÄÏûê ÌÅ¨Í∏∞ ÎèÖÎ¶ΩÏÑ± ÌôïÏù∏: Îã¨Î†• ÌÅ¨Í∏∞Îäî var(--font-scale)Í≥º Î∂ÑÎ¶¨ÎêòÏñ¥ Ï†ÅÏö©Îê®');
            }
        }

        // Îã¨Î†• ÌÅ¨Í∏∞ Ï°∞Ï†à Ìï®ÏàòÎì§
        function adjustCalendarSize(type, delta) {
            const slider = document.getElementById(type + 'Slider');
            const currentValue = parseFloat(slider.value);
            const newValue = Math.max(0.5, Math.min(2.0, currentValue + delta));
            
            console.log(`${type} ÌÅ¨Í∏∞ Ï°∞Ï†à: ${currentValue} ‚Üí ${newValue}`);
            
            slider.value = newValue;
            updateSizeDisplay(type, newValue);
            applyCalendarSize(
                document.getElementById('widthSlider').value,
                document.getElementById('heightSlider').value
            );
        }

        function updateSizeDisplay(type, value) {
            const display = document.getElementById(type + 'Display');
            if (display) {
                display.textContent = Math.round(value * 100) + '%';
            } else {
                console.warn(`${type}Display ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`);
            }
        }

        function initializeSizeControls() {
            const widthSlider = document.getElementById('widthSlider');
            const heightSlider = document.getElementById('heightSlider');
            
            if (widthSlider) {
                widthSlider.addEventListener('input', function() {
                    updateSizeDisplay('width', this.value);
                    applyCalendarSize(this.value, document.getElementById('heightSlider').value);
                    console.log('Width slider changed:', this.value);
                });
            }
            
            if (heightSlider) {
                heightSlider.addEventListener('input', function() {
                    updateSizeDisplay('height', this.value);
                    applyCalendarSize(document.getElementById('widthSlider').value, this.value);
                    console.log('Height slider changed:', this.value);
                });
            }
        }

        // ÏùºÏûê ÌÅ¨Í∏∞ Ï°∞Ï†à Ìï®ÏàòÎì§
        function adjustDateSize(delta) {
            const slider = document.getElementById('dateSizeSlider');
            const currentValue = parseFloat(slider.value);
            const newValue = Math.max(0.7, Math.min(1.8, currentValue + delta));
            
            console.log(`ÏùºÏûê ÌÅ¨Í∏∞ Ï°∞Ï†à: ${currentValue} ‚Üí ${newValue}`);
            
            slider.value = newValue;
            updateDateSizeDisplay(newValue);
            applyDateSize(newValue);
        }

        function updateDateSizeDisplay(value) {
            const display = document.getElementById('dateSizeDisplay');
            display.textContent = Math.round(value * 100) + '%';
        }

        function applyDateSize(scale) {
            const root = document.documentElement;
            root.style.setProperty('--date-size-scale', scale);
            
            console.log(`ÏùºÏûê ÌÅ¨Í∏∞ Ï†ÅÏö©: ${scale}`);
            
            // ÏùºÏûê Ïà´ÏûêÏóê ÏßÅÏ†ë Ï†ÅÏö©
            const style = document.createElement('style');
            style.id = 'date-size-style';
            
            // Í∏∞Ï°¥ Ïä§ÌÉÄÏùº Ï†úÍ±∞
            const existing = document.getElementById('date-size-style');
            if (existing) existing.remove();
            
            style.textContent = `
                .day-number {
                    font-size: calc(18px * ${scale}) !important;
                    font-weight: bold !important;
                }
                
                .holiday .day-number {
                    font-size: calc(16px * ${scale}) !important;
                }
            `;
            
            document.head.appendChild(style);
        }

        function initializeDateSizeControls() {
            const dateSizeSlider = document.getElementById('dateSizeSlider');
            
            if (dateSizeSlider) {
                dateSizeSlider.addEventListener('input', function() {
                    updateDateSizeDisplay(this.value);
                    applyDateSize(parseFloat(this.value));
                    console.log('Date size slider changed:', this.value);
                });
            }
        }

        // ÏÑ§Ï†ï Î°úÎìú Ìï®Ïàò
        function loadSettings() {
            try {
                // ÌÖåÎßà ÏÑ§Ï†ï Î°úÎìú
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                const themeSelect = document.getElementById('themeSelect');
                if (themeSelect) {
                    themeSelect.value = savedTheme;
                }
                
                // Í∏ÄÍº¥ ÌÅ¨Í∏∞ ÏÑ§Ï†ï Î°úÎìú
                const savedFontSize = localStorage.getItem('fontSize') || '1.0';
                const fontSizeSlider = document.getElementById('fontSizeSlider');
                
                // Í∏∞Ï°¥ Î¨∏ÏûêÏó¥ Í∞íÏùÑ Ïà´ÏûêÎ°ú Î≥ÄÌôò (Ìò∏ÌôòÏÑ±)
                let fontSizeValue = savedFontSize;
                if (typeof savedFontSize === 'string') {
                    switch(savedFontSize) {
                        case 'ÏûëÍ≤å':
                            fontSizeValue = '0.9';
                            break;
                        case 'ÌÅ¨Í≤å':
                            fontSizeValue = '1.1';
                            break;
                        case 'Î≥¥ÌÜµ':
                        default:
                            fontSizeValue = '1.0';
                    }
                }
                
                if (fontSizeSlider) {
                    fontSizeSlider.value = fontSizeValue;
                    updateFontSizeDisplay(fontSizeValue);
                    console.log('Í∏ÄÍº¥ ÌÅ¨Í∏∞ Î°úÎìú:', fontSizeValue);
                } else {
                    console.error('Í∏ÄÍº¥ ÌÅ¨Í∏∞ slider ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                }
                applyFontSize(parseFloat(fontSizeValue));
                
                // Îã¨Î†• ÌÅ¨Í∏∞ ÏÑ§Ï†ï Î°úÎìú (Ïä¨ÎùºÏù¥Îçî Í∞í ÏÇ¨Ïö©)
                const savedWidthScale = localStorage.getItem('widthScale') || '1.0';
                const savedHeightScale = localStorage.getItem('heightScale') || '1.0';
                const widthSlider = document.getElementById('widthSlider');
                const heightSlider = document.getElementById('heightSlider');
                
                console.log('Ï†ÄÏû•Îêú ÌÅ¨Í∏∞ ÏÑ§Ï†ï Î°úÎìú:', { width: savedWidthScale, height: savedHeightScale });
                
                if (widthSlider) {
                    widthSlider.value = savedWidthScale;
                    updateSizeDisplay('width', savedWidthScale);
                    console.log('Width slider ÏÑ§Ï†ï:', widthSlider.value);
                }
                if (heightSlider) {
                    heightSlider.value = savedHeightScale;
                    updateSizeDisplay('height', savedHeightScale);
                    console.log('Height slider ÏÑ§Ï†ï:', heightSlider.value);
                }
                applyCalendarSize(savedWidthScale, savedHeightScale);
                
                // ÏùºÏûê ÌÅ¨Í∏∞ ÏÑ§Ï†ï Î°úÎìú
                const savedDateSize = localStorage.getItem('dateSize') || '1.0';
                const dateSizeSlider = document.getElementById('dateSizeSlider');
                
                if (dateSizeSlider) {
                    dateSizeSlider.value = savedDateSize;
                    updateDateSizeDisplay(savedDateSize);
                    console.log('ÏùºÏûê ÌÅ¨Í∏∞ Î°úÎìú:', savedDateSize);
                } else {
                    console.error('ÏùºÏûê ÌÅ¨Í∏∞ slider ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                }
                applyDateSize(parseFloat(savedDateSize));
                
                // Ï£º ÏãúÏûëÏùº ÏÑ§Ï†ï Î°úÎìú
                const savedWeekStart = localStorage.getItem('weekStart') || 'ÏùºÏöîÏùº';
                const weekStartSelect = document.querySelector('#settingsModal select.form-select');
                if (weekStartSelect) {
                    weekStartSelect.value = savedWeekStart;
                    console.log('Ï£º ÏãúÏûëÏùº Î°úÎìú:', savedWeekStart);
                } else {
                    console.error('Ï£º ÏãúÏûëÏùº select ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                }
                
                // ÌÅ¨Í∏∞ Ï°∞Ï†à Ïª®Ìä∏Î°§ Ï¥àÍ∏∞Ìôî
                initializeSizeControls();
                initializeFontSizeControls();
                initializeDateSizeControls();
                
            } catch (error) {
                console.error('ÏÑ§Ï†ï Î°úÎìú Ï§ë Ïò§Î•ò:', error);
            }
        }

        // ÌòÑÏû¨ Ï†ÅÏö©Îêú ÏÑ§Ï†ïÏùÑ Î™®Îã¨Ïóê Î°úÎìúÌïòÎäî Ìï®Ïàò
        let originalSettings = {}; // ÏõêÎ≥∏ ÏÑ§Ï†ï Ï†ÄÏû•Ïö©
        
        function loadCurrentSettingsToModal() {
            try {
                // ÏõêÎ≥∏ ÏÑ§Ï†ï Î∞±ÏóÖ
                originalSettings = {
                    theme: document.documentElement.getAttribute('data-theme') || 'light',
                    fontSize: document.documentElement.style.getPropertyValue('--font-scale') || '1.0',
                    widthScale: document.documentElement.style.getPropertyValue('--width-scale') || '1.0',
                    heightScale: document.documentElement.style.getPropertyValue('--height-scale') || '1.0',
                    weekStart: localStorage.getItem('weekStart') || 'ÏùºÏöîÏùº'
                };
                console.log('ÏõêÎ≥∏ ÏÑ§Ï†ï Î∞±ÏóÖ:', originalSettings);
                
                // ÌòÑÏû¨ Ï†ÅÏö©Îêú ÌÖåÎßàÎ•º Î™®Îã¨Ïóê ÏÑ§Ï†ï
                const themeSelect = document.getElementById('themeSelect');
                if (themeSelect) {
                    themeSelect.value = originalSettings.theme;
                }
                
                // ÌòÑÏû¨ Ï†ÅÏö©Îêú Í∏ÄÍº¥ ÌÅ¨Í∏∞Î•º Î™®Îã¨Ïóê ÏÑ§Ï†ï
                const fontSizeSlider = document.getElementById('fontSizeSlider');
                if (fontSizeSlider) {
                    fontSizeSlider.value = originalSettings.fontSize;
                    updateSizeDisplay('font', originalSettings.fontSize);
                }
                
                // ÌòÑÏû¨ Ï†ÅÏö©Îêú Îã¨Î†• ÌÅ¨Í∏∞Î•º Î™®Îã¨Ïóê ÏÑ§Ï†ï
                const widthSlider = document.getElementById('widthSlider');
                const heightSlider = document.getElementById('heightSlider');
                if (widthSlider) {
                    widthSlider.value = originalSettings.widthScale;
                    updateSizeDisplay('width', originalSettings.widthScale);
                }
                if (heightSlider) {
                    heightSlider.value = originalSettings.heightScale;
                    updateSizeDisplay('height', originalSettings.heightScale);
                }
                
                // ÌòÑÏû¨ Ï†ÅÏö©Îêú Ï£º ÏãúÏûëÏùºÏùÑ Î™®Îã¨Ïóê ÏÑ§Ï†ï
                const weekStartSelect = document.querySelector('#settingsModal select.form-select');
                if (weekStartSelect) {
                    weekStartSelect.value = originalSettings.weekStart;
                }
                
            } catch (error) {
                console.error('ÌòÑÏû¨ ÏÑ§Ï†ï Î°úÎìú Ï§ë Ïò§Î•ò:', error);
            }
        }
        
        // ÏÑ§Ï†ï Ï∑®ÏÜå (ÏõêÎ≥∏ ÏÑ§Ï†ïÏúºÎ°ú ÎêòÎèåÎ¶¨Í∏∞)
        function cancelSettings() {
            try {
                // ÏõêÎ≥∏ ÏÑ§Ï†ïÏúºÎ°ú ÎêòÎèåÎ¶¨Í∏∞
                document.documentElement.setAttribute('data-theme', originalSettings.theme);
                applyFontSize(parseFloat(originalSettings.fontSize));
                applyCalendarSize(originalSettings.widthScale, originalSettings.heightScale);
                
                // ÌÖåÎßà Î≤ÑÌäº ÏïÑÏù¥ÏΩò ÏóÖÎç∞Ïù¥Ìä∏
                const themeToggle = document.getElementById('themeToggle');
                if (themeToggle) {
                    themeToggle.textContent = originalSettings.theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                }
                
                console.log('ÏÑ§Ï†ïÏù¥ ÏõêÎûòÎåÄÎ°ú ÎêòÎèåÎ†§Ï°åÏäµÎãàÎã§:', originalSettings);
                closeModal('settingsModal');
                
            } catch (error) {
                console.error('ÏÑ§Ï†ï Ï∑®ÏÜå Ï§ë Ïò§Î•ò:', error);
            }
        }
        
        // ÏÑ§Ï†ï Î™®Îã¨ Ïã§ÏãúÍ∞Ñ ÎØ∏Î¶¨Î≥¥Í∏∞ Ïù¥Î≤§Ìä∏ Ï¥àÍ∏∞Ìôî
        function initSettingsModalEvents() {
            // ÌÖåÎßà ÏÑ†ÌÉù Ïã§ÏãúÍ∞Ñ Ï†ÅÏö©
            const themeSelect = document.getElementById('themeSelect');
            if (themeSelect) {
                themeSelect.addEventListener('change', function() {
                    document.documentElement.setAttribute('data-theme', this.value);
                    const themeToggle = document.getElementById('themeToggle');
                    if (themeToggle) {
                        themeToggle.textContent = this.value === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                    }
                    console.log('ÌÖåÎßà Ïã§ÏãúÍ∞Ñ Î≥ÄÍ≤Ω:', this.value);
                });
            }
            
            // Í∏ÄÍº¥ ÌÅ¨Í∏∞ Ïä¨ÎùºÏù¥Îçî Ïã§ÏãúÍ∞Ñ Ï†ÅÏö©
            const fontSizeSlider = document.getElementById('fontSizeSlider');
            if (fontSizeSlider) {
                fontSizeSlider.addEventListener('input', function() {
                    applyFontSize(parseFloat(this.value));
                    updateSizeDisplay('font', this.value);
                    console.log('Í∏ÄÍº¥ ÌÅ¨Í∏∞ Ïã§ÏãúÍ∞Ñ Î≥ÄÍ≤Ω:', this.value);
                });
            }
            
            // Îã¨Î†• ÌÅ¨Í∏∞ Ïä¨ÎùºÏù¥Îçî Ïã§ÏãúÍ∞Ñ Ï†ÅÏö©
            const widthSlider = document.getElementById('widthSlider');
            if (widthSlider) {
                widthSlider.addEventListener('input', function() {
                    const heightValue = document.getElementById('heightSlider').value;
                    applyCalendarSize(this.value, heightValue);
                    updateSizeDisplay('width', this.value);
                    console.log('Îã¨Î†• ÎÑàÎπÑ Ïã§ÏãúÍ∞Ñ Î≥ÄÍ≤Ω:', this.value);
                });
            }
            
            const heightSlider = document.getElementById('heightSlider');
            if (heightSlider) {
                heightSlider.addEventListener('input', function() {
                    const widthValue = document.getElementById('widthSlider').value;
                    applyCalendarSize(widthValue, this.value);
                    updateSizeDisplay('height', this.value);
                    console.log('Îã¨Î†• ÎÜíÏù¥ Ïã§ÏãúÍ∞Ñ Î≥ÄÍ≤Ω:', this.value);
                });
            }
            
            // Ï£º ÏãúÏûëÏùº Î≥ÄÍ≤Ω Ïãú Ï¶âÏãú Îã¨Î†• ÏÉàÎ°úÍ≥†Ïπ®ÏùÄ ÌïòÏßÄ ÏïäÏùå (Ï†ÄÏû• ÏãúÏóêÎßå)
            console.log('ÏÑ§Ï†ï Î™®Îã¨ Ïã§ÏãúÍ∞Ñ ÎØ∏Î¶¨Î≥¥Í∏∞ Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
        }

        // ÏóëÏÖÄ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Í¥ÄÎ†® Ìï®ÏàòÎì§
        function processExcelExport() {
            const period = document.getElementById('exportPeriod').value;
            const format = document.getElementById('fileFormat').value;
            const language = document.getElementById('exportLanguage').value;
            
            // ÏòµÏÖò ÏàòÏßë
            const options = {
                period: period,
                format: format,
                language: language,
                includeHolidays: document.getElementById('includeHolidays').checked,
                includeWeekends: document.getElementById('includeWeekends').checked,
                includeMemos: document.getElementById('includeMemos').checked,
                includeSchedules: document.getElementById('includeSchedules').checked,
                includeWeekNumber: document.getElementById('includeWeekNumber').checked,
                colorCoding: document.getElementById('colorCoding').checked,
                includeSummary: document.getElementById('includeSummary').checked,
                includeHeader: document.getElementById('includeHeader').checked
            };

            // ÏÇ¨Ïö©Ïûê ÏßÄÏ†ï Í∏∞Í∞ÑÏù∏ Í≤ΩÏö∞
            if (period === 'custom') {
                options.startDate = document.getElementById('startDate').value;
                options.endDate = document.getElementById('endDate').value;
            }

            // ÌòïÏãùÏóê Îî∞Îùº Îã§Î•∏ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ìï®Ïàò Ìò∏Ï∂ú
            switch(format) {
                case 'csv':
                    exportToCSV(options);
                    break;
                case 'xlsx':
                    exportToXLSX(options);
                    break;
                case 'json':
                    exportToJSON(options);
                    break;
                case 'ics':
                    exportToICS(options);
                    break;
            }

            closeModal('excelModal');
        }

        function exportToCSV(options) {
            let csvContent = "";
            
            // Ìó§Îçî Ï∂îÍ∞Ä
            if (options.includeHeader) {
                const headers = ['ÎÇ†Ïßú', 'ÏöîÏùº'];
                if (options.includeWeekNumber) headers.push('Ï£ºÏ∞®');
                if (options.includeHolidays) headers.push('Í≥µÌú¥Ïùº');
                if (options.includeMemos) headers.push('Î©îÎ™®');
                if (options.includeSchedules) headers.push('ÏùºÏ†ï');
                
                csvContent = headers.join(',') + '\n';
            }

            // ÎÇ†Ïßú Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            const data = generateCalendarData(options);
            
            data.forEach(row => {
                csvContent += row.join(',') + '\n';
            });

            // ÏöîÏïΩ Ï∂îÍ∞Ä
            if (options.includeSummary) {
                csvContent += '\n=== ÏöîÏïΩ ===\n';
                csvContent += 'Ï¥ù ÏùºÏàò,31\n';
                csvContent += 'Ï£ºÎßê Ïàò,9\n';
                csvContent += 'Í≥µÌú¥Ïùº Ïàò,1\n';
                csvContent += 'ÌèâÏùº Ïàò,21\n';
            }

            // ÌååÏùº Îã§Ïö¥Î°úÎìú
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            
            const filename = `calendar_${options.period}_${new Date().getTime()}.csv`;
            link.setAttribute("download", filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`‚úÖ ${filename} ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§!`);
        }

        function exportToXLSX(options) {
            // Í∞ÑÎã®Ìïú HTML ÌÖåÏù¥Î∏î ÌòïÏãùÏúºÎ°ú ÏóëÏÖÄ ÌååÏùº ÏÉùÏÑ±
            let htmlContent = '<html xmlns:x="urn:schemas-microsoft-com:office:excel">';
            htmlContent += '<head><meta charset="UTF-8"></head>';
            htmlContent += '<body><table border="1">';
            
            // Ìó§Îçî
            if (options.includeHeader) {
                htmlContent += '<tr style="background-color:#667eea;color:white;">';
                htmlContent += '<th>ÎÇ†Ïßú</th><th>ÏöîÏùº</th>';
                if (options.includeWeekNumber) htmlContent += '<th>Ï£ºÏ∞®</th>';
                if (options.includeHolidays) htmlContent += '<th>Í≥µÌú¥Ïùº</th>';
                if (options.includeMemos) htmlContent += '<th>Î©îÎ™®</th>';
                htmlContent += '</tr>';
            }

            // Îç∞Ïù¥ÌÑ∞
            const data = generateCalendarData(options);
            data.forEach((row, index) => {
                const isWeekend = row[1] === 'ÌÜ†ÏöîÏùº' || row[1] === 'ÏùºÏöîÏùº';
                const bgColor = isWeekend && options.colorCoding ? '#f0f0f0' : 'white';
                const textColor = row[1] === 'ÏùºÏöîÏùº' ? 'red' : (row[1] === 'ÌÜ†ÏöîÏùº' ? 'blue' : 'black');
                
                htmlContent += `<tr style="background-color:${bgColor};">`;
                row.forEach((cell, i) => {
                    const color = i === 1 ? textColor : 'black';
                    htmlContent += `<td style="color:${color};">${cell}</td>`;
                });
                htmlContent += '</tr>';
            });
            
            htmlContent += '</table></body></html>';
            
            const blob = new Blob([htmlContent], { type: 'application/vnd.ms-excel' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `calendar_${options.period}_${new Date().getTime()}.xls`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('‚úÖ ÏóëÏÖÄ ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§!');
        }

        function exportToJSON(options) {
            const data = generateCalendarData(options);
            const jsonData = {
                period: options.period,
                generated: new Date().toISOString(),
                options: options,
                calendar: data.map(row => {
                    return {
                        date: row[0],
                        dayOfWeek: row[1],
                        weekNumber: options.includeWeekNumber ? row[2] : null,
                        holiday: options.includeHolidays ? row[3] || null : null,
                        memo: options.includeMemos ? row[4] || null : null
                    };
                })
            };

            const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `calendar_${options.period}_${new Date().getTime()}.json`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('‚úÖ JSON ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§!');
        }

        function exportToICS(options) {
            let icsContent = 'BEGIN:VCALENDAR\n';
            icsContent += 'VERSION:2.0\n';
            icsContent += 'PRODID:-//Korean Calendar//NONSGML v1.0//EN\n';
            icsContent += 'CALSCALE:GREGORIAN\n';
            icsContent += 'METHOD:PUBLISH\n';

            // Í¥ëÎ≥µÏ†à Ï∂îÍ∞Ä
            if (options.includeHolidays) {
                icsContent += 'BEGIN:VEVENT\n';
                icsContent += 'DTSTART:20250815\n';
                icsContent += 'DTEND:20250816\n';
                icsContent += 'SUMMARY:Í¥ëÎ≥µÏ†à\n';
                icsContent += 'DESCRIPTION:ÎåÄÌïúÎØºÍµ≠ Í¥ëÎ≥µÏ†à\n';
                icsContent += 'END:VEVENT\n';
            }

            // Î©îÎ™® Ï∂îÍ∞Ä
            if (options.includeMemos) {
                const memos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
                memos.forEach(memo => {
                    icsContent += 'BEGIN:VEVENT\n';
                    icsContent += `DTSTART:${memo.date.replace(/-/g, '')}\n`;
                    icsContent += `SUMMARY:${memo.title}\n`;
                    icsContent += `DESCRIPTION:${memo.content}\n`;
                    icsContent += 'END:VEVENT\n';
                });
            }

            icsContent += 'END:VCALENDAR';

            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `calendar_${options.period}_${new Date().getTime()}.ics`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('‚úÖ ICS Ï∫òÎ¶∞Îçî ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§!');
        }

        function generateCalendarData(options) {
            const data = [];
            const year = 2025;
            const month = 8;
            const daysInMonth = 31;
            const dayNames = ['ÏùºÏöîÏùº', 'ÏõîÏöîÏùº', 'ÌôîÏöîÏùº', 'ÏàòÏöîÏùº', 'Î™©ÏöîÏùº', 'Í∏àÏöîÏùº', 'ÌÜ†ÏöîÏùº'];
            const dayNamesEn = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month - 1, day);
                const dayOfWeek = date.getDay();
                const row = [];
                
                // ÎÇ†Ïßú
                row.push(`2025-08-${String(day).padStart(2, '0')}`);
                
                // ÏöîÏùº
                if (options.language === 'en') {
                    row.push(dayNamesEn[dayOfWeek]);
                } else if (options.language === 'ko-en') {
                    row.push(`${dayNames[dayOfWeek]}/${dayNamesEn[dayOfWeek]}`);
                } else {
                    row.push(dayNames[dayOfWeek]);
                }
                
                // Ï£ºÏ∞®
                if (options.includeWeekNumber) {
                    const weekNum = Math.ceil((day + new Date(year, month - 1, 1).getDay()) / 7);
                    row.push(weekNum);
                }
                
                // Í≥µÌú¥Ïùº
                if (options.includeHolidays) {
                    row.push(day === 15 ? 'Í¥ëÎ≥µÏ†à' : '');
                }
                
                // Î©îÎ™®
                if (options.includeMemos) {
                    const memos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
                    const dayMemos = memos.filter(m => {
                        const memoDate = new Date(m.date);
                        return memoDate.getDate() === day && memoDate.getMonth() === 7;
                    });
                    row.push(dayMemos.map(m => m.title).join('; '));
                }
                
                // ÏùºÏ†ï
                if (options.includeSchedules) {
                    row.push(''); // ÏùºÏ†ï Îç∞Ïù¥ÌÑ∞ (ÌòÑÏû¨Îäî ÎπÑÏñ¥ÏûàÏùå)
                }
                
                data.push(row);
            }
            
            return data;
        }

        function previewExcelData() {
            const options = {
                includeHolidays: document.getElementById('includeHolidays').checked,
                includeWeekends: document.getElementById('includeWeekends').checked,
                includeMemos: document.getElementById('includeMemos').checked,
                includeWeekNumber: document.getElementById('includeWeekNumber').checked,
                language: document.getElementById('exportLanguage').value
            };
            
            const data = generateCalendarData(options);
            let preview = '=== ÎØ∏Î¶¨Î≥¥Í∏∞ (Ï≤òÏùå 5Í∞ú Ìñâ) ===\n\n';
            
            data.slice(0, 5).forEach(row => {
                preview += row.join(' | ') + '\n';
            });
            
            preview += '\n... Ï¥ù ' + data.length + 'Í∞ú Ìñâ';
            
            alert(preview);
        }

        // Í∏∞Í∞Ñ ÏÑ†ÌÉù Î≥ÄÍ≤Ω Ïãú ÏÇ¨Ïö©Ïûê ÏßÄÏ†ï ÎÇ†Ïßú ÌëúÏãú/Ïà®ÍπÄ
        document.addEventListener('DOMContentLoaded', function() {
            const periodSelect = document.getElementById('exportPeriod');
            if (periodSelect) {
                periodSelect.addEventListener('change', function() {
                    const customPeriod = document.getElementById('customPeriod');
                    if (this.value === 'custom') {
                        customPeriod.style.display = 'block';
                    } else {
                        customPeriod.style.display = 'none';
                    }
                });
            }
        });

        // Ïä§Ìã∞Ïª§ Î©îÎ™®Ïû• Í∏∞Îä•
        // let memos = JSON.parse(localStorage.getItem('calendarMemos') || '[]'); // Ï†ÑÏó≠ Î≥ÄÏàò Ï†úÍ±∞ - Í∞Å Ìï®ÏàòÏóêÏÑú ÏßÅÏ†ë ÏùΩÏñ¥Ïò¥
        let selectedDate = null;
        let isMemosUnlocked = false; // Î©îÎ™® ÏÇ≠Ï†ú Ïû†Í∏à ÏÉÅÌÉú
        let isDateMemosUnlocked = false; // ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® ÏÇ≠Ï†ú Ïû†Í∏à ÏÉÅÌÉú
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };

        function createStickyMemo() {
            // Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎ©¥ Î∞òÌôò
            if (document.getElementById('stickyMemo')) {
                return document.getElementById('stickyMemo');
            }
            
            const stickyMemo = document.createElement('div');
            stickyMemo.className = 'sticky-memo';
            stickyMemo.id = 'stickyMemo';
            stickyMemo.innerHTML = `
                <div class="sticky-memo-header" id="stickyMemoHeader">
                    <div class="sticky-memo-title">
                        <span>üóíÔ∏è</span>
                        <span>Ïä§Ìã∞Ïª§ Î©îÎ™®</span>
                    </div>
                    <div class="sticky-memo-controls">
                        <button class="sticky-control-btn sticky-minimize" id="stickyMinimize" title="ÏµúÏÜåÌôî">‚àí</button>
                        <button class="sticky-control-btn sticky-maximize" id="stickyMaximize" title="ÏµúÎåÄÌôî">‚ñ°</button>
                        <button class="sticky-control-btn sticky-close" id="stickyClose" title="Îã´Í∏∞">‚úï</button>
                    </div>
                </div>

                <div class="sticky-memo-content">
                    <div class="sticky-memo-form">
                        <div class="text-editor-toolbar">
                            <div class="toolbar-group">
                                <button class="toolbar-btn" onclick="formatText('bold')" title="ÍµµÍ∏∞">
                                    <strong>B</strong>
                                </button>
                                <button class="toolbar-btn" onclick="formatText('italic')" title="Í∏∞Ïö∏ÏûÑ">
                                    <em>I</em>
                                </button>
                                <button class="toolbar-btn" onclick="formatText('underline')" title="Î∞ëÏ§Ñ">
                                    <u>U</u>
                                </button>
                            </div>
                            <div class="toolbar-group">
                                <input type="color" id="textColorPicker" class="color-picker" value="#000000" onchange="formatText('foreColor', this.value)" title="Í∏ÄÏûêÏÉâ">
                                <input type="color" id="bgColorPicker" class="color-picker" value="#ffffff" onchange="formatText('backColor', this.value)" title="Î∞∞Í≤ΩÏÉâ">
                                <button class="toolbar-btn reset-color-btn" onclick="resetColors()" title="ÏÉâÏÉÅ Ï¥àÍ∏∞Ìôî">
                                    üé®
                                </button>
                            </div>
                            <div class="toolbar-group">
                                <select id="fontFamilySelect" onchange="formatText('fontName', this.value)" title="Ìè∞Ìä∏">
                                    <option value="Malgun Gothic">ÎßëÏùÄ Í≥†Îîï</option>
                                    <option value="Arial">Arial</option>
                                    <option value="Times New Roman">Times New Roman</option>
                                    <option value="Courier New">Courier New</option>
                                    <option value="Noto Sans KR">Noto Sans KR</option>
                                </select>
                                <select id="fontSizeSelect" onchange="formatText('fontSize', this.value)" title="Í∏ÄÏûê ÌÅ¨Í∏∞">
                                    <option value="12">12px</option>
                                    <option value="14" selected>14px</option>
                                    <option value="16">16px</option>
                                    <option value="18">18px</option>
                                    <option value="20">20px</option>
                                    <option value="24">24px</option>
                                </select>
                            </div>
                        </div>
                        <div class="sticky-memo-editor-container">
                            <div id="stickyMemoRichEditor" class="sticky-memo-rich-editor" contenteditable="true" data-placeholder="Ï≤´ Î≤àÏß∏ Ï§Ñ: Ï†úÎ™©&#10;Îëê Î≤àÏß∏ Ï§ÑÎ∂ÄÌÑ∞: ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></div>
                            <textarea class="sticky-memo-unified-textarea" id="stickyMemoUnifiedInput" placeholder="Ï≤´ Î≤àÏß∏ Ï§Ñ: Ï†úÎ™©&#10;Îëê Î≤àÏß∏ Ï§ÑÎ∂ÄÌÑ∞: ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." style="display: none;"></textarea>
                        </div>
                        <div class="editor-toggle">
                            <button class="toggle-btn" onclick="toggleEditor()" id="editorToggleBtn">üìù ÏùºÎ∞ò ÌÖçÏä§Ìä∏Î°ú Ï†ÑÌôò</button>
                        </div>
                        <button class="sticky-memo-save-btn" id="saveStickyMemo">üíæ Ï†ÄÏû•</button>
                    </div>

                    <!-- Î©îÎ™® Î¶¨Ïä§Ìä∏ Ï†úÍ±∞Îê® - Ïä§Ìã∞Ïª§ Î©îÎ™®Îäî Î©îÎ™® ÏûÖÎ†•Îßå Ï†úÍ≥µ -->
                </div>
            `;
            
            document.body.appendChild(stickyMemo);
            
            // Ïù¥Î≤§Ìä∏ Ï¥àÍ∏∞Ìôî
            // ÏïàÏ†ïÌôî Î≤ÑÏ†Ñ ÏÇ¨Ïö©ÏúºÎ°ú Í∏∞Ï°¥ Ï¥àÍ∏∞Ìôî ÎπÑÌôúÏÑ±Ìôî
            // initStickyMemoDrag();
            initStickyMemoButtons();
            
            // ÏïàÏ†ïÌôî Î≤ÑÏ†Ñ Ï¥àÍ∏∞Ìôî
            if (window.StickyMemoStable) {
                window.StickyMemoStable.init();
            }
            
            return stickyMemo;
        }

        function openStickyMemo() {
            console.log('openStickyMemo Ìï®Ïàò Ïã§ÌñâÎê®');
            
            // Ïä§Ìã∞ÌÇ§ Î©îÎ™® ÏÉùÏÑ± ÎòêÎäî Í∞ÄÏ†∏Ïò§Í∏∞
            const stickyMemo = createStickyMemo();
            console.log('Ïä§Ìã∞ÌÇ§ Î©îÎ™® ÏóòÎ¶¨Î®ºÌä∏:', stickyMemo);
            
            // ÌëúÏãú - flexÎ°ú Î≥ÄÍ≤Ω
            stickyMemo.style.display = 'flex';
            stickyMemo.style.visibility = 'visible';
            stickyMemo.style.opacity = '1';
            stickyMemo.style.position = 'fixed';
            stickyMemo.style.width = '350px';
            stickyMemo.style.minHeight = '400px';
            stickyMemo.style.zIndex = '2000';
            
            // Ï†ÄÏû•Îêú ÏúÑÏπò Î≥µÏõê ÎòêÎäî Í∏∞Î≥∏ ÏúÑÏπò ÏÑ§Ï†ï
            const savedPosition = localStorage.getItem('stickyMemoPosition');
            if (savedPosition) {
                console.log('Ï†ÄÏû•Îêú ÏúÑÏπò Î≥µÏõê Ï§ë');
                loadStickyMemoPosition();
            } else {
                // Í∏∞Î≥∏ ÏúÑÏπò ÏÑ§Ï†ï (ÌôîÎ©¥ Ïö∞Ï∏° ÏÉÅÎã®)
                const leftPos = Math.max(50, window.innerWidth - 400);
                stickyMemo.style.left = leftPos + 'px';
                stickyMemo.style.top = '100px';
                console.log('Í∏∞Î≥∏ ÏúÑÏπò ÏÑ§Ï†ï:', leftPos + 'px', '100px');
            }
            
            // Ï†ÄÏû•Îêú ÌÅ¨Í∏∞ Î≥µÏõê
            const savedSize = JSON.parse(localStorage.getItem('stickyMemoSize') || '{}');
            if (savedSize.width && savedSize.height) {
                stickyMemo.style.width = savedSize.width;
                stickyMemo.style.height = savedSize.height;
            }
            
            // Í∞ïÏ†úÎ°ú ÌëúÏãú ÏÑ§Ï†ï (Í∞ïÌôî) - flexÎ°ú Î≥ÄÍ≤Ω
            stickyMemo.style.setProperty('display', 'flex', 'important');
            stickyMemo.style.setProperty('visibility', 'visible', 'important');
            stickyMemo.style.setProperty('opacity', '1', 'important');
            stickyMemo.style.setProperty('pointer-events', 'auto', 'important');
            stickyMemo.style.setProperty('z-index', '9999', 'important');
            
            // DOMÏóêÏÑú ÏôÑÏ†ÑÌûà Ï†úÍ±∞Ìïú ÌõÑ Îã§Ïãú Ï∂îÍ∞Ä (Ï∫êÏãú Î¨∏Ï†ú Ìï¥Í≤∞)
            if (stickyMemo.parentNode) {
                stickyMemo.parentNode.removeChild(stickyMemo);
            }
            document.body.appendChild(stickyMemo);
            
            loadStickyMemos();
            stickyMemo.classList.add('active');
            
            // Í∞ïÏ†ú Ïä§ÌÉÄÏùº Ïû¨Ï†ÅÏö© (Ï∫êÏãú Î¨∏Ï†ú Ìï¥Í≤∞)
            forceStickyMemoStyles(stickyMemo);
            
            console.log('Ïä§Ìã∞ÌÇ§ Î©îÎ™® ÌôúÏÑ±Ìôî ÏôÑÎ£å. ÏµúÏ¢Ö Ïä§ÌÉÄÏùº:', {
                display: stickyMemo.style.display,
                visibility: stickyMemo.style.visibility,
                opacity: stickyMemo.style.opacity,
                left: stickyMemo.style.left,
                top: stickyMemo.style.top,
                zIndex: stickyMemo.style.zIndex
            });
        }

        // Í∞ïÏ†ú Ïä§ÌÉÄÏùº Ï†ÅÏö© Ìï®Ïàò (Ï∫êÏãú Î¨∏Ï†ú Ìï¥Í≤∞)
        function forceStickyMemoStyles(stickyMemo) {
            console.log('üé® Í∞ïÏ†ú Ïä§ÌÉÄÏùº Ï†ÅÏö© ÏãúÏûë');
            
            // Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà Ïä§ÌÉÄÏùº Í∞ïÏ†ú Ï†ÅÏö©
            stickyMemo.style.setProperty('background', 'linear-gradient(135deg, rgba(255, 249, 196, 0.95) 0%, rgba(255, 245, 157, 0.95) 100%)', 'important');
            stickyMemo.style.setProperty('backdrop-filter', 'blur(20px) saturate(180%)', 'important');
            stickyMemo.style.setProperty('border-radius', '20px', 'important');
            stickyMemo.style.setProperty('box-shadow', '0 20px 40px rgba(0, 0, 0, 0.15), 0 8px 20px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.8)', 'important');
            stickyMemo.style.setProperty('border', '1px solid rgba(255, 193, 7, 0.3)', 'important');
            stickyMemo.style.setProperty('transform', 'rotate(-1deg)', 'important');
            stickyMemo.style.setProperty('transition', 'all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)', 'important');
            
            // Ìó§Îçî Ïä§ÌÉÄÏùº Í∞ïÏ†ú Ï†ÅÏö©
            const header = stickyMemo.querySelector('.sticky-memo-header');
            if (header) {
                header.style.setProperty('background', 'linear-gradient(135deg, rgba(255, 193, 7, 0.3) 0%, rgba(255, 152, 0, 0.2) 100%)', 'important');
                header.style.setProperty('padding', '15px 18px', 'important');
                header.style.setProperty('border-radius', '18px 18px 0 0', 'important');
                header.style.setProperty('backdrop-filter', 'blur(10px)', 'important');
                header.style.setProperty('border-bottom', '1px solid rgba(255, 193, 7, 0.2)', 'important');
            }
            
            // Ï†úÏñ¥ Î≤ÑÌäºÎì§ Ïä§ÌÉÄÏùº Í∞ïÏ†ú Ï†ÅÏö©
            const controlBtns = stickyMemo.querySelectorAll('.sticky-control-btn');
            controlBtns.forEach(btn => {
                btn.style.setProperty('width', '24px', 'important');
                btn.style.setProperty('height', '24px', 'important');
                btn.style.setProperty('border-radius', '50%', 'important');
                btn.style.setProperty('backdrop-filter', 'blur(10px)', 'important');
                btn.style.setProperty('box-shadow', '0 2px 8px rgba(0, 0, 0, 0.1)', 'important');
                btn.style.setProperty('transition', 'all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)', 'important');
            });
            
            // Í∞Å Î≤ÑÌäºÎ≥Ñ ÏÉâÏÉÅ Ï†ÅÏö©
            const minimizeBtn = stickyMemo.querySelector('.sticky-minimize');
            const maximizeBtn = stickyMemo.querySelector('.sticky-maximize');
            const closeBtn = stickyMemo.querySelector('.sticky-close');
            
            if (minimizeBtn) {
                minimizeBtn.style.setProperty('background', 'linear-gradient(135deg, #ffc107 0%, #ffb300 100%)', 'important');
                minimizeBtn.style.setProperty('color', '#8b5a00', 'important');
            }
            if (maximizeBtn) {
                maximizeBtn.style.setProperty('background', 'linear-gradient(135deg, #28a745 0%, #20c997 100%)', 'important');
                maximizeBtn.style.setProperty('color', 'white', 'important');
            }
            if (closeBtn) {
                closeBtn.style.setProperty('background', 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)', 'important');
                closeBtn.style.setProperty('color', 'white', 'important');
            }
            
            // Ï†ÄÏû• Î≤ÑÌäº Ïä§ÌÉÄÏùº Í∞ïÏ†ú Ï†ÅÏö©
            const saveBtn = stickyMemo.querySelector('.sticky-memo-save-btn');
            if (saveBtn) {
                saveBtn.style.setProperty('background', 'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)', 'important');
                saveBtn.style.setProperty('color', '#8b5a00', 'important');
                saveBtn.style.setProperty('border-radius', '20px', 'important');
                saveBtn.style.setProperty('padding', '12px 24px', 'important');
                saveBtn.style.setProperty('box-shadow', '0 4px 15px rgba(255, 193, 7, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.6)', 'important');
                saveBtn.style.setProperty('transition', 'all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)', 'important');
            }
            
            console.log('‚úÖ Í∞ïÏ†ú Ïä§ÌÉÄÏùº Ï†ÅÏö© ÏôÑÎ£å');
        }

        function closeStickyMemo() {
            const stickyMemo = document.getElementById('stickyMemo');
            
            // ÌòÑÏû¨ ÏúÑÏπò Ï†ÄÏû•
            const rect = stickyMemo.getBoundingClientRect();
            saveStickyMemoPosition(rect.left, rect.top);
            
            // ÏôÑÏ†ÑÌûà Ïà®Í∏∞Í∏∞ (ÌôîÎ©¥ Î∞ñÏúºÎ°ú Ïù¥Îèô)
            stickyMemo.style.setProperty('display', 'none', 'important');
            stickyMemo.style.setProperty('visibility', 'hidden', 'important');
            stickyMemo.style.setProperty('opacity', '0', 'important');
            stickyMemo.style.setProperty('pointer-events', 'none', 'important');
            stickyMemo.style.setProperty('left', '-9999px', 'important');
            
            clearStickyMemoForm();
            // Î™®Îã¨ Îã´ÏùÑ Îïå Ïû†Í∏à ÏÉÅÌÉúÎ°ú Î¶¨ÏÖã
            resetStickyMemoLock();
        }

        function clearStickyMemoForm() {
            const richEditor = document.getElementById('stickyMemoRichEditor');
            const textEditor = document.getElementById('stickyMemoUnifiedInput');
            
            if (richEditor) richEditor.innerHTML = '';
            if (textEditor) textEditor.value = '';
        }

        function saveStickyMemo() {
            const richEditor = document.getElementById('stickyMemoRichEditor');
            const textEditor = document.getElementById('stickyMemoUnifiedInput');
            
            let content;
            let isRichText = false;
            
            // ÌòÑÏû¨ ÌôúÏÑ± ÏóêÎîîÌÑ∞Ïóê Îî∞Îùº ÎÇ¥Ïö© Í∞ÄÏ†∏Ïò§Í∏∞
            if (richEditor.style.display !== 'none') {
                // Î¶¨Ïπò ÏóêÎîîÌÑ∞Í∞Ä ÌôúÏÑ±
                const richContent = richEditor.innerHTML.trim();
                if (!richContent || richContent === '<br>' || richContent === '<div><br></div>') {
                    alert('Î©îÎ™® ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                    return;
                }
                content = richContent;
                isRichText = true;
            } else {
                // ÌÖçÏä§Ìä∏ ÏóêÎîîÌÑ∞Í∞Ä ÌôúÏÑ±
                const unifiedText = textEditor.value.trim();
                if (!unifiedText) {
                    alert('Î©îÎ™® ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                    return;
                }
                content = unifiedText;
                isRichText = false;
            }
            
            // Ï†úÎ™©Í≥º ÎÇ¥Ïö© Î∂ÑÎ¶¨ (Î¶¨Ïπò ÌÖçÏä§Ìä∏Ïùò Í≤ΩÏö∞ ÌÖçÏä§Ìä∏Îßå Ï∂îÏ∂úÌïòÏó¨ Ï†úÎ™© ÏÉùÏÑ±)
            let title, mainContent;
            if (isRichText) {
                const textContent = richEditor.textContent || richEditor.innerText || '';
                const lines = textContent.split('\n');
                title = lines[0].trim() || 'Ï†úÎ™© ÏóÜÏùå';
                mainContent = content; // HTML ÌòïÌÉúÎ°ú Ï†ÄÏû•
            } else {
                const lines = content.split('\n');
                title = lines[0].trim() || 'Ï†úÎ™© ÏóÜÏùå';
                mainContent = lines.slice(1).join('\n').trim();
            }

            const memo = {
                id: Date.now(),
                title: title,
                content: mainContent,
                isRichText: isRichText,
                date: new Date().toISOString().split('T')[0], // YYYY-MM-DD ÌòïÏãù
                timestamp: new Date().toISOString()
            };

            // localStorageÏóêÏÑú ÏµúÏã† Î©îÎ™®Î•º Í∞ÄÏ†∏ÏôÄÏÑú Ï∂îÍ∞Ä
            const currentMemos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
            currentMemos.unshift(memo);
            
            const saveResult = safelyStoreData('calendarMemos', currentMemos);
            if (!saveResult.success) {
                alert('Ïä§Ìã∞Ïª§ Î©îÎ™® Ï†ÄÏû• Ïã§Ìå®: ' + saveResult.message);
                return;
            }
            
            clearStickyMemoForm();
            loadStickyMemos();
        }

        // ÌÖçÏä§Ìä∏ Ìé∏Ïßë Í∏∞Îä• Ìï®ÏàòÎì§
        function formatText(command, value = null) {
            const richEditor = document.getElementById('stickyMemoRichEditor');
            
            if (richEditor.style.display === 'none') {
                alert('ÌÖçÏä§Ìä∏ Ìé∏Ïßë Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÎ†§Î©¥ Î¶¨Ïπò ÏóêÎîîÌÑ∞Î°ú Ï†ÑÌôòÌïòÏÑ∏Ïöî.');
                return;
            }
            
            richEditor.focus();
            
            try {
                if (value) {
                    document.execCommand(command, false, value);
                } else {
                    document.execCommand(command, false, null);
                }
                
                // Î≤ÑÌäº ÌôúÏÑ±Ìôî ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                updateToolbarButtons();
            } catch (e) {
                console.error('ÌÖçÏä§Ìä∏ Ìè¨Îß∑ Ïã§Ìñâ Ïò§Î•ò:', e);
            }
        }

        function updateToolbarButtons() {
            // ÍµµÍ∏∞, Í∏∞Ïö∏ÏûÑ, Î∞ëÏ§Ñ Î≤ÑÌäºÏùò ÌôúÏÑ± ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            const boldBtn = document.querySelector('button[onclick*="bold"]');
            const italicBtn = document.querySelector('button[onclick*="italic"]');
            const underlineBtn = document.querySelector('button[onclick*="underline"]');
            
            if (boldBtn) {
                boldBtn.classList.toggle('active', document.queryCommandState('bold'));
            }
            if (italicBtn) {
                italicBtn.classList.toggle('active', document.queryCommandState('italic'));
            }
            if (underlineBtn) {
                underlineBtn.classList.toggle('active', document.queryCommandState('underline'));
            }
        }

        function toggleEditor() {
            const richEditor = document.getElementById('stickyMemoRichEditor');
            const textEditor = document.getElementById('stickyMemoUnifiedInput');
            const toggleBtn = document.getElementById('editorToggleBtn');
            const toolbar = document.querySelector('.text-editor-toolbar');
            
            if (richEditor.style.display === 'none') {
                // ÌÖçÏä§Ìä∏ ÏóêÎîîÌÑ∞ÏóêÏÑú Î¶¨Ïπò ÏóêÎîîÌÑ∞Î°ú Ï†ÑÌôò
                const textContent = textEditor.value;
                
                // ÌÖçÏä§Ìä∏Î•º HTMLÎ°ú Î≥ÄÌôò (Ï§ÑÎ∞îÍøàÏùÑ <br>Î°ú)
                const htmlContent = textContent.replace(/\n/g, '<br>');
                richEditor.innerHTML = htmlContent;
                
                richEditor.style.display = 'block';
                textEditor.style.display = 'none';
                toolbar.style.display = 'flex';
                toggleBtn.textContent = 'üìù ÏùºÎ∞ò ÌÖçÏä§Ìä∏Î°ú Ï†ÑÌôò';
            } else {
                // Î¶¨Ïπò ÏóêÎîîÌÑ∞ÏóêÏÑú ÌÖçÏä§Ìä∏ ÏóêÎîîÌÑ∞Î°ú Ï†ÑÌôò
                const htmlContent = richEditor.innerHTML;
                
                // HTMLÏùÑ ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôò
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlContent;
                const textContent = tempDiv.textContent || tempDiv.innerText || '';
                textEditor.value = textContent;
                
                richEditor.style.display = 'none';
                textEditor.style.display = 'block';
                toolbar.style.display = 'none';
                toggleBtn.textContent = 'üé® Î¶¨Ïπò ÏóêÎîîÌÑ∞Î°ú Ï†ÑÌôò';
            }
        }

        // IndexedDB Í∏∞Î∞ò Ï≤®Î∂ÄÌååÏùº ÏãúÏä§ÌÖú
        let attachmentDB = null;
        
        // IndexedDB Ï¥àÍ∏∞Ìôî
        async function initAttachmentDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('CalendarAttachments', 2);
                
                request.onerror = () => {
                    console.error('IndexedDB Ïó¥Í∏∞ Ïã§Ìå®:', request.error);
                    reject(request.error);
                };
                
                request.onsuccess = () => {
                    attachmentDB = request.result;
                    console.log('‚úÖ IndexedDB Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
                    resolve(attachmentDB);
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // Ï≤®Î∂ÄÌååÏùº Ï†ÄÏû•ÏÜå
                    if (!db.objectStoreNames.contains('attachments')) {
                        const store = db.createObjectStore('attachments', { keyPath: 'id', autoIncrement: true });
                        store.createIndex('memoId', 'memoId', { unique: false });
                        store.createIndex('fileName', 'fileName', { unique: false });
                        console.log('üì¶ Ï≤®Î∂ÄÌååÏùº Ï†ÄÏû•ÏÜå ÏÉùÏÑ±');
                    }
                };
            });
        }
        
        // Ï≤®Î∂ÄÌååÏùº IndexedDBÏóê Ï†ÄÏû•
        async function saveAttachmentToDB(attachment, memoId) {
            try {
                if (!attachmentDB) {
                    await initAttachmentDB();
                }
                
                return new Promise((resolve, reject) => {
                    const transaction = attachmentDB.transaction(['attachments'], 'readwrite');
                    const store = transaction.objectStore('attachments');
                    
                    const attachmentData = {
                        memoId: memoId,
                        fileName: attachment.name,
                        fileSize: attachment.size,
                        fileType: attachment.type,
                        data: attachment.data,
                        uploadDate: new Date().toISOString()
                    };
                    
                    const request = store.add(attachmentData);
                    
                    request.onsuccess = () => {
                        console.log('‚úÖ IndexedDBÏóê Ï≤®Î∂ÄÌååÏùº Ï†ÄÏû•:', attachment.name, formatFileSize(attachment.size));
                        resolve({ id: request.result, ...attachmentData });
                    };
                    
                    request.onerror = () => {
                        console.error('‚ùå IndexedDB Ï†ÄÏû• Ïã§Ìå®:', request.error);
                        reject(request.error);
                    };
                });
            } catch (error) {
                console.error('IndexedDB Ï†ÄÏû• Ï§ë Ïò§Î•ò:', error);
                throw error;
            }
        }
        
        // IndexedDBÏóêÏÑú Ï≤®Î∂ÄÌååÏùº Í∞ÄÏ†∏Ïò§Í∏∞
        async function getAttachmentFromDB(attachmentId) {
            try {
                console.log('üîç IndexedDBÏóêÏÑú Ï≤®Î∂ÄÌååÏùº Ï°∞Ìöå ÏãúÏûë. ID:', attachmentId);
                if (!attachmentDB) {
                    console.log('üìã IndexedDB Ï¥àÍ∏∞Ìôî Ï§ë...');
                    await initAttachmentDB();
                }
                
                return new Promise((resolve, reject) => {
                    const transaction = attachmentDB.transaction(['attachments'], 'readonly');
                    const store = transaction.objectStore('attachments');
                    const request = store.get(attachmentId);
                    
                    request.onsuccess = () => {
                        const attachment = request.result;
                        if (attachment) {
                            console.log('‚úÖ IndexedDBÏóêÏÑú Ï≤®Î∂ÄÌååÏùº Î°úÎìú ÏÑ±Í≥µ:', {
                                id: attachmentId,
                                fileName: attachment.fileName,
                                fileSize: attachment.fileSize,
                                dataExists: !!attachment.data,
                                dataLength: attachment.data?.length
                            });
                            resolve(attachment);
                        } else {
                            console.warn('‚ö†Ô∏è IndexedDBÏóêÏÑú Ï≤®Î∂ÄÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå. ID:', attachmentId);
                            // Î™®Îì† ID Î™©Î°ù ÌôïÏù∏
                            const allRequest = store.getAllKeys();
                            allRequest.onsuccess = () => {
                                console.log('üìã IndexedDBÏóê Ï†ÄÏû•Îêú Î™®Îì† ID:', allRequest.result);
                            };
                            resolve(null);
                        }
                    };
                    
                    request.onerror = () => {
                        console.error('‚ùå IndexedDB Ï°∞Ìöå Ïã§Ìå®. ID:', attachmentId, 'Error:', request.error);
                        reject(request.error);
                    };
                });
            } catch (error) {
                console.error('‚ùå IndexedDB Ï°∞Ìöå Ï§ë Ïò§Î•ò. ID:', attachmentId, 'Error:', error);
                throw error;
            }
        }
        
        // Î©îÎ™® IDÎ°ú Î™®Îì† Ï≤®Î∂ÄÌååÏùº Í∞ÄÏ†∏Ïò§Í∏∞
        async function getAttachmentsByMemoId(memoId) {
            try {
                if (!attachmentDB) {
                    await initAttachmentDB();
                }
                
                return new Promise((resolve, reject) => {
                    const transaction = attachmentDB.transaction(['attachments'], 'readonly');
                    const store = transaction.objectStore('attachments');
                    const index = store.index('memoId');
                    const request = index.getAll(memoId);
                    
                    request.onsuccess = () => {
                        const attachments = request.result;
                        console.log(`‚úÖ Î©îÎ™® ${memoId}Ïùò Ï≤®Î∂ÄÌååÏùº ${attachments.length}Í∞ú Î°úÎìú`);
                        resolve(attachments);
                    };
                    
                    request.onerror = () => {
                        console.error('‚ùå IndexedDB Ï°∞Ìöå Ïã§Ìå®:', request.error);
                        reject(request.error);
                    };
                });
            } catch (error) {
                console.error('IndexedDB Ï°∞Ìöå Ï§ë Ïò§Î•ò:', error);
                throw error;
            }
        }
        
        // Ï≤®Î∂ÄÌååÏùº ÏÇ≠Ï†ú
        async function deleteAttachmentFromDB(attachmentId) {
            try {
                if (!attachmentDB) {
                    await initAttachmentDB();
                }
                
                return new Promise((resolve, reject) => {
                    const transaction = attachmentDB.transaction(['attachments'], 'readwrite');
                    const store = transaction.objectStore('attachments');
                    const request = store.delete(attachmentId);
                    
                    request.onsuccess = () => {
                        console.log('‚úÖ IndexedDBÏóêÏÑú Ï≤®Î∂ÄÌååÏùº ÏÇ≠Ï†ú:', attachmentId);
                        resolve();
                    };
                    
                    request.onerror = () => {
                        console.error('‚ùå IndexedDB ÏÇ≠Ï†ú Ïã§Ìå®:', request.error);
                        reject(request.error);
                    };
                });
            } catch (error) {
                console.error('IndexedDB ÏÇ≠Ï†ú Ï§ë Ïò§Î•ò:', error);
                throw error;
            }
        }
        
        // Ï≤®Î∂ÄÌååÏùº Í¥ÄÎ†® Ìï®ÏàòÎì§
        let scheduleAttachments = [];
        let dateMemoAttachments = [];
        
        // Ï†ÑÏó≠ Ï†ëÍ∑º Í∞ÄÎä•ÌïòÎèÑÎ°ù ÏÑ§Ï†ï
        window.scheduleAttachments = scheduleAttachments;
        window.dateMemoAttachments = dateMemoAttachments;
        window.attachmentDB = attachmentDB;
        window.initAttachmentDB = initAttachmentDB;
        window.saveAttachmentToDB = saveAttachmentToDB;
        window.formatFileSize = formatFileSize;
        window.getFileIcon = getFileIcon;
        window.addAttachmentItem = addAttachmentItem;
        window.removeAttachment = removeAttachment;
        window.clearAttachments = clearAttachments;
        window.downloadAttachment = downloadAttachment;
        window.safelyStoreData = safelyStoreData;
        window.checkStorageSpace = checkStorageSpace;
        window.getStorageSize = getStorageSize;
        window.testStorageCapacity = testStorageCapacity;
        window.showStorageStatus = showStorageStatus;
        window.cleanupStorage = cleanupStorage;
        window.autoCleanupForSpace = autoCleanupForSpace;
        window.emergencyCleanup = emergencyCleanup;

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // localStorage Ïö©Îüâ Ï≤¥ÌÅ¨ Ìï®ÏàòÎì§
        function getStorageSize() {
            let total = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    total += localStorage[key].length;
                }
            }
            return total;
        }
        
        function getStorageLimit() {
            // Ïã§Ï†ú Î∏åÎùºÏö∞Ï†ÄÏùò localStorage Ï†úÌïúÏùÑ ÎèôÏ†ÅÏúºÎ°ú Í∞êÏßÄ
            try {
                const testKey = 'storageTest';
                const chunk = 'x'.repeat(1024); // 1KB
                let currentSize = getStorageSize();
                let testSize = 0;
                
                // ÌòÑÏû¨ Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Ïùò 90%ÍπåÏßÄÎßå ÏÇ¨Ïö©ÌïòÎèÑÎ°ù Ï†úÌïú
                const safeLimit = currentSize + (1024 * 1024); // ÌòÑÏû¨ + 1MB Ïó¨Ïú†Î∂Ñ
                return safeLimit;
            } catch (e) {
                // Ìè¥Î∞±: Î≥¥ÏàòÏ†ÅÏúºÎ°ú 4MB ÏÑ§Ï†ï
                return 4 * 1024 * 1024; // 4MB
            }
        }
        
        function checkStorageSpace(additionalBytes = 0) {
            try {
                const currentSize = getStorageSize();
                const limit = getStorageLimit();
                const availableSpace = limit - currentSize;
                
                console.log('Ï†ÄÏû•ÏÜå ÌòÑÌô©:', {
                    current: formatFileSize(currentSize),
                    limit: formatFileSize(limit),
                    available: formatFileSize(availableSpace),
                    additional: formatFileSize(additionalBytes)
                });
                
                return additionalBytes <= availableSpace;
            } catch (e) {
                console.error('Ï†ÄÏû•ÏÜå Ïö©Îüâ ÌôïÏù∏ Ïã§Ìå®:', e);
                return false;
            }
        }
        
        function showStorageStatus() {
            const currentSize = getStorageSize();
            const memosData = localStorage.getItem('calendarMemos') || '[]';
            const memosSize = memosData.length;
            const otherSize = currentSize - memosSize;
            
            // Î©îÎ™®Î≥Ñ Ï≤®Î∂ÄÌååÏùº ÌÅ¨Í∏∞ Î∂ÑÏÑù
            let memos = JSON.parse(memosData);
            let attachmentStats = [];
            memos.forEach(memo => {
                if (memo.attachments && memo.attachments.length > 0) {
                    let totalSize = 0;
                    memo.attachments.forEach(att => {
                        if (att.data) {
                            totalSize += att.data.length;
                        }
                    });
                    if (totalSize > 0) {
                        attachmentStats.push({
                            title: memo.title || 'Ï†úÎ™© ÏóÜÏùå',
                            date: memo.date,
                            attachmentCount: memo.attachments.length,
                            size: totalSize
                        });
                    }
                }
            });
            
            // ÌÅ¨Í∏∞ ÏàúÏúºÎ°ú Ï†ïÎ†¨
            attachmentStats.sort((a, b) => b.size - a.size);
            
            console.log('üìä Ï†ÄÏû•ÏÜå ÏÉÅÌÉú:', {
                total: formatFileSize(currentSize),
                memos: formatFileSize(memosSize),
                other: formatFileSize(otherSize),
                memosPercent: Math.round((memosSize / currentSize) * 100) + '%',
                attachmentStats: attachmentStats.map(s => ({
                    ...s,
                    size: formatFileSize(s.size)
                }))
            });
            
            let detailMessage = `üìä Ï†ÄÏû•ÏÜå ÏÉÅÌÉú\n\nÏ†ÑÏ≤¥ ÏÇ¨Ïö©Îüâ: ${formatFileSize(currentSize)}\nÎ©îÎ™® Îç∞Ïù¥ÌÑ∞: ${formatFileSize(memosSize)} (${Math.round((memosSize / currentSize) * 100)}%)\nÍ∏∞ÌÉÄ Îç∞Ïù¥ÌÑ∞: ${formatFileSize(otherSize)}\n`;
            
            if (attachmentStats.length > 0) {
                detailMessage += '\nüìé ÌÅ∞ Ï≤®Î∂ÄÌååÏùº Î≥¥Ïú† Î©îÎ™®:\n';
                attachmentStats.slice(0, 3).forEach(stat => {
                    detailMessage += `‚Ä¢ ${stat.title} (${stat.date}): ${formatFileSize(stat.size)}\n`;
                });
            }
            
            detailMessage += '\nüí° ÌåÅ: ÌÅ∞ Ï≤®Î∂ÄÌååÏùºÏùÑ ÏÇ≠Ï†úÌïòÏó¨ Í≥µÍ∞Ñ ÌôïÎ≥¥ Í∞ÄÎä•';
            
            alert(detailMessage);
        }
        
        // Ï†ÄÏû•ÏÜå Ï†ïÎ¶¨ ÎèÑÍµ¨ (Í∞úÏÑ†Îêú Î≤ÑÏ†Ñ)
        function cleanupStorage(sizeThreshold = 500 * 1024) { // Í∏∞Î≥∏ 500KB Ïù¥ÏÉÅ Ï†úÍ±∞
            const memosData = localStorage.getItem('calendarMemos') || '[]';
            let memos = JSON.parse(memosData);
            let cleanedCount = 0;
            let freedSpace = 0;
            
            // Ï≤®Î∂ÄÌååÏùº ÌÅ¨Í∏∞Î≥ÑÎ°ú Ï†ïÎ†¨ÌïòÏó¨ Í∞ÄÏû• ÌÅ∞ Í≤ÉÎ∂ÄÌÑ∞ Ï†úÍ±∞
            let allAttachments = [];
            memos.forEach((memo, memoIndex) => {
                if (memo.attachments && memo.attachments.length > 0) {
                    memo.attachments.forEach((att, attIndex) => {
                        if (att.data) {
                            allAttachments.push({
                                memoIndex,
                                attIndex,
                                name: att.name,
                                size: att.data.length,
                                memoTitle: memo.title || 'Ï†úÎ™© ÏóÜÏùå'
                            });
                        }
                    });
                }
            });
            
            // ÌÅ¨Í∏∞ ÏàúÏúºÎ°ú Ï†ïÎ†¨
            allAttachments.sort((a, b) => b.size - a.size);
            
            // ÏûÑÍ≥ÑÍ∞í Ïù¥ÏÉÅÏùò ÌååÏùºÎì§ Ï†úÍ±∞
            const toRemove = allAttachments.filter(att => att.size > sizeThreshold);
            
            if (toRemove.length > 0) {
                // Ï†úÍ±∞ ÌôïÏù∏
                const totalSize = toRemove.reduce((sum, att) => sum + att.size, 0);
                const confirmMsg = `üßπ Ï†ÄÏû•ÏÜå Ï†ïÎ¶¨\n\n${formatFileSize(sizeThreshold)} Ïù¥ÏÉÅÏùò Ï≤®Î∂ÄÌååÏùº ${toRemove.length}Í∞úÎ•º Ï†úÍ±∞Ìï©ÎãàÎã§.\nÏòàÏÉÅ ÌôïÎ≥¥ Í≥µÍ∞Ñ: ${formatFileSize(totalSize)}\n\nÍ≥ÑÏÜçÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;
                
                if (!confirm(confirmMsg)) {
                    return;
                }
                
                // Ïó≠ÏàúÏúºÎ°ú Ï†úÍ±∞ (Ïù∏Îç±Ïä§ Î¨∏Ï†ú Î∞©ÏßÄ)
                toRemove.sort((a, b) => b.memoIndex - a.memoIndex || b.attIndex - a.attIndex);
                
                toRemove.forEach(item => {
                    if (memos[item.memoIndex] && memos[item.memoIndex].attachments) {
                        memos[item.memoIndex].attachments.splice(item.attIndex, 1);
                        cleanedCount++;
                        freedSpace += item.size;
                        console.log(`üóëÔ∏è Ï†úÍ±∞: ${item.name} (${formatFileSize(item.size)}) from "${item.memoTitle}"`);
                    }
                });
                
                // Îπà Ï≤®Î∂ÄÌååÏùº Î∞∞Ïó¥ Ï†ïÎ¶¨
                memos = memos.map(memo => {
                    if (memo.attachments && memo.attachments.length === 0) {
                        delete memo.attachments;
                    }
                    return memo;
                });
                
                const saveResult = safelyStoreData('calendarMemos', memos);
                if (saveResult.success) {
                    alert(`‚úÖ Ï†ÄÏû•ÏÜå Ï†ïÎ¶¨ ÏôÑÎ£å!\n\nÏ†úÍ±∞Îêú Ï≤®Î∂ÄÌååÏùº: ${cleanedCount}Í∞ú\nÌôïÎ≥¥Îêú Í≥µÍ∞Ñ: ${formatFileSize(freedSpace)}\n\nÏù¥Ï†ú ÏÉà ÌååÏùºÏùÑ Ï≤®Î∂ÄÌï† Ïàò ÏûàÏäµÎãàÎã§.`);
                    if (window.refreshAllUI) window.refreshAllUI();
                    if (window.memoSystemRefresh) window.memoSystemRefresh();
                } else {
                    alert('Ï†ÄÏû•ÏÜå Ï†ïÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            } else {
                alert(`${formatFileSize(sizeThreshold)} Ïù¥ÏÉÅÏùò Ï≤®Î∂ÄÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§.\n\nÎçî ÏûëÏùÄ ÌÅ¨Í∏∞Î°ú Ï†ïÎ¶¨ÌïòÎ†§Î©¥:\nF12 ÏΩòÏÜîÏóêÏÑú cleanupStorage(100*1024) Ïã§Ìñâ\n(100KB Ïù¥ÏÉÅ Ï†úÍ±∞)`);
            }
        }
        
        // ÏûêÎèô Ï†ïÎ¶¨ Ìï®Ïàò - ÌïÑÏöîÌïú Í≥µÍ∞ÑÎßåÌÅºÎßå Ï†ïÎ¶¨
        function autoCleanupForSpace(neededBytes) {
            const memosData = localStorage.getItem('calendarMemos') || '[]';
            let memos = JSON.parse(memosData);
            let freedSpace = 0;
            let removedCount = 0;
            
            // Ï≤®Î∂ÄÌååÏùº ÌÅ¨Í∏∞Î≥ÑÎ°ú Ï†ïÎ†¨
            let allAttachments = [];
            memos.forEach((memo, memoIndex) => {
                if (memo.attachments && memo.attachments.length > 0) {
                    memo.attachments.forEach((att, attIndex) => {
                        if (att.data) {
                            allAttachments.push({
                                memoIndex,
                                attIndex,
                                name: att.name,
                                size: att.data.length,
                                memoTitle: memo.title || 'Ï†úÎ™© ÏóÜÏùå'
                            });
                        }
                    });
                }
            });
            
            // ÌÅ¨Í∏∞ ÏàúÏúºÎ°ú Ï†ïÎ†¨ (ÌÅ∞ Í≤ÉÎ∂ÄÌÑ∞)
            allAttachments.sort((a, b) => b.size - a.size);
            
            // ÌïÑÏöîÌïú Í≥µÍ∞ÑÎßåÌÅº Ï†úÍ±∞
            const toRemove = [];
            for (let att of allAttachments) {
                if (freedSpace >= neededBytes) break;
                
                // 200KB Ïù¥ÏÉÅÏù∏ ÌååÏùºÎßå Ï†úÍ±∞
                if (att.size > 200 * 1024) {
                    toRemove.push(att);
                    freedSpace += att.size;
                }
            }
            
            if (toRemove.length > 0) {
                console.log(`üßπ ÏûêÎèô Ï†ïÎ¶¨: ${toRemove.length}Í∞ú ÌååÏùº Ï†úÍ±∞ ÏòàÏ†ï (${formatFileSize(freedSpace)})`);
                
                // Ïó≠ÏàúÏúºÎ°ú Ï†úÍ±∞
                toRemove.sort((a, b) => b.memoIndex - a.memoIndex || b.attIndex - a.attIndex);
                
                toRemove.forEach(item => {
                    if (memos[item.memoIndex] && memos[item.memoIndex].attachments) {
                        memos[item.memoIndex].attachments.splice(item.attIndex, 1);
                        removedCount++;
                        console.log(`  Ï†úÍ±∞: ${item.name} (${formatFileSize(item.size)})`);
                    }
                });
                
                // Îπà Ï≤®Î∂ÄÌååÏùº Î∞∞Ïó¥ Ï†ïÎ¶¨
                memos = memos.map(memo => {
                    if (memo.attachments && memo.attachments.length === 0) {
                        delete memo.attachments;
                    }
                    return memo;
                });
                
                // Ï†ÄÏû• (ÏóêÎü¨ Î¨¥Ïãú)
                try {
                    localStorage.setItem('calendarMemos', JSON.stringify(memos));
                    console.log(`‚úÖ ${removedCount}Í∞ú ÌååÏùº Ï†úÍ±∞, ${formatFileSize(freedSpace)} ÌôïÎ≥¥`);
                } catch (e) {
                    console.error('Ï†ïÎ¶¨ ÌõÑ Ï†ÄÏû• Ïã§Ìå®:', e);
                }
            }
            
            return freedSpace;
        }
        
        // Í∏¥Í∏â Ï†ïÎ¶¨ Ìï®Ïàò (Î™®Îì† Ï≤®Î∂ÄÌååÏùº Ï†úÍ±∞)
        function emergencyCleanup() {
            if (!confirm('‚ö†Ô∏è Í≤ΩÍ≥†!\n\nÎ™®Îì† Ï≤®Î∂ÄÌååÏùºÏùÑ Ï†úÍ±∞Ìï©ÎãàÎã§.\nÎ©îÎ™® ÌÖçÏä§Ìä∏Îäî Ïú†ÏßÄÎê©ÎãàÎã§.\n\nÏ†ïÎßê Í≥ÑÏÜçÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }
            
            const memosData = localStorage.getItem('calendarMemos') || '[]';
            let memos = JSON.parse(memosData);
            let totalRemoved = 0;
            let totalFreed = 0;
            
            memos = memos.map(memo => {
                if (memo.attachments && memo.attachments.length > 0) {
                    memo.attachments.forEach(att => {
                        if (att.data) {
                            totalFreed += att.data.length;
                            totalRemoved++;
                        }
                    });
                    delete memo.attachments;
                }
                return memo;
            });
            
            const saveResult = safelyStoreData('calendarMemos', memos);
            if (saveResult.success) {
                alert(`üîÑ Í∏¥Í∏â Ï†ïÎ¶¨ ÏôÑÎ£å!\n\nÏ†úÍ±∞Îêú Ï≤®Î∂ÄÌååÏùº: ${totalRemoved}Í∞ú\nÌôïÎ≥¥Îêú Í≥µÍ∞Ñ: ${formatFileSize(totalFreed)}\n\nÎ™®Îì† Ï≤®Î∂ÄÌååÏùºÏù¥ Ï†úÍ±∞ÎêòÏóàÏäµÎãàÎã§.`);
                if (window.refreshAllUI) window.refreshAllUI();
                if (window.memoSystemRefresh) window.memoSystemRefresh();
            } else {
                alert('Í∏¥Í∏â Ï†ïÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }
        
        // Ï∫êÏãúÎêú Ïö©Îüâ Ï†ïÎ≥¥ (ÏÑ±Îä• Ìñ•ÏÉÅÏùÑ ÏúÑÌï¥)
        let _cachedCapacity = null;
        let _cacheTime = 0;
        
        function testStorageCapacity() {
            const now = Date.now();
            const CACHE_DURATION = 30000; // 30Ï¥à Ï∫êÏãú
            
            // Ï∫êÏãúÎêú Í∞íÏù¥ ÏûàÍ≥† Ïú†Ìö®ÌïòÎ©¥ Î∞òÌôò
            if (_cachedCapacity && (now - _cacheTime) < CACHE_DURATION) {
                return _cachedCapacity;
            }
            
            const testKey = 'capacityTest';
            const currentSize = getStorageSize();
            
            try {
                localStorage.removeItem(testKey);
                
                // Îçî ÌÅ∞ Î≤îÏúÑÎ°ú Ïù¥ÏßÑ ÌÉêÏÉâ (ÏµúÎåÄ 20MBÍπåÏßÄ ÌÖåÏä§Ìä∏)
                let low = 0;
                let high = 20 * 1024 * 1024; // 20MB
                let maxSize = currentSize;
                
                // Îπ†Î•∏ Ïä§ÌÖù ÏÇ¨Ïù¥Ï¶àÎ°ú ÏãúÏûë
                let stepSize = 1024 * 1024; // 1MB Îã®ÏúÑ
                let testSize = 0;
                
                // Ï≤´ Î≤àÏß∏ Îã®Í≥Ñ: ÌÅ∞ Îã®ÏúÑÎ°ú ÌïúÍ≥ÑÏ†ê Ï∞æÍ∏∞
                while (testSize < high) {
                    const testData = 'x'.repeat(testSize);
                    try {
                        localStorage.setItem(testKey, testData);
                        localStorage.removeItem(testKey);
                        maxSize = currentSize + testSize;
                        testSize += stepSize;
                    } catch (e) {
                        // ÌïúÍ≥Ñ Î∞úÍ≤¨, Ïù¥Ï†ú Ï†ïÎ∞Ä ÌÉêÏÉâ
                        high = testSize - stepSize;
                        low = Math.max(0, testSize - stepSize * 2);
                        break;
                    }
                }
                
                // Îëê Î≤àÏß∏ Îã®Í≥Ñ: Ïù¥ÏßÑ ÌÉêÏÉâÏúºÎ°ú Ï†ïÌôïÌïú ÌïúÍ≥Ñ Ï∞æÍ∏∞
                while (low <= high) {
                    const mid = Math.floor((low + high) / 2);
                    const testData = 'x'.repeat(mid);
                    
                    try {
                        localStorage.setItem(testKey, testData);
                        localStorage.removeItem(testKey);
                        maxSize = currentSize + mid;
                        low = mid + 1;
                    } catch (e) {
                        high = mid - 1;
                    }
                }
                
                console.log('Ïã§Ï†ú Î∏åÎùºÏö∞Ï†Ä Ï†ÄÏû• Ïö©Îüâ Ï∏°Ï†ï:', {
                    currentUsage: formatFileSize(currentSize),
                    totalCapacity: formatFileSize(maxSize),
                    availableSpace: formatFileSize(maxSize - currentSize)
                });
                
                _cachedCapacity = maxSize;
                _cacheTime = now;
                return maxSize;
            } catch (e) {
                // Í∏∞Î≥∏Í∞íÏùÑ Îçî ÌÅ¨Í≤å ÏÑ§Ï†ï (ÌòÑÏû¨ + 5MB)
                const fallback = currentSize + 5 * 1024 * 1024; // 5MB Ïó¨Ïú†Î∂Ñ
                console.warn('Ïö©Îüâ Ï∏°Ï†ï Ïã§Ìå®, Í∏∞Î≥∏Í∞í ÏÇ¨Ïö©:', formatFileSize(fallback));
                _cachedCapacity = fallback;
                _cacheTime = now;
                return fallback;
            }
        }
        
        function safelyStoreData(key, data) {
            try {
                const jsonData = JSON.stringify(data);
                const dataSize = jsonData.length;
                
                // Ïã§Ï†ú Ï†ÄÏû• ÏãúÎèÑ Ï†ÑÏóê Ïö©Îüâ Ï≤¥ÌÅ¨
                const currentSize = getStorageSize();
                const availableSpace = testStorageCapacity() - currentSize;
                
                console.log('Ï†ïÌôïÌïú Ï†ÄÏû•ÏÜå Ï≤¥ÌÅ¨:', {
                    current: formatFileSize(currentSize),
                    available: formatFileSize(availableSpace),
                    needed: formatFileSize(dataSize),
                    usagePercent: Math.round((dataSize / availableSpace) * 100) + '%',
                    canStore: dataSize <= availableSpace * 0.95 // 95% ÌóàÏö©
                });
                
                if (dataSize > availableSpace * 0.95) { // 95% ÌóàÏö©ÏúºÎ°ú Í¥ÄÎåÄÌïòÍ≤å Ï°∞Ï†ï
                    throw new Error('Ï†ÄÏû• Í≥µÍ∞ÑÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§.');
                }
                
                localStorage.setItem(key, jsonData);
                return { success: true };
            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ïã§Ìå®:', error);
                
                if (error.name === 'QuotaExceededError' || error.message.includes('quota') || error.message.includes('Ï†ÄÏû• Í≥µÍ∞Ñ')) {
                    // ÌòÑÏû¨ Ï†ÄÏû•ÏÜå ÏÉÅÌÉú Î∂ÑÏÑù
                    const currentSize = getStorageSize();
                    const memosSize = (localStorage.getItem('calendarMemos') || '').length;
                    const otherSize = currentSize - memosSize;
                    
                    return { 
                        success: false, 
                        error: 'storage_full',
                        message: `Ï†ÄÏû• Í≥µÍ∞ÑÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§.\n\nÌòÑÏû¨ ÏÇ¨Ïö©Îüâ: ${formatFileSize(currentSize)}\nÎ©îÎ™® Îç∞Ïù¥ÌÑ∞: ${formatFileSize(memosSize)}\nÍ∏∞ÌÉÄ Îç∞Ïù¥ÌÑ∞: ${formatFileSize(otherSize)}\n\nÌï¥Í≤∞ Î∞©Î≤ï:\n‚Ä¢ Í∏∞Ï°¥ Î©îÎ™®Ïùò ÌÅ∞ Ï≤®Î∂ÄÌååÏùºÏùÑ ÏÇ≠Ï†úÌï¥Ï£ºÏÑ∏Ïöî\n‚Ä¢ ÌååÏùºÏùÑ ÏïïÏ∂ïÌïòÍ±∞ÎÇò Îçî ÏûëÏùÄ ÌååÏùºÏùÑ ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî\n‚Ä¢ Î∏åÎùºÏö∞Ï†ÄÏùò Ï†ÄÏû• Í≥µÍ∞Ñ Ï†úÌïúÏúºÎ°ú Ïù∏Ìïú Î¨∏Ï†úÏûÖÎãàÎã§`
                    };
                } else {
                    return { 
                        success: false, 
                        error: 'unknown',
                        message: 'Î©îÎ™® Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message
                    };
                }
            }
        }

        function getFileIcon(fileName) {
            const extension = fileName.split('.').pop().toLowerCase();
            const icons = {
                'pdf': 'üìÑ', 'doc': 'üìÑ', 'docx': 'üìÑ',
                'xls': 'üìä', 'xlsx': 'üìä',
                'ppt': 'üìä', 'pptx': 'üìä',
                'txt': 'üìù',
                'jpg': 'üñºÔ∏è', 'jpeg': 'üñºÔ∏è', 'png': 'üñºÔ∏è', 'gif': 'üñºÔ∏è', 'bmp': 'üñºÔ∏è',
                'mp4': 'üé¨', 'avi': 'üé¨', 'mov': 'üé¨',
                'mp3': 'üéµ', 'wav': 'üéµ',
                'zip': 'üóúÔ∏è', 'rar': 'üóúÔ∏è', '7z': 'üóúÔ∏è',
            };
            return icons[extension] || 'üìé';
        }

        async function addAttachmentItem(file, listId, attachmentArray) {
            const attachmentList = document.getElementById(listId);
            const attachmentItem = document.createElement('div');
            attachmentItem.className = 'attachment-item';
            attachmentItem.innerHTML = `
                <div class="attachment-info">
                    <span class="attachment-icon">${getFileIcon(file.name)}</span>
                    <span class="attachment-name" title="${file.name}">${file.name}</span>
                    <span class="attachment-size">${formatFileSize(file.size)}</span>
                    <span class="attachment-status">‚è≥</span>
                </div>
                <button class="attachment-remove" onclick="removeAttachment('${file.name}', '${listId}', this)">
                    ‚úï
                </button>
            `;
            attachmentList.appendChild(attachmentItem);
            
            // IndexedDB Ï¥àÍ∏∞Ìôî (ÌïÑÏöîÏãú)
            if (!attachmentDB) {
                await initAttachmentDB();
            }
            
            // ÌååÏùºÏùÑ Base64Î°ú Ïù∏ÏΩîÎî©
            const reader = new FileReader();
            reader.onload = async function(e) {
                // ÌååÏùº Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞ ÌôïÏù∏ (Base64Îäî ÏõêÎ≥∏Î≥¥Îã§ ÏïΩ 33% Îçî ÌÅº)
                const base64Data = e.target.result;
                const estimatedSize = base64Data.length;
                
                // localStorage Ïö©Îüâ Ï≤¥ÌÅ¨ (Ïã§Ï†ú Ïö©Îüâ Í∏∞Ï§Ä)
                const currentSize = getStorageSize();
                const totalCapacity = testStorageCapacity();
                const availableSpace = totalCapacity - currentSize;
                
                // 100KB Ïù¥ÏÉÅÏùÄ Î¨¥Ï°∞Í±¥ IndexedDB ÏÇ¨Ïö©
                const useIndexedDB = file.size > 100 * 1024;
                
                if (useIndexedDB || estimatedSize > availableSpace * 0.95) { 
                    console.log('Ïö©Îüâ Î∂ÄÏ°±:', {
                        file: file.name,
                        fileSize: formatFileSize(estimatedSize),
                        currentUsage: formatFileSize(currentSize),
                        totalCapacity: formatFileSize(totalCapacity),
                        available: formatFileSize(availableSpace),
                        margin: '95%'
                    });
                    
                    // IndexedDBÏóê Ï†ÄÏû•
                    console.log('üì¶ IndexedDB ÏÇ¨Ïö©:', file.name, formatFileSize(file.size));
                    
                    try {
                        const tempMemoId = 'temp_' + Date.now();
                        
                        // IndexedDBÏóê Ï†ÄÏû•
                        const savedAttachment = await saveAttachmentToDB({
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            data: base64Data
                        }, tempMemoId);
                        
                        // Î©îÌÉÄÎç∞Ïù¥ÌÑ∞Îßå Î∞∞Ïó¥Ïóê Ï†ÄÏû•
                        attachmentArray.push({
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            indexedDbId: savedAttachment.id,
                            useIndexedDB: true
                        });
                        
                        // ÏÉÅÌÉú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                        const statusIcon = attachmentItem.querySelector('.attachment-status');
                        if (statusIcon) {
                            statusIcon.textContent = 'üíæ';
                            statusIcon.title = 'IndexedDBÏóê Ï†ÄÏû•Îê®';
                        }
                        
                        console.log('‚úÖ IndexedDB Ï†ÄÏû• ÏôÑÎ£å:', file.name);
                        return;  // ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•Îê®
                        
                    } catch (error) {
                        console.error('IndexedDB Ï†ÄÏû• Ïã§Ìå®:', error);
                        alert(`ÌååÏùº Ï†ÄÏû• Ïã§Ìå®: ${file.name}\n\nIndexedDB Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.`);
                        attachmentItem.remove();
                        return;
                    }
                } else {
                    console.log('Ï≤®Î∂ÄÌååÏùº Ïö©Îüâ Ï≤¥ÌÅ¨ ÌÜµÍ≥º:', {
                        file: file.name,
                        fileSize: formatFileSize(estimatedSize),
                        available: formatFileSize(availableSpace),
                        usagePercent: Math.round((estimatedSize / availableSpace) * 100) + '%'
                    });
                }
                
                attachmentArray.push({
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    data: base64Data
                });
                console.log('Ï≤®Î∂ÄÌååÏùº Ï∂îÍ∞ÄÎê®:', file.name, 'ÏòàÏÉÅ ÌÅ¨Í∏∞:', formatFileSize(estimatedSize));
            };
            reader.readAsDataURL(file);
        }

        async function removeAttachment(fileName, listId, buttonElement) {
            const attachmentItem = buttonElement.parentElement;
            attachmentItem.remove();
            
            // Î∞∞Ïó¥ÏóêÏÑú Ï†úÍ±∞ÌïòÍ≥† IndexedDBÎèÑ Ï†ïÎ¶¨
            let removedAttachment = null;
            if (listId === 'scheduleAttachmentList') {
                removedAttachment = scheduleAttachments.find(att => att.name === fileName);
                scheduleAttachments = scheduleAttachments.filter(att => att.name !== fileName);
            } else if (listId === 'dateMemoAttachmentList') {
                removedAttachment = dateMemoAttachments.find(att => att.name === fileName);
                dateMemoAttachments = dateMemoAttachments.filter(att => att.name !== fileName);
            }
            
            // IndexedDBÏóêÏÑúÎèÑ ÏÇ≠Ï†ú
            if (removedAttachment && removedAttachment.useIndexedDB && removedAttachment.indexedDbId) {
                try {
                    await deleteAttachmentFromDB(removedAttachment.indexedDbId);
                    console.log('üíæ IndexedDBÏóêÏÑú ÌååÏùº ÏÇ≠Ï†ú:', fileName);
                } catch (error) {
                    console.error('IndexedDB ÌååÏùº ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                }
            }
            
            console.log('Ï≤®Î∂ÄÌååÏùº Ï†úÍ±∞Îê®:', fileName);
        }

        async function clearAttachments(listId, attachmentArray) {
            const attachmentList = document.getElementById(listId);
            attachmentList.innerHTML = '';
            
            // IndexedDBÏóêÏÑúÎèÑ ÏÇ≠Ï†ú
            for (const attachment of attachmentArray) {
                if (attachment.useIndexedDB && attachment.indexedDbId) {
                    try {
                        await deleteAttachmentFromDB(attachment.indexedDbId);
                        console.log('üíæ IndexedDBÏóêÏÑú ÌååÏùº ÏÇ≠Ï†ú:', attachment.name);
                    } catch (error) {
                        console.error('IndexedDB ÌååÏùº ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                    }
                }
            }
            
            attachmentArray.length = 0;
        }

        async function downloadAttachment(fileName, dataOrId, type, useIndexedDB = false) {
            try {
                console.log('üîΩ Îã§Ïö¥Î°úÎìú ÏãúÏûë:', {fileName, dataOrId, type, useIndexedDB});
                let data = dataOrId;
                
                // IndexedDBÏóêÏÑú ÌååÏùº Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                if (useIndexedDB && typeof dataOrId === 'number') {
                    console.log('üíæ IndexedDBÏóêÏÑú ÌååÏùº Î°úÎìú Ï§ë... ID:', dataOrId);
                    const attachment = await getAttachmentFromDB(dataOrId);
                    console.log('üíæ IndexedDB Ï°∞Ìöå Í≤∞Í≥º:', attachment ? 'Ï∞æÏùå' : 'ÏóÜÏùå');
                    if (!attachment) {
                        console.error('‚ùå IndexedDBÏóêÏÑú Ï≤®Î∂ÄÌååÏùº Ï∞æÏßÄ Î™ªÌï®. ID:', dataOrId);
                        alert(`Ï≤®Î∂ÄÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. (ID: ${dataOrId})`);
                        return;
                    }
                    data = attachment.data;
                    fileName = attachment.fileName;
                    type = attachment.fileType;
                    console.log('‚úÖ IndexedDBÏóêÏÑú ÌååÏùº Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò¥:', {fileName, type, dataLength: data?.length});
                }
                
                // Îç∞Ïù¥ÌÑ∞ Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
                if (!data) {
                    console.error('‚ùå ÌååÏùº Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');
                    alert('ÌååÏùº Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                console.log('üîÑ Base64 Îç∞Ïù¥ÌÑ∞Î•º BlobÏúºÎ°ú Î≥ÄÌôò ÏãúÏûë...');
                // Base64 Îç∞Ïù¥ÌÑ∞Î•º BlobÏúºÎ°ú Î≥ÄÌôò
                const base64Data = data.includes(',') ? data.split(',')[1] : data;
                console.log('üìä Base64 Îç∞Ïù¥ÌÑ∞ Í∏∏Ïù¥:', base64Data.length);
                
                const byteCharacters = atob(base64Data);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: type });
                console.log('‚úÖ Blob ÏÉùÏÑ± ÏôÑÎ£å:', {size: blob.size, type: blob.type});
                
                // Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨ ÏÉùÏÑ± Î∞è ÌÅ¥Î¶≠
                console.log('üîó Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨ ÏÉùÏÑ± Ï§ë...');
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                console.log('üëÜ Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨ ÌÅ¥Î¶≠ Ïã§Ìñâ...');
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                console.log('‚úÖ ÌååÏùº Îã§Ïö¥Î°úÎìú ÏôÑÎ£å:', fileName);
            } catch (error) {
                console.error('‚ùå ÌååÏùº Îã§Ïö¥Î°úÎìú Ïò§Î•ò ÏÉÅÏÑ∏:', {
                    error: error.message,
                    stack: error.stack,
                    fileName, 
                    dataOrId, 
                    type, 
                    useIndexedDB
                });
                alert(`ÌååÏùº Îã§Ïö¥Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\nÏò§Î•ò: ${error.message}`);
            }
        }

        // ÏÉâÏÉÅ Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        function resetColors() {
            const richEditor = document.getElementById('stickyMemoRichEditor');
            const textColorPicker = document.getElementById('textColorPicker');
            const bgColorPicker = document.getElementById('bgColorPicker');
            
            if (richEditor.style.display === 'none') {
                // Î¶¨Ïπò ÏóêÎîîÌÑ∞Í∞Ä ÎπÑÌôúÏÑ± ÏÉÅÌÉúÎ©¥ ÏïÑÎ¨¥Í≤ÉÎèÑ ÌïòÏßÄ ÏïäÏùå
                return;
            }
            
            richEditor.focus();
            
            // ÏÑ†ÌÉùÎêú ÌÖçÏä§Ìä∏Í∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
            const selection = window.getSelection();
            if (selection.rangeCount > 0 && !selection.isCollapsed) {
                // ÏÑ†ÌÉùÎêú ÌÖçÏä§Ìä∏Ïùò ÏÉâÏÉÅÎßå Ï¥àÍ∏∞Ìôî
                document.execCommand('foreColor', false, '#000000');
                document.execCommand('backColor', false, 'transparent');
            } else {
                // Ï†ÑÏ≤¥ ÏóêÎîîÌÑ∞Ïùò ÏÉâÏÉÅÏùÑ Ï¥àÍ∏∞Ìôî (ÌôïÏù∏Ï∞Ω ÏóÜÏù¥ Î∞îÎ°ú Ïã§Ìñâ)
                document.execCommand('selectAll', false, null);
                document.execCommand('foreColor', false, '#000000');
                document.execCommand('backColor', false, 'transparent');
                
                // ÏÑ†ÌÉù Ìï¥Ï†ú
                selection.removeAllRanges();
            }
            
            // Ïª¨Îü¨ ÌîºÏª§ÎèÑ Í∏∞Î≥∏Í∞íÏúºÎ°ú Î¶¨ÏÖã
            if (textColorPicker) textColorPicker.value = '#000000';
            if (bgColorPicker) bgColorPicker.value = '#ffffff';
            
            // ÎèÑÍµ¨ Î™®Ïùå Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            updateToolbarButtons();
        }

        // clearStickyMemoForm Ìï®ÏàòÎäî ÏúÑÏóêÏÑú Ïù¥ÎØ∏ Ï†ïÏùòÎê®

        // Ïä§Ìã∞ÌÇ§ Î©îÎ™® Ï†ÑÏö© Ìï®Ïàò (Î©îÎ™®Ïû•) - Î©îÎ™® Î¶¨Ïä§Ìä∏ Ï†úÍ±∞Îê®
        function loadStickyMemos() {
            console.log('Ïä§Ìã∞ÌÇ§ Î©îÎ™® Î¶¨Ïä§Ìä∏ Î°úÎìú - Î©îÎ™® Î¶¨Ïä§Ìä∏Í∞Ä Ï†úÍ±∞ÎêòÏñ¥ ÏïÑÎ¨¥Í≤ÉÎèÑ ÌïòÏßÄ ÏïäÏùå');
            // Ïä§Ìã∞Ïª§ Î©îÎ™®Îäî Ïù¥Ï†ú Î©îÎ™® ÏûÖÎ†•Îßå Ï†úÍ≥µÌïòÎØÄÎ°ú Î¶¨Ïä§Ìä∏ Î°úÎìú Í∏∞Îä• ÏóÜÏùå
        }

        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Í∏∞Îä•
        function initStickyMemoDrag() {
            const stickyMemo = document.getElementById('stickyMemo');
            const header = document.getElementById('stickyMemoHeader');
            
            // ÏöîÏÜåÍ∞Ä ÏóÜÏúºÎ©¥ Î∞òÌôò
            if (!stickyMemo || !header) return;

            
            // ÎßàÏö∞Ïä§ Ïù¥Î≤§Ìä∏
            header.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            
            // Ìó§ÎçîÏóêÏÑú ÌÖçÏä§Ìä∏ ÏÑ†ÌÉù Î∞©ÏßÄ
            header.style.userSelect = 'none';
            header.style.webkitUserSelect = 'none';
            header.style.msUserSelect = 'none';

            function startDrag(e) {
                // Ïò§ÏßÅ Ï¢åÌÅ¥Î¶≠Îßå Ï≤òÎ¶¨
                if (e.button !== 0) return;
                
                isDragging = true;
                stickyMemo.classList.add('active');
                
                // Ï†ïÌôïÌïú Ïò§ÌîÑÏÖã Í≥ÑÏÇ∞
                const rect = stickyMemo.getBoundingClientRect();
                dragOffset.x = e.clientX - rect.left;
                dragOffset.y = e.clientY - rect.top;
                
                header.style.cursor = 'grabbing';
                document.body.style.cursor = 'grabbing';
                e.preventDefault();
            }

            function drag(e) {
                if (!isDragging) return;
                
                // ÎßàÏö∞Ïä§ ÏúÑÏπò Ï¶âÏãú Ï†ÅÏö©
                const x = e.clientX - dragOffset.x;
                const y = e.clientY - dragOffset.y;
                
                // ÌôîÎ©¥ Í≤ΩÍ≥Ñ Ï≤¥ÌÅ¨ (ÌÅ¨Í∏∞Îäî ÎìúÎûòÍ∑∏ ÏãúÏûë Ïãú Ìïú Î≤àÎßå Í≥ÑÏÇ∞)
                const maxX = window.innerWidth - stickyMemo.offsetWidth;
                const maxY = window.innerHeight - stickyMemo.offsetHeight;
                
                const clampedX = Math.max(0, Math.min(x, maxX));
                const clampedY = Math.max(0, Math.min(y, maxY));
                
                // ÏßÅÏ†ë ÏúÑÏπò Ï†ÅÏö©
                stickyMemo.style.left = clampedX + 'px';
                stickyMemo.style.top = clampedY + 'px';
                
                e.preventDefault();
            }

            function stopDrag() {
                if (isDragging) {
                    isDragging = false;
                    header.style.cursor = 'move';
                    document.body.style.cursor = '';
                    
                    // ÏúÑÏπò Ï†ÄÏû•
                    const rect = stickyMemo.getBoundingClientRect();
                    saveStickyMemoPosition(rect.left, rect.top);
                }
            }
        }


        // Ïä§Ìã∞ÌÇ§ Î©îÎ™® Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Ï¥àÍ∏∞Ìôî
        function initStickyMemoButtons() {
            // ÏµúÏÜåÌôî Î≤ÑÌäº
            const minimizeBtn = document.getElementById('stickyMinimize');
            if (minimizeBtn) {
                minimizeBtn.addEventListener('click', minimizeStickyMemo);
            }

            // ÏµúÎåÄÌôî Î≤ÑÌäº
            const maximizeBtn = document.getElementById('stickyMaximize');
            if (maximizeBtn) {
                maximizeBtn.addEventListener('click', maximizeStickyMemo);
            }

            // Îã´Í∏∞ Î≤ÑÌäº
            const closeBtn = document.getElementById('stickyClose');
            if (closeBtn) {
                closeBtn.addEventListener('click', closeStickyMemo);
            }

            // Ï†ÄÏû• Î≤ÑÌäº
            const saveBtn = document.getElementById('saveStickyMemo');
            if (saveBtn) {
                saveBtn.addEventListener('click', saveStickyMemo);
            }

            // Î¶¨Ïπò ÏóêÎîîÌÑ∞ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
            const richEditor = document.getElementById('stickyMemoRichEditor');
            if (richEditor) {
                // ÎßàÏö∞Ïä§ ÏóÖ/ÌÇ§ÏóÖ Ïãú ÎèÑÍµ¨ Î™®Ïùå Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                richEditor.addEventListener('mouseup', updateToolbarButtons);
                richEditor.addEventListener('keyup', updateToolbarButtons);
                
                // ÏÑ†ÌÉù Î≥ÄÍ≤Ω Ïãú ÎèÑÍµ¨ Î™®Ïùå Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                richEditor.addEventListener('selectionchange', updateToolbarButtons);
            }

            // Î∞±ÏóÖ ÌååÏùºÏùò Í∞úÏÑ†Îêú resize Î¶¨Ïä§ÎÑà Ï†ÅÏö©
            const stickyMemo = document.querySelector('.sticky-memo');
            if (stickyMemo) {
                addResizeListener(stickyMemo);
            }
        }

        // Í∞ÑÎã®Ìïú resize Î¶¨Ïä§ÎÑà
        function addResizeListener(element) {
            if (!element._resizeObserver && window.ResizeObserver) {
                let resizeTimeout;
                
                element._resizeObserver = new ResizeObserver(entries => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        const rect = element.getBoundingClientRect();
                        saveStickyMemoPosition(rect.left, rect.top);
                    }, 200);
                });
                
                element._resizeObserver.observe(element);
            }
        }

        // Ï≤®Î∂ÄÌååÏùº Ïù¥Î≤§Ìä∏ Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        function initAttachmentEvents() {
            console.log('Ï≤®Î∂ÄÌååÏùº Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï ÏãúÏûë...');
            
            const scheduleAttachmentInput = document.getElementById('scheduleAttachment');
            const dateMemoAttachmentInput = document.getElementById('dateMemoAttachment');
            
            console.log('Ï≤®Î∂ÄÌååÏùº ÏûÖÎ†• ÏöîÏÜå ÌôïÏù∏:', {
                scheduleAttachment: !!scheduleAttachmentInput,
                dateMemoAttachment: !!dateMemoAttachmentInput
            });
            
            if (scheduleAttachmentInput) {
                scheduleAttachmentInput.addEventListener('change', function(e) {
                    console.log('ÏùºÏ†ï Ï≤®Î∂ÄÌååÏùº ÏÑ†ÌÉùÎê®:', e.target.files.length, 'Í∞ú');
                    const files = Array.from(e.target.files);
                    files.forEach(file => {
                        // ÌååÏùº ÌÅ¨Í∏∞ Ï†úÌïú (100MB)
                        if (file.size > 100 * 1024 * 1024) {
                            alert(`ÌååÏùº "${file.name}"ÏùÄ ÎÑàÎ¨¥ ÌÅΩÎãàÎã§.\n\nÏµúÎåÄ ÌÅ¨Í∏∞: 100MB\nÌòÑÏû¨ ÌÅ¨Í∏∞: ${formatFileSize(file.size)}\n\n100MB Ïù¥ÌïòÏùò ÌååÏùºÏùÑ ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.`);
                            return;
                        }
                        addAttachmentItem(file, 'scheduleAttachmentList', scheduleAttachments);
                    });
                    // ÏûÖÎ†• Ï¥àÍ∏∞Ìôî (Í∞ôÏùÄ ÌååÏùºÏùÑ Îã§Ïãú ÏÑ†ÌÉùÌï† Ïàò ÏûàÎèÑÎ°ù)
                    e.target.value = '';
                });
                console.log('ÏùºÏ†ï Ï≤®Î∂ÄÌååÏùº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            } else {
                console.warn('scheduleAttachment ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }
            
            if (dateMemoAttachmentInput) {
                dateMemoAttachmentInput.addEventListener('change', function(e) {
                    console.log('ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® Ï≤®Î∂ÄÌååÏùº ÏÑ†ÌÉùÎê®:', e.target.files.length, 'Í∞ú');
                    const files = Array.from(e.target.files);
                    files.forEach(file => {
                        // ÌååÏùº ÌÅ¨Í∏∞ Ï†úÌïú (100MB)
                        if (file.size > 100 * 1024 * 1024) {
                            alert(`ÌååÏùº "${file.name}"ÏùÄ ÎÑàÎ¨¥ ÌÅΩÎãàÎã§.\n\nÏµúÎåÄ ÌÅ¨Í∏∞: 100MB\nÌòÑÏû¨ ÌÅ¨Í∏∞: ${formatFileSize(file.size)}\n\n100MB Ïù¥ÌïòÏùò ÌååÏùºÏùÑ ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.`);
                            return;
                        }
                        addAttachmentItem(file, 'dateMemoAttachmentList', dateMemoAttachments);
                    });
                    // ÏûÖÎ†• Ï¥àÍ∏∞Ìôî (Í∞ôÏùÄ ÌååÏùºÏùÑ Îã§Ïãú ÏÑ†ÌÉùÌï† Ïàò ÏûàÎèÑÎ°ù)
                    e.target.value = '';
                });
                console.log('ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® Ï≤®Î∂ÄÌååÏùº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            } else {
                console.warn('dateMemoAttachment ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }
        }

        // Î©îÎ™® Î™®Îã¨ ÎìúÎûòÍ∑∏ Í∏∞Îä•
        function initMemoModalDrag() {
            let isDragging = false;
            let dragOffset = { x: 0, y: 0 };
            let currentModal = null;
            let dragStarted = false;

            // Î™®Îì† Î©îÎ™® Î™®Îã¨Ïóê ÎìúÎûòÍ∑∏ Í∏∞Îä• Ï∂îÍ∞Ä
            const modalIds = ['dateMemoModal', 'memoDetailModal'];
            
            modalIds.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal) {
                    const modalContent = modal.querySelector('.memo-modal-content');
                    const header = modal.querySelector('.memo-header');
                    
                    if (header && modalContent) {
                        header.addEventListener('mousedown', function(e) {
                            // X Î≤ÑÌäº ÏûêÏ≤¥Îäî ÎìúÎûòÍ∑∏ÌïòÏßÄ ÏïäÏùå
                            if (e.target.classList.contains('close-btn') || e.target.id === 'closeDateMemo' || e.target.id === 'closeMemoDetail') {
                                e.stopPropagation();
                                console.log('üéØ X Î≤ÑÌäº ÌÅ¥Î¶≠ Í∞êÏßÄ - ÎìúÎûòÍ∑∏ Î∞©ÏßÄ');
                                return;
                            }
                            startModalDrag(e, modalContent);
                        });
                    }
                }
            });

            document.addEventListener('mousemove', dragModal);
            document.addEventListener('mouseup', stopModalDrag);

            function startModalDrag(e, modalContent) {
                isDragging = true;
                dragStarted = false;
                currentModal = modalContent;
                
                const rect = modalContent.getBoundingClientRect();
                dragOffset.x = e.clientX - rect.left;
                dragOffset.y = e.clientY - rect.top;
                
                // Î™®Îã¨ÏùÑ ÎìúÎûòÍ∑∏ Î™®ÎìúÎ°ú Ï†ÑÌôò
                modalContent.classList.add('dragging');
                modalContent.style.position = 'absolute';
                modalContent.style.left = rect.left + 'px';
                modalContent.style.top = rect.top + 'px';
                modalContent.style.margin = '0';
                
                // Î™®Îã¨ Ïª®ÌÖåÏù¥ÎÑàÎèÑ ÎìúÎûòÍ∑∏ Î™®ÎìúÎ°ú Ï†ÑÌôò
                const modal = modalContent.closest('.memo-modal');
                if (modal) {
                    modal.classList.add('has-positioned-content');
                }
                
                e.preventDefault();
            }

            function dragModal(e) {
                if (!isDragging || !currentModal) return;
                
                dragStarted = true;
                
                const x = e.clientX - dragOffset.x;
                const y = e.clientY - dragOffset.y;
                
                // ÌôîÎ©¥ Í≤ΩÍ≥Ñ ÌôïÏù∏
                const maxX = window.innerWidth - currentModal.offsetWidth;
                const maxY = window.innerHeight - currentModal.offsetHeight;
                
                const constrainedX = Math.max(0, Math.min(x, maxX));
                const constrainedY = Math.max(0, Math.min(y, maxY));
                
                currentModal.style.left = constrainedX + 'px';
                currentModal.style.top = constrainedY + 'px';
            }

            function stopModalDrag() {
                if (isDragging && currentModal) {
                    currentModal.classList.remove('dragging');
                    
                    // Î™®Îã¨Ïù¥ ÎìúÎûòÍ∑∏ÎêòÏóàÏúºÎØÄÎ°ú absolute ÏúÑÏπò ÏÉÅÌÉú Ïú†ÏßÄ
                    const modal = currentModal.closest('.memo-modal');
                    if (modal) {
                        modal.classList.add('has-positioned-content');
                    }
                    
                    isDragging = false;
                    currentModal = null;
                    
                    // ÎìúÎûòÍ∑∏Í∞Ä ÏôÑÎ£åÎêú ÌõÑ Ïû†Ïãú ÌõÑ dragStarted ÏÉÅÌÉú Ìï¥Ï†ú
                    setTimeout(() => {
                        dragStarted = false;
                    }, 100);
                }
            }
            
            // ÎìúÎûòÍ∑∏ ÏÉÅÌÉú ÌôïÏù∏ Ìï®Ïàò
            window.isDragInProgress = function() {
                return dragStarted;
            };
        }

        // ÏµúÏÜåÌôî/ÏµúÎåÄÌôî Í∏∞Îä•
        function minimizeStickyMemo() {
            const stickyMemo = document.getElementById('stickyMemo');
            stickyMemo.classList.toggle('minimized');
            
            const minimizeBtn = document.getElementById('stickyMinimize');
            if (stickyMemo.classList.contains('minimized')) {
                minimizeBtn.textContent = '‚ñ°';
                minimizeBtn.title = 'Î≥µÏõê';
            } else {
                minimizeBtn.textContent = '‚àí';
                minimizeBtn.title = 'ÏµúÏÜåÌôî';
            }
        }

        function maximizeStickyMemo() {
            const stickyMemo = document.getElementById('stickyMemo');
            stickyMemo.classList.toggle('maximized');
            
            const maximizeBtn = document.getElementById('stickyMaximize');
            if (stickyMemo.classList.contains('maximized')) {
                maximizeBtn.textContent = '‚ßâ';
                maximizeBtn.title = 'Î≥µÏõê';
            } else {
                maximizeBtn.textContent = '‚ñ°';
                maximizeBtn.title = 'ÏµúÎåÄÌôî';
            }
        }

        function resetStickyMemoLock() {
            if (isMemosUnlocked) {
                isMemosUnlocked = false;
                const toggle = document.getElementById('stickyMemoLockToggle');
                if (toggle) {
                    const icon = toggle.querySelector('.lock-icon');
                    const text = toggle.querySelector('.lock-text');
                    toggle.classList.remove('unlocked');
                    icon.textContent = 'üîí';
                    text.textContent = 'Ïû†Í∏à';
                }
            }
        }

        // Ïä§Ìã∞ÌÇ§ Î©îÎ™® ÏúÑÏπò Ï†ÄÏû•/Î≥µÏõê
        function saveStickyMemoPosition(x, y) {
            const position = { x, y };
            localStorage.setItem('stickyMemoPosition', JSON.stringify(position));
        }

        function loadStickyMemoPosition() {
            try {
                const saved = localStorage.getItem('stickyMemoPosition');
                if (saved) {
                    const position = JSON.parse(saved);
                    const stickyMemo = document.getElementById('stickyMemo');
                    if (stickyMemo && position.x !== undefined && position.y !== undefined) {
                        stickyMemo.style.left = position.x + 'px';
                        stickyMemo.style.top = position.y + 'px';
                    }
                }
            } catch (error) {
                console.error('Ïä§Ìã∞ÌÇ§ Î©îÎ™® ÏúÑÏπò Î≥µÏõê Ïò§Î•ò:', error);
            }
        }

        // toggleStickyMemoLock Ìï®Ïàò Ï†úÍ±∞Îê® (Î©îÎ™® Î¶¨Ïä§Ìä∏Í∞Ä ÏóÜÏúºÎØÄÎ°ú Î∂àÌïÑÏöî)

        function saveMemo() {
            const title = document.getElementById('memoTitleInput').value.trim();
            const content = document.getElementById('memoContentInput').value.trim();

            if (!title) {
                alert('Î©îÎ™® Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }

            const memo = {
                id: Date.now(),
                title: title,
                content: content,
                date: new Date().toLocaleDateString('ko-KR'),
                timestamp: new Date().toISOString()
            };

            // localStorageÏóêÏÑú ÏµúÏã† Î©îÎ™®Î•º Í∞ÄÏ†∏ÏôÄÏÑú Ï∂îÍ∞Ä
            const currentMemos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
            currentMemos.unshift(memo);
            
            const saveResult = safelyStoreData('calendarMemos', currentMemos);
            if (!saveResult.success) {
                alert('Î©îÎ™® Ï†ÄÏû• Ïã§Ìå®: ' + saveResult.message);
                return;
            }
            
            clearMemoForm();
            loadMemos();
            
            // alert('Î©îÎ™®Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§! üìù'); // Î©îÏãúÏßÄ Ï†úÍ±∞
        }

        // ÌÜµÌï© Î©îÎ™® ÏãúÏä§ÌÖúÏúºÎ°ú ÎåÄÏ≤¥Îê® - Ï∂©Îèå Î∞©ÏßÄÎ•º ÏúÑÌï¥ ÎπÑÌôúÏÑ±Ìôî
        /*
        function loadMemos() {
            const memoList = document.getElementById('memoList');
            
            // localStorageÏóêÏÑú ÏµúÏã† Î©îÎ™® Î°úÎìú
            const currentMemos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
            
            if (currentMemos.length === 0) {
                memoList.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">Ï†ÄÏû•Îêú Î©îÎ™®Í∞Ä ÏóÜÏäµÎãàÎã§</div>';
                return;
            }

            memoList.innerHTML = currentMemos.map(memo => `
                <div class="memo-item ${isMemosUnlocked ? 'unlocked' : ''}" onclick="openMemoDetail(${memo.id})">
                    <div class="memo-item-title">${memo.title}</div>
                    <div class="memo-item-content">${memo.content.substring(0, 100)}${memo.content.length > 100 ? '...' : ''}</div>
                    <div class="memo-item-date">${memo.date}</div>
                    <div class="memo-item-preview">ÌÅ¥Î¶≠ÌïòÏó¨ Î≥¥Í∏∞</div>
                    <button class="memo-item-delete ${isMemosUnlocked ? 'visible' : ''}" onclick="event.stopPropagation(); deleteMemoFromList(${memo.id})">‚úï</button>
                </div>
            `).join('');
        }
        */

        // Î©îÎ™® ÏÉÅÏÑ∏Î≥¥Í∏∞ Í∏∞Îä• (HTML ÏõêÎ≥∏)
        // Î©îÎ™® ÏÉÅÏÑ∏Î≥¥Í∏∞ Í∏∞Îä•
        let currentMemoId = null;

        function openMemoDetail(id) {
            console.log('üìã openMemoDetail Ìò∏Ï∂úÎê®, ID:', id, 'ÌòÑÏû¨ ID:', currentMemoId);
            
            // Ïù¥ÎØ∏ Í∞ôÏùÄ Î©îÎ™® ÏÉÅÏÑ∏Í∞Ä Ïó¥Î†§ÏûàÏúºÎ©¥ Ïã§ÌñâÌïòÏßÄ ÏïäÏùå (Ï§ëÎ≥µ Î∞©ÏßÄ)
            const memoDetailModal = document.getElementById('memoDetailModal');
            if (memoDetailModal && memoDetailModal.style.display === 'block' && currentMemoId === id) {
                console.log('üîÑ Ïù¥ÎØ∏ Í∞ôÏùÄ Î©îÎ™® ÏÉÅÏÑ∏Í∞Ä Ïó¥Î†§ÏûàÏùå:', id);
                return;
            }
            
            // Ïù¥ÎØ∏ Ï≤òÎ¶¨ Ï§ëÏù∏ Í≤ΩÏö∞ Î¨¥Ïãú
            if (window._openingMemoDetail) {
                console.log('‚è≥ Î©îÎ™® ÏÉÅÏÑ∏ Ïó¥Í∏∞ ÏßÑÌñâ Ï§ë, Î¨¥Ïãú:', id);
                return;
            }
            
            window._openingMemoDetail = true;
            
            // ÏµúÏã† Î©îÎ™® Îç∞Ïù¥ÌÑ∞Î•º localStorageÏóêÏÑú ÏßÅÏ†ë Î°úÎìú (Ï≤®Î∂ÄÌååÏùº ID ÎèôÍ∏∞ÌôîÎ•º ÏúÑÌï¥)
            console.log('üîÑ ÏµúÏã† Î©îÎ™® Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÏûë...');
            let allMemos = [];
            try {
                const storedMemos = localStorage.getItem('calendarMemos');
                if (storedMemos) {
                    allMemos = JSON.parse(storedMemos);
                    console.log('‚úÖ localStorageÏóêÏÑú Î©îÎ™® Î°úÎìú ÏôÑÎ£å:', allMemos.length, 'Í∞ú');
                }
            } catch (error) {
                console.error('‚ùå localStorageÏóêÏÑú Î©îÎ™® Î°úÎìú Ïã§Ìå®:', error);
            }
            
            // ÏµúÏã† Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Ìï¥Îãπ Î©îÎ™® Ï∞æÍ∏∞
            let memo = allMemos.find(m => m.id == id);
            
            // ÏµúÏã† Îç∞Ïù¥ÌÑ∞Ïóê ÏóÜÏúºÎ©¥ Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Ï∞æÍ∏∞ (Ìè¥Î∞±)
            if (!memo && window.MemoSystem && window.MemoSystem.data) {
                memo = window.MemoSystem.data.find(m => m.id == id);
                console.log('‚ö†Ô∏è localStorageÏóêÏÑú Ï∞æÏßÄ Î™ªÌï¥ MemoSystemÏóêÏÑú Ï∞æÏùå');
            }
            if (!memo) {
                // localStorageÏóêÏÑú ÏµúÏã† Î©îÎ™®Î•º Í∞ÄÏ†∏ÏôÄÏÑú Ï∞æÍ∏∞
                const currentMemos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
                memo = currentMemos.find(m => m.id == id);
                console.log('‚ö†Ô∏è MemoSystemÏóêÏÑúÎèÑ Ï∞æÏßÄ Î™ªÌï¥ localStorageÏóêÏÑú Ï∞æÏùå');
            }
            
            if (!memo) {
                console.error('‚ùå Î©îÎ™®Î•º Ï∞æÏùÑ Ïàò ÏóÜÏùå:', id);
                return;
            }

            console.log('üìã Î©îÎ™® ÏÉÅÏÑ∏ Ïó¥Í∏∞:', memo.title, '(ID:', id, ')');
            currentMemoId = id;
            
            // ÏÉÅÏÑ∏ Î™®Îã¨Ïóê ÎÇ¥Ïö© Ï±ÑÏö∞Í∏∞
            document.getElementById('memoDetailTitle').textContent = memo.title;
            document.getElementById('memoDetailDate').textContent = `üìÖ ${memo.date}`;
            
            // Î¶¨Ïπò ÌÖçÏä§Ìä∏Ïù∏ Í≤ΩÏö∞ HTMLÎ°ú, ÏùºÎ∞ò ÌÖçÏä§Ìä∏Ïù∏ Í≤ΩÏö∞ ÌÖçÏä§Ìä∏Î°ú ÌëúÏãú
            const bodyElement = document.getElementById('memoDetailBody');
            
            // ÏùºÏ†ï Î©îÎ™®Ïù∏ Í≤ΩÏö∞ Ï∂îÍ∞Ä Ï†ïÎ≥¥ ÌëúÏãú
            if (memo.isSchedule && memo.scheduleData) {
                const scheduleInfo = memo.scheduleData;
                let detailContent = '';
                
                // ÏãúÍ∞Ñ Ï†ïÎ≥¥
                detailContent += `‚è∞ <strong>ÏãúÍ∞Ñ:</strong> ${scheduleInfo.time}\n`;
                
                // ÏïåÎûå Ï†ïÎ≥¥
                if (scheduleInfo.alarm?.enabled) {
                    const alarmBefore = scheduleInfo.alarm.minutesBefore;
                    const alarmText = alarmBefore === 0 ? 'Î∞îÎ°ú ÏïåÎ¶º' : `${alarmBefore}Î∂Ñ Ï†Ñ`;
                    detailContent += `üîî <strong>ÏïåÎûå:</strong> ${alarmText}\n`;
                    
                    if (scheduleInfo.alarm.message) {
                        detailContent += `üìù <strong>ÏïåÎûå Î©îÏãúÏßÄ:</strong> ${scheduleInfo.alarm.message}\n`;
                    }
                }
                
                // ÏÑ§Î™Ö
                if (scheduleInfo.description && scheduleInfo.description.trim()) {
                    detailContent += `\nüìã <strong>ÎÇ¥Ïö©:</strong>\n${scheduleInfo.description}`;
                }
                
                bodyElement.innerHTML = detailContent.replace(/\n/g, '<br>');
            } else {
                // ÏùºÎ∞ò Î©îÎ™® Ï≤òÎ¶¨
                if (memo.isRichText) {
                    bodyElement.innerHTML = memo.content;
                } else {
                    bodyElement.textContent = memo.content;
                }
            }
            
            // Ï≤®Î∂ÄÌååÏùº ÌëúÏãú (ÏµúÏã† Îç∞Ïù¥ÌÑ∞ Í∏∞Ï§Ä)
            const attachmentContainer = document.getElementById('memoDetailAttachments');
            if (attachmentContainer) {
                if (memo.attachments && memo.attachments.length > 0) {
                    attachmentContainer.style.display = 'block';
                    const attachmentList = attachmentContainer.querySelector('.attachment-list');
                    if (attachmentList) {
                        console.log('üìé Ï≤®Î∂ÄÌååÏùº ÌëúÏãú ÏãúÏûë:', memo.attachments.length, 'Í∞ú');
                        attachmentList.innerHTML = memo.attachments.map((attachment, index) => {
                            const useIndexedDB = attachment.useIndexedDB || attachment.indexedDbId;
                            const dataOrId = useIndexedDB ? attachment.indexedDbId : attachment.data;
                            const storageIcon = useIndexedDB ? 'üíæ' : 'üìé';
                            
                            console.log(`üìé Ï≤®Î∂ÄÌååÏùº ${index + 1}:`, {
                                name: attachment.name,
                                useIndexedDB,
                                indexedDbId: attachment.indexedDbId,
                                dataOrId
                            });
                            
                            return `
                            <div class="attachment-item">
                                <div class="attachment-info">
                                    <span class="attachment-icon">${getFileIcon(attachment.name)}</span>
                                    <span class="attachment-name" title="${attachment.name}">${attachment.name}</span>
                                    <span class="attachment-size">${formatFileSize(attachment.size)}</span>
                                    <span class="attachment-status">${storageIcon}</span>
                                </div>
                                <button class="btn-attachment" onclick="downloadAttachment('${attachment.name}', ${useIndexedDB ? attachment.indexedDbId : `'${attachment.data}'`}, '${attachment.type}', ${useIndexedDB})">
                                    üíæ Îã§Ïö¥Î°úÎìú
                                </button>
                            </div>
                        `}).join('');
                        console.log('‚úÖ Ï≤®Î∂ÄÌååÏùº UI ÏÉùÏÑ± ÏôÑÎ£å');
                    }
                } else {
                    attachmentContainer.style.display = 'none';
                    console.log('üìé Ï≤®Î∂ÄÌååÏùº ÏóÜÏùå - Ïª®ÌÖåÏù¥ÎÑà Ïà®ÍπÄ');
                }
            }
            
            // ÏÉÅÏÑ∏ Î™®Îã¨ ÏúÑÏπò ÏÑ§Ï†ï (Ïù¥ÎØ∏ ÏúÑÏóêÏÑú ÏÑ†Ïñ∏Îêú memoDetailModal Ïû¨ÏÇ¨Ïö©)
            const modalContent = memoDetailModal.querySelector('.memo-modal-content');
            
            // Îã¨Î†• Ïª®ÌÖåÏù¥ÎÑà ÏúÑÏπò Í≥ÑÏÇ∞
            const calendarContainer = document.querySelector('.calendar-container');
            const containerRect = calendarContainer.getBoundingClientRect();
            
            // Î™®Îã¨ÏùÑ Îã¨Î†• Ï§ëÏïôÏóê Î∞∞Ïπò
            const modalWidth = 500;
            const modalHeight = 400;
            
            const centerX = containerRect.left + (containerRect.width - modalWidth) / 2;
            const centerY = containerRect.top + (containerRect.height - modalHeight) / 2;
            
            // ÌôîÎ©¥ Í≤ΩÍ≥Ñ ÌôïÏù∏
            const maxX = window.innerWidth - modalWidth - 20;
            const maxY = window.innerHeight - modalHeight - 20;
            
            const constrainedX = Math.max(20, Math.min(centerX, maxX));
            const constrainedY = Math.max(20, Math.min(centerY, maxY));
            
            // Î™®Îã¨ÏùÑ Ï§ëÏïôÏóê Ï†ïÏÉÅÏ†ÅÏúºÎ°ú ÌëúÏãú (absolute positioning Ï†úÍ±∞)
            modalContent.style.position = '';
            modalContent.style.left = '';
            modalContent.style.top = '';
            modalContent.style.margin = '';
            modalContent.classList.remove('dragging');
            
            // z-indexÎ•º Í∞ÄÏû• ÎÜíÍ≤å ÏÑ§Ï†ïÌïòÏó¨ Îã§Î•∏ Î™®Îì† Î™®Îã¨Î≥¥Îã§ ÏïûÏóê ÌëúÏãú
            memoDetailModal.style.zIndex = '999999';
            
            // ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨Ïù¥ Ïó¥Î†§ÏûàÎã§Î©¥ ÏûÑÏãúÎ°ú z-indexÎ•º ÎÇÆÏ∂§ (Îí§Î°ú Î≥¥ÎÉÑ)
            const dateMemoModal = document.getElementById('dateMemoModal');
            if (dateMemoModal && dateMemoModal.style.display === 'block') {
                dateMemoModal.style.zIndex = '99998';
                console.log('üìã ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ÏùÑ Îí§Î°ú Î≥¥ÎÉÑ (Î©îÎ™® ÏÉÅÏÑ∏Î≥¥Í∏∞ Ïö∞ÏÑ†)');
            }
            
            // ÏÉÅÏÑ∏ Î™®Îã¨ ÌëúÏãú - Ï†ÑÏ≤¥ ÌôîÎ©¥ Ïò§Î≤ÑÎ†àÏù¥ Í∞ïÏ†ú Ï†ÅÏö©
            // Î®ºÏ†Ä Í∏∞Ï°¥ Í∞ïÏ†ú Ïà®Í∏∞Í∏∞ Ïä§ÌÉÄÏùºÎì§ Ï†úÍ±∞
            memoDetailModal.style.removeProperty('display');
            memoDetailModal.style.removeProperty('visibility');
            memoDetailModal.style.removeProperty('opacity');
            memoDetailModal.style.removeProperty('pointer-events');
            
            memoDetailModal.style.display = 'block';
            memoDetailModal.style.visibility = 'visible';
            memoDetailModal.style.position = 'fixed';
            memoDetailModal.style.top = '0';
            memoDetailModal.style.left = '0';
            memoDetailModal.style.width = '100vw';
            memoDetailModal.style.height = '100vh';
            memoDetailModal.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';
            
            console.log('üìã Î©îÎ™® ÏÉÅÏÑ∏ Î™®Îã¨ ÌëúÏãú - Í∞ïÏ†ú Ïä§ÌÉÄÏùº Ï†úÍ±∞ ÌõÑ ÌëúÏãú');
            
            // Î∂ÄÎìúÎü¨Ïö¥ Ïó¥Í∏∞ Ïï†ÎãàÎ©îÏù¥ÏÖò
            memoDetailModal.classList.add('opening');
            setTimeout(() => {
                memoDetailModal.classList.remove('opening');
                // Ïó¥Í∏∞ ÏôÑÎ£å ÌõÑ ÌîåÎûòÍ∑∏ Ìï¥Ï†ú
                window._openingMemoDetail = false;
                console.log('‚úÖ Î©îÎ™® ÏÉÅÏÑ∏ Ïó¥Í∏∞ ÏôÑÎ£å, ÌîåÎûòÍ∑∏ Ìï¥Ï†ú');
            }, 300);
        }

        function closeMemoDetail() {
            console.log('üîí closeMemoDetail Ìò∏Ï∂úÎê®');
            const memoDetailModal = document.getElementById('memoDetailModal');
            if (!memoDetailModal) {
                console.log('‚ùå memoDetailModalÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                return;
            }
            
            const modalContent = memoDetailModal.querySelector('.memo-modal-content');
            if (modalContent) {
                // Î™®Îã¨ ÏúÑÏπò Î∞è Ïä§ÌÉÄÏùº Î¶¨ÏÖã
                modalContent.style.position = '';
                modalContent.style.left = '';
                modalContent.style.top = '';
                modalContent.style.margin = '';
                modalContent.classList.remove('dragging');
            }
            
            // Ï¶âÏãú Î™®Îã¨ Îã´Í∏∞ (Ïï†ÎãàÎ©îÏù¥ÏÖò Ï†úÍ±∞)
            console.log('üîí Ï¶âÏãú Î™®Îã¨ Îã´Í∏∞ ÏãúÏûë');
            
            memoDetailModal.style.transition = 'none';
            memoDetailModal.style.display = 'none';
            memoDetailModal.style.visibility = 'hidden'; // visibilityÎèÑ hiddenÏúºÎ°ú ÏÑ§Ï†ï
            memoDetailModal.classList.remove('closing', 'opening');
            
            // Î™®Îã¨ Ïª®ÌÖåÏù¥ÎÑàÎèÑ Î¶¨ÏÖã
            memoDetailModal.classList.remove('has-positioned-content');
            
            // Î™®Îì† Ïù∏ÎùºÏù∏ Ïä§ÌÉÄÏùº Ï†úÍ±∞ (displayÏôÄ visibility Ï†úÏô∏)
            memoDetailModal.style.position = '';
            memoDetailModal.style.top = '';
            memoDetailModal.style.left = '';
            memoDetailModal.style.width = '';
            memoDetailModal.style.height = '';
            memoDetailModal.style.zIndex = '';
            
            // ÎîîÎ≤ÑÍπÖÏùÑ ÏúÑÌïú ÏµúÏ¢Ö ÏÉÅÌÉú Î°úÍ∑∏
            console.log('üìä Î©îÎ™® ÏÉÅÏÑ∏ Î™®Îã¨ ÏµúÏ¢Ö ÏÉÅÌÉú:', {
                display: memoDetailModal.style.display,
                visibility: memoDetailModal.style.visibility,
                classList: memoDetailModal.classList.toString()
            });
            
            // Í∞ïÏ†úÎ°ú Î™®Îã¨ ÏôÑÏ†Ñ Ïà®Í∏∞Í∏∞
            setTimeout(() => {
                const modal = document.getElementById('memoDetailModal');
                if (modal && modal.style.display === 'none') {
                    modal.style.setProperty('display', 'none', 'important');
                    modal.style.setProperty('visibility', 'hidden', 'important');
                    modal.style.setProperty('opacity', '0', 'important');
                    modal.style.setProperty('pointer-events', 'none', 'important');
                    console.log('üîí Î©îÎ™® ÏÉÅÏÑ∏ Î™®Îã¨ Í∞ïÏ†ú Ïà®Í∏∞Í∏∞ ÏôÑÎ£å');
                }
            }, 100);
            
            currentMemoId = null;
            
            // ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨Ïùò z-indexÎ•º ÏõêÎûòÎåÄÎ°ú Î≥µÏõê
            const dateMemoModal = document.getElementById('dateMemoModal');
            if (dateMemoModal && dateMemoModal.style.display === 'block') {
                dateMemoModal.style.zIndex = '99999';
                console.log('üìã ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ z-index Î≥µÏõê');
                
                // Î¨¥Ìïú Î∞òÎ≥µ Î∞©ÏßÄ: displayDateMemos Ìò∏Ï∂ú ÏôÑÏ†Ñ Ï†úÍ±∞
                // setTimeout(() => {
                //     if (window.displayDateMemos) {
                //         console.log('üìã ÏßÄÏó∞Îêú ÎÇ†Ïßú Î©îÎ™® Î¶¨Ïä§Ìä∏ ÏÉàÎ°úÍ≥†Ïπ®');
                //         window.displayDateMemos();
                //     }
                // }, 100);
                console.log('üìã Î¨¥Ìïú Î∞òÎ≥µ Î∞©ÏßÄ: Î©îÎ™® ÏÉÅÏÑ∏Ï∞Ω Îã´Ìûå ÌõÑ ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® ÏÉùÎûµ');
            }
            
            console.log('‚úÖ Î™®Îã¨ Îã´Í∏∞ ÏôÑÎ£å');
            
            // ÌîåÎûòÍ∑∏ Ìï¥Ï†ú
            window._openingMemoDetail = false;
        }

        function editMemo() {
            console.log('üìù editMemo Ìò∏Ï∂úÎê®, currentMemoId:', currentMemoId);
            
            if (!currentMemoId) {
                console.error('‚ùå currentMemoIdÍ∞Ä ÏóÜÏäµÎãàÎã§');
                return;
            }
            
            // localStorageÏóêÏÑú ÏµúÏã† Î©îÎ™®Î•º Í∞ÄÏ†∏ÏôÄÏÑú Ï∞æÍ∏∞
            const currentMemos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
            const memo = currentMemos.find(m => m.id == currentMemoId); // == ÏúºÎ°ú Î≥ÄÍ≤Ω (Î¨∏ÏûêÏó¥/Ïà´Ïûê ÎπÑÍµê)
            if (!memo) {
                console.error('Ìé∏ÏßëÌï† Î©îÎ™®Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. ID:', currentMemoId);
                console.log('ÌòÑÏû¨ Î©îÎ™® Î™©Î°ù:', currentMemos.map(m => ({ id: m.id, title: m.title })));
                return;
            }
            
            console.log('üìù Î©îÎ™® Ìé∏Ïßë ÏãúÏûë:', memo);
            
            // Ìé∏ÏßëÌï† IDÎ•º ÎØ∏Î¶¨ Ï†ÄÏû•
            const editMemoId = currentMemoId;
            
            // Ìé∏ÏßëÌï† Îç∞Ïù¥ÌÑ∞ ÎØ∏Î¶¨ Ï§ÄÎπÑ
            let editTitle = memo.title;
            let editContent = memo.content;
            const editDate = memo.date;
            
            // ÏùºÏ†ï Î©îÎ™®Ïùò Í≤ΩÏö∞ Ï†úÎ™©ÏóêÏÑú üìÖ ÏïÑÏù¥ÏΩò Ï†úÍ±∞
            if (memo.isSchedule && editTitle.startsWith('üìÖ ')) {
                editTitle = editTitle.substring(2);
            }
            
            // ÏùºÏ†ï Î©îÎ™®Ïùò Í≤ΩÏö∞ contentÏóêÏÑú ÏãúÍ∞Ñ Ï†ïÎ≥¥ Î∂ÑÎ¶¨
            if (memo.isSchedule && memo.scheduleData) {
                // ÏõêÎ≥∏ ÏùºÏ†ï Îç∞Ïù¥ÌÑ∞ÏóêÏÑú description ÏÇ¨Ïö©
                editContent = memo.scheduleData.description || 'ÏùºÏ†ï';
            } else if (editContent.includes('‚è∞') && editContent.includes(' | ')) {
                // ÏãúÍ∞Ñ Ï†ïÎ≥¥Í∞Ä Ìè¨Ìï®Îêú Í≤ΩÏö∞ ÏãúÍ∞Ñ Î∂ÄÎ∂Ñ Ï†úÍ±∞
                const parts = editContent.split(' | ');
                if (parts.length > 1) {
                    editContent = parts.slice(1).join(' | ');
                }
            }
            
            console.log('üìù Ìé∏Ïßë Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ:', { editMemoId, editTitle, editContent, editDate });
            
            // Î©îÎ™® ÏÇ≠Ï†ú (Ìé∏Ïßë Î™®ÎìúÎ°ú Ï†ÑÌôòÌïòÍ∏∞ ÏúÑÌï¥) - closeMemoDetail Ï†ÑÏóê Ïã§Ìñâ
            console.log('üóëÔ∏è Î©îÎ™® ÏÇ≠Ï†ú Ïã§Ìñâ:', editMemoId);
            deleteMemo(editMemoId);
            
            // ÏÉÅÏÑ∏ Î™®Îã¨ Îã´Í∏∞ (ÏÇ≠Ï†ú ÌõÑ Ïã§Ìñâ)
            closeMemoDetail();
            
            // ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® Î™®Îã¨ Ïó¥Í∏∞
            setTimeout(() => {
                if (window.openDateMemoModal) {
                    const date = new Date(editDate);
                    window.openDateMemoModal(date.getFullYear(), date.getMonth() + 1, date.getDate());
                    
                    // Î™®Îã¨Ïù¥ Ïó¥Î¶∞ ÌõÑ ÏûÖÎ†•Ï∞ΩÏóê Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï
                    setTimeout(() => {
                        const dateTitleInput = document.getElementById('dateMemoTitleInput');
                        const dateContentInput = document.getElementById('dateMemoContentInput');
                        
                        if (dateTitleInput && dateContentInput) {
                            dateTitleInput.value = editTitle;
                            dateContentInput.value = editContent;
                            
                            console.log('‚úÖ Ìé∏Ïßë Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï ÏôÑÎ£å');
                            
                            // ÏûÖÎ†•Ï∞ΩÏóê Ìè¨Ïª§Ïä§
                            dateTitleInput.focus();
                        } else {
                            console.error('‚ùå ÏûÖÎ†•Ï∞ΩÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                        }
                    }, 200);
                }
            }, 100);
            
            if (false) { // Í∏∞Ï°¥ ÏΩîÎìú Î∏îÎ°ù ÎπÑÌôúÏÑ±Ìôî
                alert('Ìé∏Ïßë Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§. ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® ÏûÖÎ†•Ï∞ΩÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
            }
        }

        function deleteMemoFromDetail() {
            if (!currentMemoId) return;
            
            // localStorageÏóêÏÑú ÏµúÏã† Î©îÎ™®Î•º Í∞ÄÏ†∏ÏôÄÏÑú Ï∞æÍ∏∞
            const currentMemos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
            const memo = currentMemos.find(m => m.id === currentMemoId);
            if (!memo) return;
            
            // Ïû†Í∏à ÏÉÅÌÉú ÌôïÏù∏ - ÎÇ†ÏßúÎ≥Ñ Î©îÎ™®Ïù∏ÏßÄ ÏùºÎ∞ò Î©îÎ™®Ïù∏ÏßÄ Íµ¨Î∂Ñ
            const currentDate = selectedDate; // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÎÇ†Ïßú
            const isDateMemo = memo.date === currentDate; // ÌòÑÏû¨ ÎÇ†ÏßúÏùò Î©îÎ™®Ïù∏ÏßÄ ÌôïÏù∏
            
            if (isDateMemo && !isDateMemosUnlocked) {
                alert('üîí ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® ÏÇ≠Ï†úÍ∞Ä Ïû†Í≤®ÏûàÏäµÎãàÎã§!\n\nÎ®ºÏ†Ä üîì Ïû†Í∏àÏùÑ Ìï¥Ï†úÌïòÏÑ∏Ïöî.');
                return;
            } else if (!isDateMemo && !isMemosUnlocked) {
                alert('üîí Î©îÎ™® ÏÇ≠Ï†úÍ∞Ä Ïû†Í≤®ÏûàÏäµÎãàÎã§!\n\nÎ®ºÏ†Ä üîì Ïû†Í∏àÏùÑ Ìï¥Ï†úÌïòÏÑ∏Ïöî.');
                return;
            }
            
            // Ïû†Í∏àÏù¥ Ìï¥Ï†úÎêú Í≤ΩÏö∞ÏóêÎßå ÌôïÏù∏ ÌõÑ ÏÇ≠Ï†ú
            if (confirm(`"${memo.title}" Î©îÎ™®Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                console.log('üóëÔ∏è Î©îÎ™® ÏÉÅÏÑ∏ÏóêÏÑú ÏÇ≠Ï†ú ÏßÑÌñâ:', memo.title, '(Ïû†Í∏à Ìï¥Ï†ú ÏÉÅÌÉú)');
                deleteMemo(currentMemoId);
                closeMemoDetail();
                updateCalendarDisplay();
            }
        }

        function deleteMemo(id) {
            // localStorageÏóêÏÑú ÏµúÏã† Î©îÎ™®Î•º Í∞ÄÏ†∏ÏôÄÏÑú ÏÇ≠Ï†ú
            let currentMemos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
            currentMemos = currentMemos.filter(m => m.id !== id);
            
            const saveResult = safelyStoreData('calendarMemos', currentMemos);
            if (!saveResult.success) {
                alert('Î©îÎ™® ÏÇ≠Ï†ú Ïã§Ìå®: ' + saveResult.message);
                return;
            }
            
            loadMemos();
            if (window.displayDateMemos) window.displayDateMemos(); // ÎÇ†ÏßúÎ≥Ñ Î©îÎ™®ÎèÑ ÏÉàÎ°úÍ≥†Ïπ®
        }

        // Î©îÎ™® Î¶¨Ïä§Ìä∏ÏóêÏÑú ÏßÅÏ†ë ÏÇ≠Ï†ú Í∏∞Îä•
        function deleteMemoFromList(id) {
            // localStorageÏóêÏÑú ÏµúÏã† Î©îÎ™®Î•º Í∞ÄÏ†∏ÏôÄÏÑú Ï∞æÍ∏∞
            const currentMemos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
            const memo = currentMemos.find(m => m.id === id);
            if (!memo) return;
            
            // ÌôïÏù∏ ÏóÜÏù¥ Î∞îÎ°ú ÏÇ≠Ï†ú (Ïû†Í∏à Ìï¥Ï†ú ÏÉÅÌÉúÏóêÏÑúÎßå Í∞ÄÎä•ÌïòÎØÄÎ°ú ÏïàÏ†Ñ)
            deleteMemo(id);
            updateCalendarDisplay();
        }

        // Ïû†Í∏à/Ìï¥Ï†ú ÌÜ†Í∏Ä Í∏∞Îä•
        function toggleMemoLock() {
            isMemosUnlocked = !isMemosUnlocked;
            const toggle = document.getElementById('memoLockToggle');
            
            if (toggle) {
                const icon = toggle.querySelector('.lock-icon');
                const text = toggle.querySelector('.lock-text');
                
                if (isMemosUnlocked) {
                    toggle.classList.add('unlocked');
                    if (icon) icon.textContent = 'üîì';
                    if (text) text.textContent = 'Ìï¥Ï†úÎê®';
                } else {
                    toggle.classList.remove('unlocked');
                    if (icon) icon.textContent = 'üîí';
                    if (text) text.textContent = 'Ïû†Í∏à';
                }
                
                console.log('üîÑ Î©îÎ™® Ïû†Í∏à ÏÉÅÌÉú ÌÜ†Í∏Ä:', isMemosUnlocked ? 'Ìï¥Ï†ú' : 'Ïû†ÍπÄ');
            } else {
                console.warn('‚ö†Ô∏è memoLockToggle ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }
            
            // Î©îÎ™® Î¶¨Ïä§Ìä∏ ÏÉàÎ°úÍ≥†Ïπ® - ÏóêÎü¨ Î∞©ÏßÄ
            try {
                if (window.loadMemos) loadMemos();
            } catch (error) {
                console.warn('‚ö†Ô∏è loadMemos Ìò∏Ï∂ú Ï§ë Ïò§Î•ò:', error);
            }
        }

        function toggleDateMemoLock() {
            const startTime = Date.now();
            console.log('üéØ HTML toggleDateMemoLock Ìï®Ïàò Ìò∏Ï∂úÎê®');
            
            // ÏßÑÎã® ÏãúÏä§ÌÖúÏóê ÏÉÅÌò∏ÏûëÏö© Ï∂îÏ†Å
            if (window.DiagnosticSystem) {
                window.DiagnosticSystem.trackInteraction('HTML_TOGGLE_DATE_MEMO_LOCK', 'dateMemoLockToggle', true, 0);
            }
            
            isDateMemosUnlocked = !isDateMemosUnlocked;
            console.log('üîÑ Ïû†Í∏à ÏÉÅÌÉú Î≥ÄÍ≤Ω:', isDateMemosUnlocked ? 'Ìï¥Ï†ú' : 'Ïû†ÍπÄ');
            
            const toggle = document.getElementById('dateMemoLockToggle');
            
            if (toggle) {
                const icon = toggle.querySelector('.lock-icon');
                const text = toggle.querySelector('.lock-text');
                
                console.log('üîç ÏöîÏÜå Ï∞æÍ∏∞ Í≤∞Í≥º:', {toggle: !!toggle, icon: !!icon, text: !!text});
                
                if (isDateMemosUnlocked) {
                    toggle.classList.add('unlocked');
                    if (icon) icon.textContent = 'üîì';
                    if (text) text.textContent = 'Ìï¥Ï†úÎê®';
                } else {
                    toggle.classList.remove('unlocked');
                    if (icon) icon.textContent = 'üîí';
                    if (text) text.textContent = 'Ïû†Í∏à';
                }
                
                console.log('‚úÖ ÎÇ†Ïßú Î©îÎ™® Ïû†Í∏à ÏÉÅÌÉú ÌÜ†Í∏Ä ÏôÑÎ£å:', isDateMemosUnlocked ? 'Ìï¥Ï†ú' : 'Ïû†ÍπÄ');
            } else {
                console.warn('‚ö†Ô∏è dateMemoLockToggle ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }
            
            // ÎÇ†ÏßúÎ≥Ñ Î©§Î™® Î¶¨Ïä§Ìä∏ ÏÉàÎ°úÍ≥†Ïπ® - ÏóêÎü¨ Î∞©ÏßÄ
            try {
                if (window.displayDateMemos) {
                    console.log('üîÑ displayDateMemos Ìò∏Ï∂ú');
                    window.displayDateMemos();
                } else {
                    console.warn('‚ö†Ô∏è displayDateMemos Ìï®ÏàòÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è displayDateMemos Ìò∏Ï∂ú Ï§ë Ïò§Î•ò:', error);
                
                if (window.DiagnosticSystem) {
                    window.DiagnosticSystem.detectIssue('HTML_FUNCTION_ERROR', 'displayDateMemos Ìò∏Ï∂ú Ïã§Ìå®', {
                        error: error.message,
                        function: 'toggleDateMemoLock',
                        severity: 'error'
                    });
                }
            }
            
            // ÏÑ±Îä• Ï∏°Ï†ï Î∞è ÏôÑÎ£å Î°úÍ∑∏
            const duration = Date.now() - startTime;
            if (window.DiagnosticSystem) {
                window.DiagnosticSystem.measurePerformance('HTML_toggleDateMemoLock', startTime);
            }
            
            console.log(`‚úÖ HTML toggleDateMemoLock ÏôÑÎ£å: ${isDateMemosUnlocked ? 'Ìï¥Ï†ú' : 'Ïû†ÍπÄ'} (${duration}ms)`);
        }

        // Ïû†Í∏à ÏÉÅÌÉú Î¶¨ÏÖã Ìï®ÏàòÎì§
        function resetMemoLock() {
            if (isMemosUnlocked) {
                isMemosUnlocked = false;
                const toggle = document.getElementById('memoLockToggle');
                if (toggle) {
                    const icon = toggle.querySelector('.lock-icon');
                    const text = toggle.querySelector('.lock-text');
                    toggle.classList.remove('unlocked');
                    icon.textContent = 'üîí';
                    text.textContent = 'Ïû†Í∏à';
                }
            }
        }

        function resetDateMemoLock() {
            console.log('üîÑ resetDateMemoLock Ìò∏Ï∂úÎê®, isDateMemosUnlocked:', isDateMemosUnlocked);
            
            // unified ÏãúÏä§ÌÖúÏù¥ Î≥ÄÏàòÎ•º ÎçÆÏñ¥Ïì∞ÎØÄÎ°ú Í∞ïÏ†úÎ°ú Ïû†Í∏à ÏÉÅÌÉú ÏÑ§Ï†ï
            isDateMemosUnlocked = false;
            console.log('üîí HTML Ïû†Í∏à ÏÉÅÌÉú Í∞ïÏ†ú ÏÑ§Ï†ï: Ïû†ÍπÄ');
            
            // unified ÏãúÏä§ÌÖúÏùò Ïû†Í∏à ÏÉÅÌÉúÎèÑ ÎèôÍ∏∞Ìôî
            if (typeof window.MemoSystem !== 'undefined' && window.MemoSystem.locks) {
                window.MemoSystem.locks.dateMemos = true;
                console.log('üîí unified ÏãúÏä§ÌÖú Ïû†Í∏à ÏÉÅÌÉú ÎèôÍ∏∞Ìôî: Ïû†ÍπÄ');
            }
            
            const toggle = document.getElementById('dateMemoLockToggle');
            if (toggle) {
                const icon = toggle.querySelector('.lock-icon');
                const text = toggle.querySelector('.lock-text');
                toggle.classList.remove('unlocked');
                
                // null Ï≤¥ÌÅ¨ Ï∂îÍ∞Ä
                if (icon) {
                    icon.textContent = 'üîí';
                } else {
                    console.warn('‚ö†Ô∏è lock-icon ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                }
                
                if (text) {
                    text.textContent = 'Ïû†Í∏à';
                } else {
                    console.warn('‚ö†Ô∏è lock-text ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                }
                
                console.log('üîí UI Ïû†Í∏à Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
            } else {
                console.warn('‚ö†Ô∏è dateMemoLockToggle ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }
        }

        // Í∏∞Ï°¥ viewMemo Ìï®ÏàòÎäî Ìò∏ÌôòÏÑ±ÏùÑ ÏúÑÌï¥ Ïú†ÏßÄ
        function viewMemo(id) {
            openMemoDetail(id);
        }

        // ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® Í∏∞Îä•
        function openDateMemoModal(year, month, date) {
            console.log('üìÖ openDateMemoModal HTML Ìï®Ïàò Ìò∏Ï∂úÎê®:', year, month, date);
            
            // Î™®Îã¨Ïù¥ Î∞©Í∏à Îã´Ìûå ÏÉÅÌÉúÎ©¥ Î¨¥Ïãú (Ïû¨Ïó¥Î¶º Î∞©ÏßÄ) - Í∞ôÏùÄ ÎÇ†ÏßúÎßå Ï∞®Îã®
            const targetDate = `${year}-${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
            if (modalJustClosed) {
                // Í∞ôÏùÄ ÎÇ†ÏßúÎßå Ï∞®Îã®ÌïòÍ≥†, Îã§Î•∏ ÎÇ†ÏßúÎäî ÌóàÏö©
                if (window.lastClosedModalDate === targetDate) {
                    console.log('üîí Í∞ôÏùÄ ÎÇ†Ïßú Î™®Îã¨ Ïû¨Ïó¥Î¶º Ï∞®Îã®:', targetDate);
                    return;
                } else {
                    console.log('üîÑ Îã§Î•∏ ÎÇ†ÏßúÏù¥ÎØÄÎ°ú Î™®Îã¨ Ïó¥Î¶º ÌóàÏö©:', targetDate);
                    modalJustClosed = false; // Îã§Î•∏ ÎÇ†ÏßúÎ©¥ Ï∞®Îã® Ìï¥Ï†ú
                    window.modalJustClosed = false;
                }
            }
            
            // Î™®Îã¨Ïù¥ Ïù¥ÎØ∏ Ïó¥Î†§ÏûàÍ≥† Í∞ôÏùÄ ÎÇ†ÏßúÎ©¥ Î¨¥Ïãú
            const dateMemoModal = document.getElementById('dateMemoModal');
            if (dateMemoModal && dateMemoModal.style.display === 'block' && selectedDate === targetDate) {
                console.log('üìÖ Í∞ôÏùÄ ÎÇ†Ïßú Î™®Îã¨Ïù¥ Ïù¥ÎØ∏ Ïó¥Î†§ÏûàÏùå, Î¨¥Ïãú:', targetDate);
                return;
            }
            
            selectedDate = targetDate;
            document.getElementById('dateMemoTitle').textContent = `üìÖ ${selectedDate} Î©îÎ™®`;
            
            // ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® Î™®Îã¨Îßå Ïó¥Í∏∞ (Ïä§Ìã∞ÌÇ§ Î©îÎ™®Îäî Ïó¥ÏßÄ ÏïäÏùå)
            const modalContent = dateMemoModal.querySelector('.memo-modal-content');
            
            // Îã¨Î†• Ïª®ÌÖåÏù¥ÎÑà ÏúÑÏπò Í≥ÑÏÇ∞
            const calendarContainer = document.querySelector('.calendar-container');
            const containerRect = calendarContainer.getBoundingClientRect();
            
            // Î™®Îã¨ÏùÑ Îã¨Î†• Ï§ëÏïôÏóê Î∞∞Ïπò
            const modalWidth = 500; // max-width Í∞í
            const modalHeight = 400; // ÏòàÏÉÅ ÎÜíÏù¥
            
            const centerX = containerRect.left + (containerRect.width - modalWidth) / 2;
            const centerY = containerRect.top + (containerRect.height - modalHeight) / 2;
            
            // ÌôîÎ©¥ Í≤ΩÍ≥Ñ ÌôïÏù∏
            const maxX = window.innerWidth - modalWidth - 20;
            const maxY = window.innerHeight - modalHeight - 20;
            
            const constrainedX = Math.max(20, Math.min(centerX, maxX));
            const constrainedY = Math.max(20, Math.min(centerY, maxY));
            
            // Î™®Îã¨ÏùÑ Ï§ëÏïôÏóê Ï†ïÏÉÅÏ†ÅÏúºÎ°ú ÌëúÏãú (absolute positioning Ï†úÍ±∞)
            modalContent.style.position = '';
            modalContent.style.left = '';
            modalContent.style.top = '';
            modalContent.style.margin = '';
            modalContent.classList.remove('dragging');
            
            // ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ ÌëúÏãú - Ï†ÑÏ≤¥ ÌôîÎ©¥ Ïò§Î≤ÑÎ†àÏù¥ Í∞ïÏ†ú Ï†ÅÏö©
            dateMemoModal.style.display = 'block';
            dateMemoModal.style.visibility = 'visible';
            dateMemoModal.style.position = 'fixed';
            dateMemoModal.style.top = '0';
            dateMemoModal.style.left = '0';
            dateMemoModal.style.width = '100vw';
            dateMemoModal.style.height = '100vh';
            dateMemoModal.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';
            
            // Ïô∏Î∂Ä ÌÅ¥Î¶≠ Î≥¥Ìò∏ Ï†úÍ±∞ - Í∞ÑÏÜåÌôîÎêú Î°úÏßÅ ÏÇ¨Ïö©
            
            // Î∂ÄÎìúÎü¨Ïö¥ Ïó¥Í∏∞ Ïï†ÎãàÎ©îÏù¥ÏÖò
            dateMemoModal.classList.add('opening');
            setTimeout(() => {
                dateMemoModal.classList.remove('opening');
            }, 300);
            
            // Ïä§Ìã∞ÌÇ§ Î©îÎ™®Í∞Ä Ïó¥Î†§ÏûàÎã§Î©¥ Îã´Í∏∞
            const stickyMemo = document.getElementById('stickyMemo');
            if (stickyMemo) {
                stickyMemo.style.setProperty('display', 'none', 'important');
            }
            
            // selectedDate Ï†ÑÏó≠ Î≥ÄÏàò ÏÑ§Ï†ï (displayDateMemosÍ∞Ä ÏÇ¨Ïö©)
            window.selectedDate = `${year}-${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
            
            if (window.displayDateMemos) window.displayDateMemos();
        }

        // Î™®Îã¨ Îã´Í∏∞ Ï§ëÎ≥µ Î∞©ÏßÄ ÌîåÎûòÍ∑∏
        let isDateMemoModalClosing = false;
        let modalJustClosed = false;
        let closeProtectionTimeout = null;
        let lastCloseTime = 0; // ÎßàÏßÄÎßâ Îã´Í∏∞ ÏãúÍ∞Ñ
        
        // Ï†ÑÏó≠ Ï†ëÍ∑ºÏùÑ ÏúÑÌï¥ ÎÖ∏Ï∂ú
        window.modalJustClosed = modalJustClosed;
        
        // ÎîîÎ≤ÑÍπÖÏö© Ï†ÑÏó≠ Ìï®Ïàò
        window.forceCloseDateMemoModal = function() {
            console.log('üî® Í∞ïÏ†úÎ°ú ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ Îã´Í∏∞');
            const modal = document.getElementById('dateMemoModal');
            if (modal) {
                modal.style.display = 'none';
                console.log('‚úÖ ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ Í∞ïÏ†ú Îã´Í∏∞ ÏôÑÎ£å');
            } else {
                console.log('‚ùå ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå');
            }
        };
        
        function closeDateMemoModal() {
            console.log('üîí closeDateMemoModal Ìò∏Ï∂úÎê®');
            
            // ÎÑàÎ¨¥ Îπ†Î•∏ Ï§ëÎ≥µ ÌÅ¥Î¶≠ Î∞©ÏßÄ (500ms Ïù¥ÎÇ¥)
            const now = Date.now();
            if (now - lastCloseTime < 500) {
                console.log('‚ö†Ô∏è ÎÑàÎ¨¥ Îπ†Î•∏ Ï§ëÎ≥µ Ìò∏Ï∂ú - Î¨¥Ïãú');
                return;
            }
            lastCloseTime = now;
            
            // Ïù¥ÎØ∏ Îã´ÌûàÎäî Ï§ëÏù¥Î©¥ Î¨¥Ïãú
            if (isDateMemoModalClosing) {
                console.log('‚ö†Ô∏è Ïù¥ÎØ∏ Îã´ÌûàÎäî Ï§ë - Ï§ëÎ≥µ Ìò∏Ï∂ú Î¨¥Ïãú');
                return;
            }
            
            const dateMemoModal = document.getElementById('dateMemoModal');
            if (!dateMemoModal) {
                console.log('‚ö†Ô∏è Î™®Îã¨ ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                return;
            }
            
            // displayÍ∞Ä noneÏù¥Í±∞ÎÇò Îπà Î¨∏ÏûêÏó¥Ïù¥Î©¥ Ïù¥ÎØ∏ Îã´ÌòÄÏûàÏùå
            if (dateMemoModal.style.display === 'none' || dateMemoModal.style.display === '') {
                console.log('‚ö†Ô∏è Î™®Îã¨Ïù¥ Ïù¥ÎØ∏ Îã´ÌòÄÏûàÏùå (display: ' + dateMemoModal.style.display + ')');
                return;
            }
            
            // Îã´Í∏∞ Ï§ë ÌîåÎûòÍ∑∏ ÏÑ§Ï†ï
            isDateMemoModalClosing = true;
            
            const modalContent = dateMemoModal.querySelector('.memo-modal-content');
            if (modalContent) {
                // Î™®Îã¨ ÏúÑÏπò Î¶¨ÏÖã
                modalContent.style.position = '';
                modalContent.style.left = '';
                modalContent.style.top = '';
                modalContent.style.margin = '';
                modalContent.classList.remove('dragging');
            }
            
            // Ï¶âÏãú Îã´Í∏∞ (Ïï†ÎãàÎ©îÏù¥ÏÖò Ï†úÍ±∞)
            dateMemoModal.style.transition = 'none';
            dateMemoModal.style.display = 'none';
            dateMemoModal.style.visibility = 'hidden'; // visibilityÎ•º Î™ÖÏãúÏ†ÅÏúºÎ°ú hidden ÏÑ§Ï†ï
            dateMemoModal.classList.remove('closing');
            dateMemoModal.classList.remove('opening'); // opening ÌÅ¥ÎûòÏä§ÎèÑ Ï†úÍ±∞
            
            // Î™®Îã¨ Ïª®ÌÖåÏù¥ÎÑàÎèÑ Î¶¨ÏÖã
            dateMemoModal.classList.remove('has-positioned-content');
            
            // Î™®Îì† Ïù∏ÎùºÏù∏ Ïä§ÌÉÄÏùº Ï†úÍ±∞ (displayÏôÄ visibility Ï†úÏô∏)
            dateMemoModal.style.position = '';
            dateMemoModal.style.top = '';
            dateMemoModal.style.left = '';
            dateMemoModal.style.width = '';
            dateMemoModal.style.height = '';
            dateMemoModal.style.backgroundColor = '';
            
            clearDateMemoForm();
            selectedDate = null;
            
            // Îã¨Î†•Ïóê ÌëúÏãúÎêú Î©îÎ™® Î¶¨Ïä§Ìä∏ Ïà®Í∏∞Í∏∞
            const dateMemoList = document.getElementById('dateMemoList');
            if (dateMemoList) {
                dateMemoList.innerHTML = '';
                dateMemoList.style.display = 'none';
                console.log('üìù Îã¨Î†• Î©îÎ™® Î¶¨Ïä§Ìä∏ ÏôÑÏ†Ñ Ïà®ÍπÄ');
            }
            
            // ÏÑ†ÌÉùÎêú ÎÇ†Ïßú ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†úÍ±∞
            const selectedDayElements = document.querySelectorAll('.day.selected');
            selectedDayElements.forEach(day => {
                day.classList.remove('selected');
                console.log('üìÖ ÎÇ†Ïßú ÏÑ†ÌÉù ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†úÍ±∞:', day.textContent);
            });
            
            // Î™®Îã¨ Îã´ÏùÑ Îïå Ïû†Í∏à ÏÉÅÌÉúÎ°ú Î¶¨ÏÖã
            resetDateMemoLock();
            
            // Îã¨Î†• ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏ (Î©îÎ™® Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ Ï†ïÎ¶¨)
            console.log('üöÄ closeDateMemoModalÏóêÏÑú updateCalendarDisplay Ìò∏Ï∂ú ÏãúÏûë');
            updateCalendarDisplay();
            console.log('‚úÖ closeDateMemoModalÏóêÏÑú updateCalendarDisplay Ìò∏Ï∂ú ÏôÑÎ£å');
            
            // Îã´Í∏∞ Ï§ë ÌîåÎûòÍ∑∏ Ìï¥Ï†ú
            isDateMemoModalClosing = false;
            
            // Îã´Ìûå ÌõÑ Î≥¥Ìò∏ Î™®Îìú ÌôúÏÑ±Ìôî (Ïû¨Ïó¥Î¶º Î∞©ÏßÄ)
            modalJustClosed = true;
            window.modalJustClosed = true; // Ï†ÑÏó≠ Î≥ÄÏàòÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            window.lastClosedModalDate = selectedDate; // Îã´Ìûå ÎÇ†Ïßú Í∏∞Î°ù
            
            // Ïù¥Ï†Ñ Î≥¥Ìò∏ ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨
            if (closeProtectionTimeout) {
                clearTimeout(closeProtectionTimeout);
            }
            
            console.log('üîí Î™®Îã¨ Îã´Ìûå ÌõÑ Ïû¨Ïó¥Î¶º Î≥¥Ìò∏ ÌôúÏÑ±Ìôî (0.8Ï¥à)');
            console.log('üìä Î™®Îã¨ ÏµúÏ¢Ö ÏÉÅÌÉú:', {
                display: dateMemoModal.style.display,
                visibility: dateMemoModal.style.visibility,
                classList: dateMemoModal.classList.toString()
            });
            
            closeProtectionTimeout = setTimeout(() => {
                modalJustClosed = false;
                window.modalJustClosed = false; // Ï†ÑÏó≠ Î≥ÄÏàòÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                console.log('‚úÖ Î™®Îã¨ Ïû¨Ïó¥Î¶º Î≥¥Ìò∏ Ìï¥Ï†ú');
            }, 300); // 0.3Ï¥àÎ°ú Îã®Ï∂ïÌïòÏó¨ Îçî Îπ†Î•∏ ÎÇ†Ïßú Î≥ÄÍ≤Ω ÌóàÏö©
            
            console.log('‚úÖ ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ Îã´Í∏∞ ÏôÑÎ£å - ÌîåÎûòÍ∑∏ Ìï¥Ï†ú');
        }

        function clearDateMemoForm() {
            document.getElementById('dateMemoTitleInput').value = '';
            document.getElementById('dateMemoContentInput').value = '';
        }

        async function saveDateMemo() {
            const startTime = Date.now();
            console.log('üíæ saveDateMemo Ìï®Ïàò ÏãúÏûë', {selectedDate});
            
            if (window.DiagnosticSystem) {
                window.DiagnosticSystem.trackInteraction('SAVE_DATE_MEMO', 'saveDateMemo', true, 0);
            }
            
            if (!selectedDate) {
                console.warn('‚ö†Ô∏è selectedDateÍ∞Ä ÏóÜÏñ¥ Î©îÎ™® Ï†ÄÏû• Ï§ëÎã®');
                
                if (window.DiagnosticSystem) {
                    window.DiagnosticSystem.detectIssue('SAVE_ERROR', 'selectedDate ÎàÑÎùΩ', {
                        severity: 'error'
                    });
                }
                return;
            }

            const title = document.getElementById('dateMemoTitleInput').value.trim();
            const content = document.getElementById('dateMemoContentInput').value.trim();
            
            console.log('üìù Ï†ÄÏû•Ìï† Î©îÎ™® Îç∞Ïù¥ÌÑ∞:', {title, content, selectedDate});

            if (!title) {
                alert('Î©îÎ™® Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                
                if (window.DiagnosticSystem) {
                    window.DiagnosticSystem.detectIssue('USER_INPUT', 'Îπà Ï†úÎ™©ÏúºÎ°ú Î©îÎ™® Ï†ÄÏû• ÏãúÎèÑ', {
                        severity: 'info'
                    });
                }
                return;
            }

            const memoId = Date.now();
            const memo = {
                id: memoId,
                title: title,
                content: content,
                date: selectedDate,
                timestamp: new Date().toISOString()
            };
            
            // Ï≤®Î∂ÄÌååÏùº Ï≤òÎ¶¨ - IndexedDBÏùò ÏûÑÏãú IDÎ•º Ïã§Ï†ú Î©îÎ™® IDÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
            if (dateMemoAttachments.length > 0) {
                // Ï≤®Î∂ÄÌååÏùº Î∞∞Ïó¥ Î≥µÏÇ¨ (Ï∞∏Ï°∞Í∞Ä ÏïÑÎãå ÍπäÏùÄ Î≥µÏÇ¨)
                memo.attachments = [];
                
                // IndexedDBÏóê Ï†ÄÏû•Îêú ÌååÏùºÎì§Ïùò memoId ÏóÖÎç∞Ïù¥Ìä∏
                for (let i = 0; i < dateMemoAttachments.length; i++) {
                    const attachment = dateMemoAttachments[i];
                    // Ï≤®Î∂ÄÌååÏùº Ï†ïÎ≥¥ Î≥µÏÇ¨
                    const attachmentCopy = {...attachment};
                    
                    if (attachment.useIndexedDB && attachment.indexedDbId) {
                        try {
                            // IndexedDBÏóêÏÑú ÌååÏùº Í∞ÄÏ†∏Ïò§Í∏∞
                            const dbAttachment = await getAttachmentFromDB(attachment.indexedDbId);
                            if (dbAttachment) {
                                // Í∏∞Ï°¥ ÏûÑÏãú IDÎ•º ÏÇ≠Ï†úÌïòÍ≥†
                                await deleteAttachmentFromDB(attachment.indexedDbId);
                                // Ïã§Ï†ú Î©îÎ™® IDÎ°ú Îã§Ïãú Ï†ÄÏû•
                                const updatedAttachment = await saveAttachmentToDB({
                                    name: dbAttachment.fileName,
                                    size: dbAttachment.fileSize,
                                    type: dbAttachment.fileType,
                                    data: dbAttachment.data
                                }, memoId);
                                
                                // Ïù¥Ï†Ñ ID Ï†ÄÏû•
                                const oldId = attachment.indexedDbId;
                                // Î≥µÏÇ¨Î≥∏Ïùò Ï≤®Î∂ÄÌååÏùº ID ÏóÖÎç∞Ïù¥Ìä∏
                                attachmentCopy.indexedDbId = updatedAttachment.id;
                                
                                console.log('‚úÖ Ï≤®Î∂ÄÌååÏùº ID ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å:', {
                                    Ïù¥Ï†ÑID: oldId,
                                    ÏÉàID: updatedAttachment.id,
                                    ÌååÏùºÎ™Ö: dbAttachment.fileName
                                });
                            }
                        } catch (error) {
                            console.error('Ï≤®Î∂ÄÌååÏùº ID ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:', error);
                        }
                    }
                    
                    // ÏóÖÎç∞Ïù¥Ìä∏Îêú Ï≤®Î∂ÄÌååÏùº Ï†ïÎ≥¥Î•º Î©îÎ™®Ïóê Ï∂îÍ∞Ä
                    memo.attachments.push(attachmentCopy);
                }
            }

            // localStorageÏóêÏÑú ÏµúÏã† Î©îÎ™® Î™©Î°ùÏùÑ Í∞ÄÏ†∏ÏôÄÏÑú ÏÉà Î©îÎ™® Ï∂îÍ∞Ä (Ï†ÑÏó≠ Î≥ÄÏàò ÏÇ¨Ïö© Ïïà Ìï®)
            const currentMemos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
            currentMemos.unshift(memo);
            
            const saveResult = safelyStoreData('calendarMemos', currentMemos);
            if (!saveResult.success) {
                alert('ÎÇ†Ïßú Î©îÎ™® Ï†ÄÏû• Ïã§Ìå®: ' + saveResult.message);
                return;
            }
            
            clearDateMemoForm();
            clearAttachments('dateMemoAttachmentList', dateMemoAttachments);
            
            // Ï≤®Î∂ÄÌååÏùº ID ÏóÖÎç∞Ïù¥Ìä∏ ÌõÑ UI Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ®
            console.log('üîÑ Î©îÎ™® Ï†ÄÏû• ÏôÑÎ£å - UI Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ® ÏãúÏûë');
            if (window.displayDateMemos) {
                window.displayDateMemos();
                console.log('‚úÖ displayDateMemos Ìò∏Ï∂ú ÏôÑÎ£å');
            }
            updateCalendarDisplay(); // Îã¨Î†• ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            
            // ÌÜµÌï© ÏãúÏä§ÌÖú UI ÏÉàÎ°úÍ≥†Ïπ® (Ï≤®Î∂ÄÌååÏùº ID Î∞òÏòÅÏùÑ ÏúÑÌï¥)
            if (typeof window.MemoSystem !== 'undefined' && window.MemoSystem.refreshAllUI) {
                window.MemoSystem.refreshAllUI();
                console.log('‚úÖ ÌÜµÌï© ÏãúÏä§ÌÖú UI ÏÉàÎ°úÍ≥†Ïπ® ÏôÑÎ£å');
            }
            
            // alert(`üìù ${selectedDate} Î©îÎ™®Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!`); // Î©îÏãúÏßÄ Ï†úÍ±∞
        }

        // ÌÜµÌï© Î©îÎ™® ÏãúÏä§ÌÖúÏúºÎ°ú ÎåÄÏ≤¥Îê® - Ï∂©Îèå Î∞©ÏßÄÎ•º ÏúÑÌï¥ ÎπÑÌôúÏÑ±Ìôî
        /*
        function loadDateMemos() {
            if (!selectedDate) return;

            const dateMemoList = document.getElementById('dateMemoList');
            // localStorageÏóêÏÑú ÏµúÏã† Î©îÎ™®Î•º Í∞ÄÏ†∏ÏôÄÏÑú ÌïÑÌÑ∞ÎßÅ
            const currentMemos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
            const dateMemos = currentMemos.filter(memo => memo.date === selectedDate);
            
            if (dateMemos.length === 0) {
                dateMemoList.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">Ïù¥ ÎÇ†ÏßúÏóê Ï†ÄÏû•Îêú Î©îÎ™®Í∞Ä ÏóÜÏäµÎãàÎã§</div>';
                return;
            }

            dateMemoList.innerHTML = dateMemos.map(memo => `
                <div class="memo-item ${isDateMemosUnlocked ? 'unlocked' : ''}" onclick="openMemoDetail(${memo.id})">
                    <div class="memo-item-title">${memo.title}</div>
                    <div class="memo-item-content">${memo.content.substring(0, 100)}${memo.content.length > 100 ? '...' : ''}</div>
                    <div class="memo-item-date">${memo.date}</div>
                    <div class="memo-item-preview">ÌÅ¥Î¶≠ÌïòÏó¨ Î≥¥Í∏∞</div>
                    <button class="memo-item-delete ${isDateMemosUnlocked ? 'visible' : ''}" onclick="event.stopPropagation(); deleteMemoFromList(${memo.id})">‚úï</button>
                </div>
            `).join('');
        }
        */

        // Í∏∞Ï°¥ viewDateMemo Ìï®ÏàòÎäî openMemoDetailÎ°ú ÎåÄÏ≤¥Îê®
        function viewDateMemo(id) {
            openMemoDetail(id);
        }

        function deleteDateMemo(id) {
            deleteMemo(id); // ÌÜµÌï©Îêú ÏÇ≠Ï†ú Ìï®Ïàò ÏÇ¨Ïö©
            updateCalendarDisplay();
        }

        // ÎîîÎ≤ÑÍπÖÏö© Í∞ïÏ†ú Îã¨Î†• ÏÉàÎ°úÍ≥†Ïπ® Ìï®Ïàò
        window.forceRefreshCalendar = function() {
            console.log('üî® Í∞ïÏ†ú Îã¨Î†• ÏÉàÎ°úÍ≥†Ïπ® ÏãúÏûë');
            const grid = document.getElementById('daysGrid');
            if (grid) {
                grid.innerHTML = '';
                console.log('üóëÔ∏è Îã¨Î†• DOM Í∞ïÏ†ú Ï†úÍ±∞');
            }
            
            setTimeout(() => {
                createCalendar();
                console.log('‚úÖ Í∞ïÏ†ú Îã¨Î†• ÏÉàÎ°úÍ≥†Ïπ® ÏôÑÎ£å');
            }, 100);
        };

        // Îã¨Î†• ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏ (Î©îÎ™®Í∞Ä ÏûàÎäî ÎÇ†Ïßú ÌëúÏãú)
        function updateCalendarDisplay() {
            console.log('üîÑ Îã¨Î†• ÌëúÏãú Í∞ïÏ†ú ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë');
            console.log('üìç updateCalendarDisplay Ìò∏Ï∂ú ÏúÑÏπò:', new Error().stack.split('\n')[1]?.trim());
            
            // DOM ÏöîÏÜå Í∞ïÏ†ú Ï¥àÍ∏∞Ìôî
            const grid = document.getElementById('daysGrid');
            if (grid) {
                grid.innerHTML = ''; // Í∏∞Ï°¥ Îã¨Î†• ÏôÑÏ†Ñ Ï†úÍ±∞
                console.log('üóëÔ∏è Í∏∞Ï°¥ Îã¨Î†• DOM ÏôÑÏ†Ñ Ï†úÍ±∞');
            }
            
            // localStorage Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ® (Î∏åÎùºÏö∞Ï†Ä Ï∫êÏãú Î∞©ÏßÄ)
            const currentTime = Date.now();
            const tempKey = 'calendarMemos_refresh_' + currentTime;
            const memos = localStorage.getItem('calendarMemos');
            localStorage.setItem(tempKey, memos || '[]');
            localStorage.removeItem(tempKey);
            
            // Îçî Í∏¥ ÏßÄÏó∞ÏùÑ ÎëêÏñ¥ Î™®Îì† Ï≤òÎ¶¨Í∞Ä ÏôÑÎ£åÎêòÎèÑÎ°ù Ìï®
            setTimeout(() => {
                console.log('üîÑ Îã¨Î†• Îã§Ïãú ÏÉùÏÑ± ÏãúÏûë');
                createCalendar(); // Îã¨Î†•ÏùÑ ÏôÑÏ†ÑÌûà Îã§Ïãú Í∑∏Î¶¨Í∏∞
                console.log('üìÖ Îã¨Î†• ÌëúÏãú Í∞ïÏ†ú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
                
                // Ï∂îÍ∞Ä Í≤ÄÏ¶ù: Î©îÎ™® Îç∞Ïù¥ÌÑ∞ ÏÉÅÌÉú Î°úÍ∑∏
                const finalMemos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
                console.log('üìä ÏµúÏ¢Ö Î©îÎ™® Îç∞Ïù¥ÌÑ∞:', finalMemos.length + 'Í∞ú');
                finalMemos.forEach(memo => {
                    console.log(`  - ${memo.date}: ${memo.title}`);
                });
            }, 100); // 100msÎ°ú ÏßÄÏó∞ ÏãúÍ∞Ñ Ï¶ùÍ∞Ä
        }

        // Í∏∞Î≥∏ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        function initButtons() {
            console.log('Î≤ÑÌäº Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
            

            // ÏÉùÏÑ± Î™®Îìú
            const createBtn = document.getElementById('createBtn');
            if (createBtn) {
                createBtn.addEventListener('click', function() {
                    console.log('ÏÉùÏÑ± Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
                    openModal('createModal');
                });
                console.log('ÏÉùÏÑ± Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            } else {
                console.error('ÏÉùÏÑ± Î≤ÑÌäºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }

            // Î©îÎ™®Ïû•
            const memoBtn = document.getElementById('memoBtn');
            if (memoBtn) {
                memoBtn.addEventListener('click', function() {
                    console.log('üî• Ïä§Ìã∞Ïª§ Î©îÎ™® Î≤ÑÌäº ÌÅ¥Î¶≠Îê®! openStickyMemo() Ìò∏Ï∂ú ÏãúÏûë');
                    try {
                        openStickyMemo();
                        console.log('‚úÖ openStickyMemo() Ìò∏Ï∂ú ÏôÑÎ£å');
                        
                        // 5Ï¥à ÌõÑ Ïä§Ìã∞Ïª§ Î©îÎ™® ÏÉÅÌÉú Ïû¨ÌôïÏù∏
                        setTimeout(() => {
                            // ÌÜµÌï© ÏãúÏä§ÌÖúÏóêÏÑú ÏÉùÏÑ±Îêú Ïä§Ìã∞Ïª§ Î©îÎ™® ÌôïÏù∏
                            const sticky = document.getElementById('stickyMemo') || window._currentStickyMemo;
                            if (sticky && sticky.parentNode) {
                                console.log('‚úÖ 5Ï¥à ÌõÑ Ïä§Ìã∞Ïª§ Î©îÎ™® Ï†ïÏÉÅ ÌôïÏù∏:', {
                                    display: sticky.style.display,
                                    visibility: sticky.style.visibility,
                                    opacity: sticky.style.opacity,
                                    zIndex: sticky.style.zIndex,
                                    parentNode: sticky.parentNode ? sticky.parentNode.tagName : 'null'
                                });
                            } else if (sticky) {
                                console.log('‚ö†Ô∏è Ïä§Ìã∞Ïª§ Î©îÎ™®Í∞Ä Ï°¥Ïû¨ÌïòÏßÄÎßå DOMÏóêÏÑú Î∂ÑÎ¶¨Îê®');
                            } else {
                                console.log('‚ÑπÔ∏è Ïä§Ìã∞Ïª§ Î©îÎ™®Í∞Ä ÏïÑÏßÅ ÏÉùÏÑ±ÎêòÏßÄ ÏïäÏïòÍ±∞ÎÇò Îã§Î•∏ Î∞©ÏãùÏúºÎ°ú Í¥ÄÎ¶¨ÎêòÍ≥† ÏûàÏäµÎãàÎã§');
                            }
                        }, 5000);
                    } catch (error) {
                        console.error('‚ùå openStickyMemo() Ïã§Ìñâ Ï§ë Ïò§Î•ò:', error);
                    }
                });
                console.log('Î©îÎ™®Ïû• Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            } else {
                console.error('Î©îÎ™®Ïû• Î≤ÑÌäºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }

            // ÏóëÏÖÄ
            const excelBtn = document.getElementById('excelBtn');
            if (excelBtn) {
                excelBtn.addEventListener('click', function() {
                    console.log('ÏóëÏÖÄ Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
                    
                    // excelModalÏù¥ Ï°¥Ïû¨ÌïòÎäîÏßÄ ÌôïÏù∏
                    const excelModal = document.getElementById('excelModal');
                    console.log('excelModal Ï∞æÍ∏∞ Í≤∞Í≥º:', excelModal);
                    
                    if (excelModal) {
                        excelModal.style.display = 'block';
                        console.log('ÏóëÏÖÄ Î™®Îã¨Ïù¥ Ïó¥Î†∏ÏäµÎãàÎã§');
                    } else {
                        console.error('excelModalÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                        alert('ÏóëÏÖÄ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Í∏∞Îä•Ïù¥ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§.');
                    }
                });
                console.log('ÏóëÏÖÄ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            } else {
                console.error('ÏóëÏÖÄ Î≤ÑÌäºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }

            // ÌÜµÌï© ÌÅ¥ÎùºÏö∞Îìú ÏÑ§Ï†ï Î≤ÑÌäº (Íµ¨Í∏Ä ÎìúÎùºÏù¥Î∏å + ÏûêÎèô ÎèôÍ∏∞Ìôî ÌÜµÌï©)
            const unifiedCloudBtn = document.getElementById('unifiedCloudBtn');
            if (unifiedCloudBtn) {
                unifiedCloudBtn.addEventListener('click', function() {
                    console.log('ÌÜµÌï© ÌÅ¥ÎùºÏö∞Îìú ÏÑ§Ï†ï Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
                    if (typeof window.showUnifiedCloudModal === 'function') {
                        window.showUnifiedCloudModal();
                    } else {
                        console.error('showUnifiedCloudModal Ìï®ÏàòÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                        alert('ÌÅ¥ÎùºÏö∞Îìú ÏÑ§Ï†ï Í∏∞Îä•ÏùÑ Î°úÎìúÌïòÎäî Ï§ëÏûÖÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                    }
                });
                console.log('ÌÜµÌï© ÌÅ¥ÎùºÏö∞Îìú ÏÑ§Ï†ï Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            } else {
                console.error('ÌÜµÌï© ÌÅ¥ÎùºÏö∞Îìú ÏÑ§Ï†ï Î≤ÑÌäºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }

            // ÎèôÍ∏∞Ìôî ÏÉÅÌÉúÏ∞Ω Î≤ÑÌäº
            const syncStatusBtn = document.getElementById('syncStatusBtn');
            if (syncStatusBtn) {
                syncStatusBtn.addEventListener('click', function() {
                    console.log('ÎèôÍ∏∞Ìôî ÏÉÅÌÉú Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
                    if (typeof window.showSyncStatusWindow === 'function') {
                        window.showSyncStatusWindow();
                    } else {
                        console.error('showSyncStatusWindow Ìï®ÏàòÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. sync-status-window.jsÍ∞Ä Î°úÎìúÎêòÏóàÎäîÏßÄ ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
                        alert('ÎèôÍ∏∞Ìôî ÏÉÅÌÉúÏ∞Ω Í∏∞Îä•Ïù¥ Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.');
                    }
                });
                console.log('ÎèôÍ∏∞Ìôî ÏÉÅÌÉú Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            } else {
                console.error('ÎèôÍ∏∞Ìôî ÏÉÅÌÉú Î≤ÑÌäºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }

            // ÏÑ§Ï†ï
            const settingsBtn = document.getElementById('settingsBtn');
            if (settingsBtn) {
                settingsBtn.addEventListener('click', function() {
                    console.log('ÏÑ§Ï†ï Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
                    
                    // DOM ÏôÑÏ†Ñ Î°úÎìú ÌõÑ Îã§Ïãú ÏãúÎèÑ
                    setTimeout(() => {
                        console.log('DOM readyState:', document.readyState);
                        console.log('Ï†ÑÏ≤¥ Î™®Îã¨ ID Î™©Î°ù:', Array.from(document.querySelectorAll('.modal')).map(modal => modal.id));
                        
                        const settingsModal = document.getElementById('settingsModal');
                        const settingsModalQuery = document.querySelector('#settingsModal');
                        const settingsModalClass = document.querySelector('.modal#settingsModal');
                        
                        console.log('getElementById Í≤∞Í≥º:', settingsModal);
                        console.log('querySelector Í≤∞Í≥º:', settingsModalQuery);
                        console.log('class+id selector Í≤∞Í≥º:', settingsModalClass);
                        
                        const modalToUse = settingsModal || settingsModalQuery || settingsModalClass;
                        
                        if (modalToUse) {
                            try {
                                modalToUse.style.display = 'block';
                                console.log('ÏÑ§Ï†ï Î™®Îã¨Ïù¥ Ïó¥Î†∏ÏäµÎãàÎã§:', modalToUse.id);
                                
                                // loadCurrentSettingsToModal Ìï®ÏàòÍ∞Ä Ï°¥Ïû¨ÌïòÎäîÏßÄ ÌôïÏù∏
                                if (typeof loadCurrentSettingsToModal === 'function') {
                                    loadCurrentSettingsToModal();
                                } else {
                                    console.warn('loadCurrentSettingsToModal Ìï®ÏàòÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                                }
                            } catch (error) {
                                console.error('ÏÑ§Ï†ï Î™®Îã¨ Ïó¥Í∏∞ Ï§ë Ïò§Î•ò:', error);
                            }
                        } else {
                            console.error('settingsModalÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§ - Î™®Îì† Î∞©Î≤ï Ïã§Ìå®');
                            console.log('Î™®Îã¨ Ïû¨ÏÉùÏÑ±ÏùÑ ÏãúÎèÑÌï©ÎãàÎã§...');
                            
                            // ÏÑ§Ï†ï Î™®Îã¨ÏùÑ ÎèôÏ†ÅÏúºÎ°ú Ïû¨ÏÉùÏÑ±
                            const recreatedModal = recreateSettingsModal();
                            if (recreatedModal) {
                                recreatedModal.style.display = 'block';
                                console.log('ÏÑ§Ï†ï Î™®Îã¨Ïù¥ Ïû¨ÏÉùÏÑ±ÎêòÍ≥† Ïó¥Î†∏ÏäµÎãàÎã§');
                                
                                if (typeof loadCurrentSettingsToModal === 'function') {
                                    loadCurrentSettingsToModal();
                                }
                            } else {
                                alert('ÏÑ§Ï†ï Î™®Îã¨ÏùÑ Ïó¥ Ïàò ÏóÜÏäµÎãàÎã§. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.');
                            }
                        }
                    }, 100);
                });
                console.log('ÏÑ§Ï†ï Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            } else {
                console.error('ÏÑ§Ï†ï Î≤ÑÌäºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }
            
            // Ï†ÄÏû•ÏÜå Î≤ÑÌäº
            const storageBtn = document.getElementById('storageBtn');
            if (storageBtn) {
                storageBtn.addEventListener('click', function() {
                    const currentSize = getStorageSize();
                    const totalCapacity = testStorageCapacity();
                    const availableSpace = totalCapacity - currentSize;
                    const usagePercent = Math.round((currentSize / totalCapacity) * 100);
                    
                    const choice = confirm(`üìä Ï†ÄÏû•ÏÜå ÏÉÅÌÉú\n\nÏÇ¨Ïö©Ï§ë: ${formatFileSize(currentSize)} (${usagePercent}%)\nÏ†ÑÏ≤¥ Ïö©Îüâ: ${formatFileSize(totalCapacity)}\nÎÇ®ÏùÄ Í≥µÍ∞Ñ: ${formatFileSize(availableSpace)}\n\nÏ†ïÎ¶¨ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÌôïÏù∏: ÏûêÎèô Ï†ïÎ¶¨ (500KB Ïù¥ÏÉÅ ÌååÏùº)\nÏ∑®ÏÜå: ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î≥¥Í∏∞`);
                    
                    if (choice) {
                        cleanupStorage();
                    } else {
                        showStorageStatus();
                    }
                });
                console.log('Ï†ÄÏû•ÏÜå Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            } else {
                console.warn('Ï†ÄÏû•ÏÜå Î≤ÑÌäºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }

            // ÏÑ§Ï†ï Î™®Îã¨ Ïã§ÏãúÍ∞Ñ ÎØ∏Î¶¨Î≥¥Í∏∞ Ïù¥Î≤§Ìä∏
            initSettingsModalEvents();

            // Î©îÎ™®Ïû• Î™®Îã¨ Ïù¥Î≤§Ìä∏
            const closeMemoBtn = document.getElementById('closeMemo');
            if (closeMemoBtn) {
                closeMemoBtn.addEventListener('click', closeMemoModal);
                console.log('Î©îÎ™® Îã´Í∏∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            }

            const saveMemoBtn = document.getElementById('saveMemo');
            if (saveMemoBtn) {
                saveMemoBtn.addEventListener('click', saveMemo);
                console.log('Î©îÎ™® Ï†ÄÏû• Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            }

            // Î©îÎ™® ÏÉÅÏÑ∏Î≥¥Í∏∞ Î™®Îã¨ X Î≤ÑÌäº Ïù¥Î≤§Ìä∏ - Í∞ïÌôîÎêú Î≤ÑÏ†Ñ
            const closeMemoDetailBtn = document.getElementById('closeMemoDetail');
            if (closeMemoDetailBtn) {
                // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞
                const newBtn = closeMemoDetailBtn.cloneNode(true);
                closeMemoDetailBtn.parentNode.replaceChild(newBtn, closeMemoDetailBtn);
                
                // ÏÉà Î≤ÑÌäºÏóê Ïù¥Î≤§Ìä∏ Îì±Î°ù
                const finalBtn = document.getElementById('closeMemoDetail');
                
                // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ ÏßÅÏ†ë Îì±Î°ù (Í∞ÄÏû• ÎÜíÏùÄ Ïö∞ÏÑ†ÏàúÏúÑ)
                finalBtn.addEventListener('click', function(e) {
                    console.log('üî¥ Î©îÎ™® ÏÉÅÏÑ∏ X Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    closeMemoDetail();
                }, true); // capture phaseÏóêÏÑú Ï≤òÎ¶¨
                
                // mousedown Ïù¥Î≤§Ìä∏ÎèÑ Ï≤òÎ¶¨ (ÎìúÎûòÍ∑∏ Î∞©ÏßÄ)
                finalBtn.addEventListener('mousedown', function(e) {
                    console.log('üõë Î©îÎ™® ÏÉÅÏÑ∏ X Î≤ÑÌäº mousedown - ÎìúÎûòÍ∑∏ Ï∞®Îã®');
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                }, true);
                
                console.log('‚úÖ Î©îÎ™® ÏÉÅÏÑ∏ Îã´Í∏∞ Î≤ÑÌäº Í∞ïÌôîÎêú Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            } else {
                console.error('‚ùå Î©îÎ™® ÏÉÅÏÑ∏ X Î≤ÑÌäºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }

            const editMemoBtn = document.getElementById('editMemoBtn');
            if (editMemoBtn) {
                editMemoBtn.addEventListener('click', editMemo);
                console.log('Î©îÎ™® Ìé∏Ïßë Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            }

            const deleteMemoBtn = document.getElementById('deleteMemoBtn');
            if (deleteMemoBtn) {
                deleteMemoBtn.addEventListener('click', deleteMemoFromDetail);
                console.log('Î©îÎ™® ÏÇ≠Ï†ú Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            }

            // Ïû†Í∏à/Ìï¥Ï†ú ÌÜ†Í∏Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            const memoLockToggle = document.getElementById('memoLockToggle');
            if (memoLockToggle) {
                // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Ï†úÍ±∞ ÌõÑ ÏÉàÎ°ú Îì±Î°ù
                memoLockToggle.removeEventListener('click', toggleMemoLock);
                
                // debouncingÏùÑ ÏúÑÌïú ÎßàÏßÄÎßâ ÌÅ¥Î¶≠ ÏãúÍ∞Ñ
                let lastMemoToggleTime = 0;
                
                memoLockToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // ÎÑàÎ¨¥ Îπ†Î•∏ Ï§ëÎ≥µ ÌÅ¥Î¶≠ Î∞©ÏßÄ (300ms)
                    const now = Date.now();
                    if (now - lastMemoToggleTime < 300) {
                        console.log('‚ö†Ô∏è Î©§Î™® Ïû†Í∏à Î≤ÑÌäº Ï§ëÎ≥µ ÌÅ¥Î¶≠ Î∞©ÏßÄ');
                        return;
                    }
                    lastMemoToggleTime = now;
                    
                    try {
                        toggleMemoLock();
                    } catch (error) {
                        console.error('‚ö†Ô∏è toggleMemoLock Ïò§Î•ò:', error);
                    }
                });
                
                console.log('Î©§Î™® Ïû†Í∏à ÌÜ†Í∏Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å (Í∞ïÌôîÎê®)');
            }

            const dateMemoLockToggle = document.getElementById('dateMemoLockToggle');
            if (dateMemoLockToggle) {
                // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Ï†úÍ±∞ ÌõÑ ÏÉàÎ°ú Îì±Î°ù
                dateMemoLockToggle.removeEventListener('click', toggleDateMemoLock);
                
                // debouncingÏùÑ ÏúÑÌïú ÎßàÏßÄÎßâ ÌÅ¥Î¶≠ ÏãúÍ∞Ñ
                let lastToggleTime = 0;
                
                dateMemoLockToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // ÎÑàÎ¨¥ Îπ†Î•∏ Ï§ëÎ≥µ ÌÅ¥Î¶≠ Î∞©ÏßÄ (300ms)
                    const now = Date.now();
                    if (now - lastToggleTime < 300) {
                        console.log('‚ö†Ô∏è Ïû†Í∏à Î≤ÑÌäº Ï§ëÎ≥µ ÌÅ¥Î¶≠ Î∞©ÏßÄ');
                        return;
                    }
                    lastToggleTime = now;
                    
                    try {
                        toggleDateMemoLock();
                    } catch (error) {
                        console.error('‚ö†Ô∏è toggleDateMemoLock Ïò§Î•ò:', error);
                    }
                });
                
                console.log('ÎÇ†Ïßú Î©îÎ™® Ïû†Í∏à ÌÜ†Í∏Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å (Í∞ïÌôîÎê®)');
            }

            // ÏïåÎûå Ï≤¥ÌÅ¨Î∞ïÏä§ Ïù¥Î≤§Ìä∏
            const enableAlarmCheckbox = document.getElementById('enableAlarm');
            if (enableAlarmCheckbox) {
                enableAlarmCheckbox.addEventListener('change', function() {
                    const alarmSettings = document.getElementById('alarmSettings');
                    if (this.checked) {
                        alarmSettings.style.display = 'block';
                    } else {
                        alarmSettings.style.display = 'none';
                    }
                });
                console.log('ÏïåÎûå Ï≤¥ÌÅ¨Î∞ïÏä§ Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            }

            // ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® Î™®Îã¨ X Î≤ÑÌäº Ïù¥Î≤§Ìä∏ - Ï¶âÏãú Îì±Î°ù
            const closeDateMemoBtn = document.getElementById('closeDateMemo');
            if (closeDateMemoBtn) {
                // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞
                const newBtn = closeDateMemoBtn.cloneNode(true);
                closeDateMemoBtn.parentNode.replaceChild(newBtn, closeDateMemoBtn);
                
                // ÏÉà Î≤ÑÌäºÏóê Ïù¥Î≤§Ìä∏ Îì±Î°ù
                const finalBtn = document.getElementById('closeDateMemo');
                
                // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ ÏßÅÏ†ë Îì±Î°ù (Í∞ÄÏû• ÎÜíÏùÄ Ïö∞ÏÑ†ÏàúÏúÑ)
                finalBtn.addEventListener('click', function(e) {
                    console.log('üéØ X Î≤ÑÌäº ÌÅ¥Î¶≠Îê® - ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ Îã´Í∏∞');
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    closeDateMemoModal();
                }, true); // capture phaseÏóêÏÑú Ï≤òÎ¶¨
                
                // mousedown Ïù¥Î≤§Ìä∏ÎèÑ Ï≤òÎ¶¨ (ÎìúÎûòÍ∑∏ Î∞©ÏßÄ)
                finalBtn.addEventListener('mousedown', function(e) {
                    console.log('üõë X Î≤ÑÌäº mousedown - ÎìúÎûòÍ∑∏ Ï∞®Îã®');
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                }, true);
                
                console.log('‚úÖ ÎÇ†Ïßú Î©îÎ™® X Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Ï¶âÏãú Îì±Î°ù ÏôÑÎ£å');
            } else {
                console.error('‚ùå ÎÇ†Ïßú Î©îÎ™® X Î≤ÑÌäºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
            }

            const saveDateMemoBtn = document.getElementById('saveDateMemo');
            if (saveDateMemoBtn) {
                saveDateMemoBtn.addEventListener('click', saveDateMemo);
                console.log('ÎÇ†Ïßú Î©îÎ™® Ï†ÄÏû• Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            }

            // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
            const memoModal = document.getElementById('memoModal');
            if (memoModal) {
                memoModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeMemoModal();
                    }
                });
                console.log('Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            }

            // Î©îÎ™® ÏÉÅÏÑ∏Î≥¥Í∏∞ Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
            const memoDetailModal = document.getElementById('memoDetailModal');
            if (memoDetailModal) {
                memoDetailModal.addEventListener('click', function(e) {
                    console.log('üîµ Î©îÎ™® ÏÉÅÏÑ∏ Î™®Îã¨ ÌÅ¥Î¶≠Îê®, target:', e.target, 'this:', this, 'Í∞ôÏùå:', e.target === this);
                    if (e.target === this) {
                        console.log('üîµ Ïô∏Î∂Ä ÌÅ¥Î¶≠ÏúºÎ°ú Î©îÎ™® ÏÉÅÏÑ∏ Î™®Îã¨ Îã´Í∏∞');
                        closeMemoDetail();
                    }
                });
                console.log('Î©îÎ™® ÏÉÅÏÑ∏ Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            }

            // ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞ (Í∞ÑÏÜåÌôî Î≤ÑÏ†Ñ)
            const dateMemoModal = document.getElementById('dateMemoModal');
            if (dateMemoModal) {
                dateMemoModal.addEventListener('click', function(e) {
                    // Î™®Îã¨ Î∞∞Í≤Ω(Ïô∏Î∂Ä)ÏùÑ ÏßÅÏ†ë ÌÅ¥Î¶≠ÌñàÏùÑ ÎïåÎßå Îã´Í∏∞
                    if (e.target === dateMemoModal) {
                        console.log('üìù Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ÏúºÎ°ú Îã´Í∏∞');
                        closeDateMemoModal();
                    }
                });
                
                console.log('ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            }

            // Enter ÌÇ§Î°ú Î©îÎ™® Ï†ÄÏû•
            const memoTitleInput = document.getElementById('memoTitleInput');
            if (memoTitleInput) {
                memoTitleInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const memoContentInput = document.getElementById('memoContentInput');
                        if (memoContentInput) {
                            memoContentInput.focus();
                        }
                    }
                });
                console.log('Enter ÌÇ§ Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            }

            // ÎÇ†ÏßúÎ≥Ñ Î©îÎ™® Enter ÌÇ§ Ïù¥Î≤§Ìä∏
            const dateMemoTitleInput = document.getElementById('dateMemoTitleInput');
            if (dateMemoTitleInput) {
                dateMemoTitleInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const dateMemoContentInput = document.getElementById('dateMemoContentInput');
                        if (dateMemoContentInput) {
                            dateMemoContentInput.focus();
                        }
                    }
                });
                console.log('ÎÇ†Ïßú Î©îÎ™® Enter ÌÇ§ Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            }

            // ESC ÌÇ§Î°ú Î™®Îã¨ Îã´Í∏∞
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    console.log('üîë ESC ÌÇ§ ÎàåÎ¶º');
                    
                    // Î©îÎ™® ÏÉÅÏÑ∏ Î™®Îã¨Ïù¥ Ïó¥Î†§ÏûàÏúºÎ©¥ Îã´Í∏∞
                    const memoDetailModal = document.getElementById('memoDetailModal');
                    if (memoDetailModal && memoDetailModal.style.display === 'block') {
                        console.log('üîë ESCÎ°ú Î©îÎ™® ÏÉÅÏÑ∏ Î™®Îã¨ Îã´Í∏∞');
                        closeMemoDetail();
                        return;
                    }
                    
                    // ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨Ïù¥ Ïó¥Î†§ÏûàÏúºÎ©¥ Îã´Í∏∞
                    const dateMemoModal = document.getElementById('dateMemoModal');
                    if (dateMemoModal && dateMemoModal.style.display === 'block') {
                        console.log('üîë ESCÎ°ú ÎÇ†Ïßú Î©îÎ™® Î™®Îã¨ Îã´Í∏∞');
                        closeDateMemoModal();
                        return;
                    }
                }
            });

            // Î™®Îì† Î™®Îã¨Ïóê Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞ Í∏∞Îä• Ï∂îÍ∞Ä
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });

            // Î©îÎ™® Î™®Îã¨ ÎìúÎûòÍ∑∏ Í∏∞Îä• Ï¥àÍ∏∞Ìôî
            initMemoModalDrag();
            console.log('Î©îÎ™® Î™®Îã¨ ÎìúÎûòÍ∑∏ Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');
            
            // Ï†ÑÏó≠ ÌÅ¥Î¶≠ Ï∞®Îã® Ï†úÍ±∞ - ÎÑàÎ¨¥ Í∞ïÎ†•Ìïú Ï∞®Îã®ÏúºÎ°ú Ïù∏Ìïú Î¨∏Ï†ú Ìï¥Í≤∞

            // Ï≤®Î∂ÄÌååÏùº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
            initAttachmentEvents();
            console.log('Ï≤®Î∂ÄÌååÏùº Ïù¥Î≤§Ìä∏ Îì±Î°ù ÏôÑÎ£å');

            console.log('Î™®Îì† Î≤ÑÌäº Ï¥àÍ∏∞Ìôî ÏôÑÎ£å!');
        }

        // DOM Î≥ÄÌôî Í∞êÏßÄÍ∏∞ ÏÑ§Ï†ï (Î™®Îã¨ Ï†úÍ±∞ Ï∂îÏ†Å)
        function setupModalWatcher() {
            const modals = document.querySelectorAll('.modal');
            console.log('üîç Ï¥àÍ∏∞ Î™®Îã¨ Í∞úÏàò:', modals.length, 'Î™®Îã¨ IDÎì§:', Array.from(modals).map(m => m.id));
            
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        mutation.removedNodes.forEach(function(node) {
                            if (node.nodeType === Node.ELEMENT_NODE && 
                                (node.classList && node.classList.contains('modal') || (node.id && node.id.includes('Modal')))) {
                                console.error('üö® Î™®Îã¨Ïù¥ Ï†úÍ±∞ÎêòÏóàÏäµÎãàÎã§:', node.id || node.className, 'by:', mutation.target);
                                console.trace('Î™®Îã¨ Ï†úÍ±∞ Ïä§ÌÉù Ï∂îÏ†Å');
                            }
                        });
                    }
                });
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
            
            console.log('üìä Î™®Îã¨ Í∞êÏßÄÍ∏∞ ÏÑ§Ï†ï ÏôÑÎ£å');
        }

        // ÏÑ§Ï†ï Î™®Îã¨ Ïû¨ÏÉùÏÑ± Ìï®Ïàò
        function recreateSettingsModal() {
            try {
                // Í∏∞Ï°¥ Î™®Îã¨Ïù¥ ÏûàÏúºÎ©¥ Ï†úÍ±∞
                const existingModal = document.getElementById('settingsModal');
                if (existingModal) {
                    existingModal.remove();
                }
                
                // ÏÉà Î™®Îã¨ ÏÉùÏÑ±
                const modalHTML = `
                <div class="modal" id="settingsModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title">‚öôÔ∏è ÏÑ§Ï†ï</h2>
                            <button class="modal-close" onclick="cancelSettings()">‚úï</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">ÌÖåÎßà</label>
                                <select class="form-select" id="themeSelect">
                                    <option value="light">‚òÄÔ∏è ÎùºÏù¥Ìä∏ Î™®Îìú</option>
                                    <option value="dark">üåô Îã§ÌÅ¨ Î™®Îìú</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Í∏ÄÍº¥ ÌÅ¨Í∏∞: <span id="fontDisplay">100%</span></label>
                                <input type="range" class="form-range" id="fontSlider" min="0.8" max="1.5" step="0.1" value="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Îã¨Î†• Í∞ÄÎ°ú ÌÅ¨Í∏∞: <span id="widthDisplay">100%</span></label>
                                <input type="range" class="form-range" id="widthSlider" min="0.8" max="2.0" step="0.1" value="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Îã¨Î†• ÏÑ∏Î°ú ÌÅ¨Í∏∞: <span id="heightDisplay">100%</span></label>
                                <input type="range" class="form-range" id="heightSlider" min="0.8" max="2.0" step="0.1" value="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ï£º ÏãúÏûëÏùº</label>
                                <select class="form-select">
                                    <option value="ÏùºÏöîÏùº">ÏùºÏöîÏùº</option>
                                    <option value="ÏõîÏöîÏùº">ÏõîÏöîÏùº</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-primary" onclick="saveSettings()">Ï†ÄÏû•</button>
                            <button class="btn-secondary" onclick="cancelSettings()">Ï∑®ÏÜå</button>
                        </div>
                    </div>
                </div>`;
                
                // DOMÏóê Ï∂îÍ∞Ä
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                
                const newModal = document.getElementById('settingsModal');
                console.log('‚úÖ ÏÑ§Ï†ï Î™®Îã¨Ïù¥ Ïû¨ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§:', newModal);
                
                return newModal;
                
            } catch (error) {
                console.error('ÏÑ§Ï†ï Î™®Îã¨ Ïû¨ÏÉùÏÑ± Ïã§Ìå®:', error);
                return null;
            }
        }

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Î°úÎî© ÏôÑÎ£å - Ï¥àÍ∏∞Ìôî ÏãúÏûë');
            
            // Î™®Îì† Î©îÎ™® Î™®Îã¨ Í∞ïÏ†ú Îã´Í∏∞ (DOM Î°úÎìú ÌõÑ Ï¶âÏãú)
            const memoModals = ['dateMemoModal', 'memoDetailModal'];
            memoModals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                    modal.style.visibility = 'hidden';
                    modal.classList.remove('has-positioned-content');
                }
            });
            console.log('üîí DOM Ï¥àÍ∏∞Ìôî Ïãú Î©îÎ™® Î™®Îã¨ Îã´Í∏∞ ÏôÑÎ£å');
            
            setupModalWatcher();
            
            try {
                // ÏÑ§Ï†ï Î°úÎìú
                loadSettings();
                console.log('ÏÑ§Ï†ï Î°úÎìú ÏôÑÎ£å');
                
                // ÎÇ†Ïßú ÏÑ†ÌÉùÍ∏∞ Ï¥àÍ∏∞Ìôî
                initDateSelector();
                console.log('ÎÇ†Ïßú ÏÑ†ÌÉùÍ∏∞ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
                
                // Îã¨Î†• ÏÉùÏÑ±
                createCalendar();
                console.log('Îã¨Î†• ÏÉùÏÑ± ÏôÑÎ£å');
                
                // ÌÖåÎßà Ï¥àÍ∏∞Ìôî
                initTheme();
                console.log('ÌÖåÎßà Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
                
                // Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Ï¥àÍ∏∞Ìôî
                setTimeout(function() {
                    initButtons();
                }, 100); // ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ÏùÑ Ï£ºÏñ¥ DOMÏù¥ ÏôÑÏ†ÑÌûà Ï§ÄÎπÑÎêòÎèÑÎ°ù Ìï®
                
                // ÏïåÎûå ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî
                setTimeout(() => {
                    requestNotificationPermission();
                    restoreAlarms();
                }, 1000); // ÌéòÏù¥ÏßÄ Î°úÎî© ÌõÑ 1Ï¥à Îí§Ïóê Í∂åÌïú ÏöîÏ≤≠
                
                // Ïä§Ìã∞ÌÇ§ Î©îÎ™®Îäî Î©îÎ™®Ïû• Î≤ÑÌäº ÌÅ¥Î¶≠ ÏãúÏóêÎßå ÏÉùÏÑ±Îê®
                
            } catch (error) {
                console.error('Ï¥àÍ∏∞Ìôî Ï§ë Ïò§Î•ò Î∞úÏÉù:', error);
            }
        });

        // ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å ÌõÑ Ï∂îÍ∞Ä Ï≤¥ÌÅ¨
        window.addEventListener('load', function() {
            console.log('ÌéòÏù¥ÏßÄ ÏôÑÏ†Ñ Î°úÎìú ÏôÑÎ£å');
            
            // Ïä§Ìã∞ÌÇ§ Î©îÎ™®Îäî ÏïÑÏßÅ ÏÉùÏÑ±ÎêòÏßÄ ÏïäÏùå
            
            // Î≤ÑÌäºÎì§Ïù¥ Ï†úÎåÄÎ°ú Î∞îÏù∏Îî©ÎêòÏóàÎäîÏßÄ Ïû¨ÌôïÏù∏
            const buttons = document.querySelectorAll('.action-btn');
            console.log('Ï∞æÏùÄ Ïï°ÏÖò Î≤ÑÌäº Í∞úÏàò:', buttons.length);
            
            if (buttons.length === 0) {
                console.error('Ïï°ÏÖò Î≤ÑÌäºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. HTML Íµ¨Ï°∞Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
            }
        });
    </script>

    <script>
        // Google API Î°úÎìú ÏôÑÎ£å ÏΩúÎ∞± (Î®ºÏ†Ä Ï†ïÏùò)
        function gapiLoaded() {
            console.log('GAPI Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎìú ÏôÑÎ£å');
            window.gapiScriptLoaded = true;
        }
        
        function gisLoaded() {
            console.log('GIS Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎìú ÏôÑÎ£å');
            window.gisScriptLoaded = true;
        }
    </script>
    
    <!-- Google API Ïä§ÌÅ¨Î¶ΩÌä∏Îì§ (Cross-Origin Ï†ïÏ±Ö Í≥†Î†§) -->
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    
    <!-- Google Drive ÌÜµÌï© Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <script src="google-drive-integration.js"></script>
    
    <!-- ÏûêÎèô ÎèôÍ∏∞Ìôî ÏãúÏä§ÌÖú -->
    <script src="auto-sync-system.js"></script>
    
    <!-- ÌÜµÌï© ÌÅ¥ÎùºÏö∞Îìú Î™®Îã¨ (Íµ¨Í∏Ä ÎìúÎùºÏù¥Î∏å + ÏûêÎèô ÎèôÍ∏∞Ìôî ÌÜµÌï©) -->
    <script src="unified-cloud-modal.js"></script>
    
    <!-- ÌÜµÌï© Î©îÎ™® Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú ÌôúÏÑ±Ìôî -->
    <script src="unified-memo-system.js"></script>
    
    <!-- Ïä§Ìã∞Ïª§ Î©îÎ™® ÌÜµÌï© Î≥µÏõê (Î™®Îì† Í∏∞Îä• Ï†ïÏÉÅÌôî) -->
    <script src="sticky-unified-restoration.js"></script>
    
    <!-- ÏÉÅÌÉú Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ ÏãúÏä§ÌÖú -->
    <script src="status-indicator.js"></script>
    
    <!-- ÌïÑÏàò Ïä§ÌÅ¨Î¶ΩÌä∏Îßå ÌôúÏÑ±Ìôî (Ï§ëÎ≥µ Ï†úÍ±∞) -->
    <script src="error-handling-improvements.js"></script>
    <script src="dom-safety-fix.js"></script>
    <script src="memo-refresh-fix.js"></script>
    <script src="instant-delete.js"></script>
    <script src="ghost-memo-cleanup.js"></script>

    <!-- Google Drive ÎèôÍ∏∞Ìôî ÏÉÅÌÉúÏ∞Ω (ÍπúÎπ°ÏûÑ ÏõêÏù∏ÏúºÎ°ú ÎπÑÌôúÏÑ±Ìôî) -->
    <script src="sync-status-window.js"></script>
    
    <!-- ÏµúÏÜåÌïúÏùò ÍπúÎπ°ÏûÑ Î∞©ÏßÄ CSS -->
    <link rel="stylesheet" href="minimal-fix.css">
    
    <!-- Î™®Îì† ÏÑ±Îä• ÏàòÏ†ï Ïä§ÌÅ¨Î¶ΩÌä∏ ÎπÑÌôúÏÑ±Ìôî -->
    <!--
    <script src="safe-performance-fix.js"></script>
    <script src="simple-flicker-fix.js"></script>
    -->
    
    <!-- Î≥µÏû°Ìïú ÏàòÏ†ï Ïä§ÌÅ¨Î¶ΩÌä∏Îì§ ÎπÑÌôúÏÑ±Ìôî -->
    <!--
    <script src="stop-flickering-fix.js"></script>
    <script src="fix-buttons-click.js"></script>
    <script src="force-button-fix.js"></script>
    -->
    
    <!-- Î™®Îã¨ Ïû¨Ïó¥Î¶º Î¨∏Ï†ú ÏàòÏ†ï -->
    <!-- <script src="modal-reopen-fix.js"></script> -->
    
    <!-- Î™®Îã¨ Ïï†ÎãàÎ©îÏù¥ÏÖò ÎπÑÌôúÏÑ±Ìôî -->
    <link rel="stylesheet" href="disable-modal-animations.css">
    <!-- force-show-memos.css Ï†úÍ±∞ - Î†àÏù¥ÏïÑÏõÉ Íπ®Ïßê ÏõêÏù∏ -->
    
    <!-- Î©îÎ™® Ìé∏Ïßë Ïãú Î¶¨Ïä§Ìä∏ Ïà®ÍπÄ CSS -->
    <link rel="stylesheet" href="memo-edit-hide-styles.css">
    
    <!-- Îã¨Î†• ÌïòÎã® Î©îÎ™® Î¶¨Ïä§Ìä∏ Í∏∞Î≥∏ Ïà®ÍπÄ CSS -->
    <link rel="stylesheet" href="hide-memo-lists.css">
    
    <!-- ÎÑ§Ïù¥Ìã∞Î∏å Îç∞Ïä§ÌÅ¨ÌÉë ÏïåÎ¶º ÏãúÏä§ÌÖú -->
    <script src="native-notification-system.js"></script>
    <script src="alarm-integration.js"></script>
    <script src="alarm-test-button.js"></script>
    <script src="alarm-edit-system.js"></script>
    <script src="notification-diagnostics.js"></script>
    <script src="immediate-notification-test.js"></script>
    <script src="memo-edit-fix.js"></script>
    <script src="current-memo-id-fix.js"></script>
    <script src="memo-delete-improvement.js"></script>
    
    <!-- Î©îÎ™® Í∏∞Îä• ÌÜµÌï© ÏàòÏ†ï (Ïû†Í∏à, ÏÇ≠Ï†ú, Ìé∏Ïßë, ÏïåÎûå) -->
    <script src="memo-functions-fix-all.js"></script>
    
    <!-- Ïû†Í∏à ÏãúÏä§ÌÖú ÏµúÏ†ÅÌôî (Î∂àÌïÑÏöîÌïú Î©îÎ™® Î¶¨Ïä§Ìä∏ ÌëúÏãú Î∞©ÏßÄ) -->
    <script src="lock-system-optimizer.js"></script>
    
    <!-- Ìè¨Í¥ÑÏ†Å ÏßÑÎã® ÏãúÏä§ÌÖú (Î¨∏Ï†ú ÏûêÎèô Í∞êÏßÄ Î∞è ÏÉÅÏÑ∏ Î°úÍ∑∏) -->
    <script src="comprehensive-diagnostics.js"></script>
    
    <!-- Î©îÎ™® ÏÇ≠Ï†ú Ï∂îÏ†Å Î∞è Î≥µÏõê Î∞©ÏßÄ ÏãúÏä§ÌÖú -->
    <script src="memo-deletion-tracker.js"></script>
    
    <!-- force-modal-open.js Ï†úÍ±∞ - unified-memo-system.jsÏôÄ Ï∂©Îèå -->
</body>
</html>