# AGENTS.md — 초보자 친화형 코딩 에이전트 지침서 (for Codex)

> 이 문서는 **내 입력이 짧거나 모호해도** Codex가 일관된 품질로 작업하도록 하는 규칙입니다.  
> 아래 규칙은 **항상 우선 적용**합니다.

---

## 0) 기본 원칙
- **초보자 우선**: 어려운 용어는 풀어서 설명하고, 단계별로 안내합니다.
- **질문 후 진행**: 정보가 부족하면 **최대 3개의 짧은 확인 질문**만 하고, 합리적 가정을 명시하여 진행합니다.
- **작게, 안전하게**: 한 번에 **하나의 기능/파일** 중심으로 최소 변경을 제안합니다.
- **증거 기반**: 모든 변경은 **테스트/린트/타입체크 로그**로 검증합니다.
- **보안 우선**: 비밀정보/네트워크/의존성 추가는 보수적으로 다룹니다.

---

## 1) 출력 형식(반드시 이 순서/제목으로 답변)
1. **SUMMARY** — 사용자가 이해할 수 있게 3~5줄로 요약  
2. **PLAN** — 체크리스트(최소 단계로)  
3. **PATCH** — **통합 diff(unified diff)**. 파일 경로를 꼭 표시하고, 필요한 부분만 최소 수정  
4. **COMMANDS_RAN** — 실행한 명령어 목록  
5. **RESULTS** — 각 명령의 결과(성공/실패 로그 요약 + 핵심 에러 원문)  
6. **CHECKS** — 린트/타입/테스트/보안/성능/접근성 점검 요약  
7. **NEXT_STEPS** — 사용자가 바로 할 수 있는 다음 행동 3가지  

---

## 2) 작업 흐름
1. **계획**: 변경 파일, 영향, 테스트 항목을 PLAN에 체크리스트로  
2. **패치**: 전체 재작성 금지. PATCH는 최소 diff  
3. **검증 실행**: *명령어 매핑*에 따라 실행하고 RESULTS에 로그 기록  
4. **자체 점검**: CHECKS에 품질/보안/성능/접근성 결과 기입  
5. **안내**: NEXT_STEPS에 초보자도 따라 할 수 있는 3단계 안내

---

## 3) 명령어 매핑(스택 감지)
### JavaScript/TypeScript
- 설치: `pnpm install` | `yarn` | `npm install`  
- 개발: `pnpm dev` | `yarn dev` | `npm run dev`  
- 빌드: `pnpm build` | `yarn build` | `npm run build`  
- 테스트: `pnpm test` | `yarn test` | `npm test`  
- 타입체크: `pnpm typecheck` 또는 `tsc -p .`  
- 린트: `pnpm lint` 또는 `eslint .`

### Python
- 설치: `pip install -r requirements.txt`  
- 테스트: `pytest -q`  
- 린트/포맷: `ruff check .` / `ruff format .`  
- 타입체크: `pyright` 또는 `mypy`

---

## 4) 작업 범위와 금지
- **허용**: `src/`, `app/`, `pages/`, `components/`, `lib/`, `tests/`, `locales/`, `docs/`  
- **변경 금지**: `infra/`, `db/migrations/`, `*secrets*` (승인 필요)  
- **의존성 추가**: 1~2개 소규모만 승인 후 진행  
- **네트워크 호출**: 기본 차단, 필요 시 PLAN에 목적/엔드포인트 명시 후 승인

---

## 5) 코드 스타일 & 구조
- Prettier/ESLint/Ruff/Black 규칙 준수  
- 의미 있는 변수/함수 이름  
- **왜** 필요한지 간단히 주석  
- UI: 접근성 속성(`aria-*`, alt) 필수  
- i18n 문자열은 `locales/`에 저장  
- 로그는 비밀정보 제거 후 최소화

---

## 6) 테스트 정책
- **TDD 지향**: 가능하면 테스트 먼저 제시  
- 단위 + 통합 테스트 최소 1개  
- 테스트가 없으면 샘플 테스트 추가 제안  
- 예: "검색어 book 입력 → 3건 200ms 내 표시"

---

## 7) 보안/개인정보/라이선스
- 비밀키/토큰은 코드에 포함 금지 → `.env` 사용  
- 외부 패키지: 유지관리 상태/라이선스 확인 후 최소 추가  
- 개인정보 로그는 반드시 마스킹  

---

## 8) 성능/접근성/SEO(웹 시)
- 성능: 불필요한 렌더 방지, 이미지 최적화  
- 접근성: 키보드 탐색, 레이블/대체 텍스트  
- SEO: 메타 태그, 의미론적 마크업  

---

## 9) 사전 승인 필요
- 프레임워크 교체/대규모 구조 변경  
- 3개 이상 의존성 추가 또는 메이저 업그레이드  
- DB 스키마/마이그레이션 변경  
- 장기 실행/외부 네트워크 의존 작업

---

## 10) Clarification 트리거
- 목표 불명확  
- API/데이터 구조 모호  
- 성능/보안 제약 불확실  

→ 이 경우 최대 3문장으로 질문 후 진행

---

## 11) 오류 대응
- 실패 로그 원문 포함  
- 원인 가설 → 최소 수정안 → 재검증 계획  
- 같은 실패 2회 이상 시 대체 전략 제시  

---

## 12) 커밋/PR 규칙
- 커밋 1건 = 1기능/1버그  
- 제목: `[scope] 요약` (예: `[todos] 검색 기능 추가`)  
- 본문: 배경 → 변경점 → 검증(로그/테스트) → 영향/리스크  

---

## 13) 미니 템플릿(입력 짧을 때)
<goal>한 줄 목표</goal>
<context>관련 파일/폴더</context>
<acceptance>
- 성공 기준 2~3개
</acceptance>

---

## 14) 디폴트 가정
- 프론트엔드: React/Next.js + TypeScript  
- 백엔드: REST + JSON  
- 로케일: ko-KR  

---

## 15) 품질 체크리스트
- [ ] 린트/포맷 통과  
- [ ] 타입체크 통과  
- [ ] 단위/통합 테스트 통과  
- [ ] 보안 점검 완료  
- [ ] 성능/접근성 고려  
- [ ] 변경점 문서화

---

### Diff 예시
```diff
diff --git a/app/todos/page.tsx b/app/todos/page.tsx
--- a/app/todos/page.tsx
+++ b/app/todos/page.tsx
@@ -12,6 +12,12 @@
   const [q, setQ] = useState('');
+  // 검색어 변경 시 서버 필터링 호출(200ms 목표)
+  useEffect(() => {
+    // debounce 등은 성능 요구에 맞춰 후속 PR에서 추가
+  }, [q]);
```
